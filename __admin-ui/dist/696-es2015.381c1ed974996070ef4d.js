"use strict";(self.webpackChunkvendure_admin_ui=self.webpackChunkvendure_admin_ui||[]).push([[696],{72696:function(e,t,n){n.r(t),n.d(t,{AddManualPaymentDialogComponent:function(){return pi},CancelOrderDialogComponent:function(){return gi},CouponCodeSelectorComponent:function(){return fi},DraftOrderDetailComponent:function(){return Ai},DraftOrderVariantSelectorComponent:function(){return bi},FulfillOrderDialogComponent:function(){return Ci},FulfillmentCardComponent:function(){return qi},FulfillmentDetailComponent:function(){return Ti},FulfillmentStateLabelComponent:function(){return Oi},GET_CUSTOMER_ADDRESSES:function(){return Zi},LineFulfillmentComponent:function(){return _i},LineRefundsComponent:function(){return Ii},ModificationDetailComponent:function(){return wi},NODE_HEIGHT:function(){return Ei},OrderCustomFieldsCardComponent:function(){return Li},OrderDetailComponent:function(){return Ui},OrderEditResultType:function(){return Mi},OrderEditorComponent:function(){return Qi},OrderEditsPreviewDialogComponent:function(){return Pi},OrderGuard:function(){return zi},OrderHistoryComponent:function(){return Di},OrderHistoryEntryHostComponent:function(){return ki},OrderListComponent:function(){return Yi},OrderModule:function(){return ao},OrderPaymentCardComponent:function(){return ji},OrderProcessEdgeComponent:function(){return $i},OrderProcessGraphComponent:function(){return Hi},OrderProcessGraphDialogComponent:function(){return Fi},OrderProcessNodeComponent:function(){return Ri},OrderResolver:function(){return Xi},OrderStateSelectDialogComponent:function(){return mi},OrderTableComponent:function(){return Bi},OrderTransitionService:function(){return hi},PaymentDetailComponent:function(){return Vi},PaymentStateLabelComponent:function(){return Gi},RefundOrderDialogComponent:function(){return Ni},RefundStateLabelComponent:function(){return Wi},SelectAddressDialogComponent:function(){return xi},SelectCustomerDialogComponent:function(){return vi},SelectShippingMethodDialogComponent:function(){return yi},SettleRefundDialogComponent:function(){return Ji},SimpleItemListComponent:function(){return Ki},modifyingOrderBreadcrumb:function(){return so},orderBreadcrumb:function(){return oo},orderRoutes:function(){return io},"\u02750":function(){return eo},"\u02751":function(){return to},"\u02752":function(){return no},"\u02753":function(){return ro}});var r=n(71029),i=n(76456),o=n(20576),s=n(857),a=n(45362),c=n(56559),l=n(89918),d=n(84363),u=n(30125),p=n(77194),g=n(45327),f=n(94614);class m{constructor(e,t){this.notifier=e,this.source=t}call(e,t){return t.subscribe(new h(e,this.notifier,this.source))}}class h extends f.Ds{constructor(e,t,n){super(e),this.notifier=t,this.source=n}error(e){if(!this.isStopped){let n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{n=new a.xQ;try{const{notifier:e}=this;r=e(n)}catch(t){return super.error(t)}i=(0,f.ft)(r,new f.IY(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(e)}}_unsubscribe(){const{errors:e,retriesSubscription:t}=this;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0}notifyNext(){const{_unsubscribe:e}=this;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)}}var Z=n(19614),x=n(21544),v=n(98370),y=n(4315),A=n(24806),b=n(15204),C=n(96361),q=n(21385),T=n(96525),O=n(45306),_=n(34308),I=n(7169),w=n(56037),L=n(20233),F=n(18495),N=n(37592),J=n(10576),U=n(56502),M=n(5671),S=n(70060),P=n(79183),Q=n(36508),k=n(1778);function D(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.add-payment-to-order"))}function Y(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",7),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().submit()}),r._uU(4),r.ALo(5,"translate"),r.ALo(6,"localeCurrency"),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,4,"common.cancel")),r.xp6(2),r.Q6J("disabled",e.form.invalid||e.form.pristine),r.xp6(1),r.AsE(" ",r.lcZ(5,6,"order.add-payment")," (",r.xi3(6,8,e.outstandingAmount,e.currencyCode),") ")}}function j(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.cancel-order"))}function E(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"input",19),r.NdJ("ngModelChange",function(t){r.CHM(e);const n=r.oxw().$implicit;return r.oxw().lineQuantities[n.id]=t})("input",function(){return r.CHM(e),r.oxw(2).checkIfAllSelected()}),r.qZA()}if(2&e){const e=r.oxw().$implicit,t=r.oxw();r.Q6J("ngModel",t.lineQuantities[e.id])("disabled",t.cancelAll)("max",e.quantity)}}function $(e,t){if(1&e&&r._uU(0),2&e){const e=r.oxw().$implicit;r.Oqu(e.quantity)}}function R(e,t){if(1&e&&(r.TgZ(0,"tr",10),r.TgZ(1,"td",11),r._UZ(2,"img",12),r.ALo(3,"assetPreview"),r.qZA(),r.TgZ(4,"td",13),r._uU(5),r.qZA(),r.TgZ(6,"td",14),r._uU(7),r.qZA(),r.TgZ(8,"td",15),r._uU(9),r.qZA(),r.TgZ(10,"td",15),r._uU(11),r.ALo(12,"localeCurrency"),r.qZA(),r.TgZ(13,"td",16),r.YNc(14,E,1,3,"input",17),r.YNc(15,$,1,1,"ng-template",null,18,r.W1O),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.MAs(16),i=r.oxw();r.ekj("is-disabled",i.cancelAll)("is-cancelled",0===e.quantity),r.xp6(2),r.Q6J("src",r.xi3(3,11,e.featuredAsset,"tiny"),r.LSH),r.xp6(3),r.Oqu(e.productVariant.name),r.xp6(2),r.Oqu(e.productVariant.sku),r.xp6(2),r.Oqu(e.quantity),r.xp6(2),r.hij(" ",r.xi3(12,14,e.unitPriceWithTax,i.order.currencyCode)," "),r.xp6(3),r.Q6J("ngIf",e.quantity>0&&!i.order.active)("ngIfElse",n)}}function H(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"clr-radio-wrapper"),r.TgZ(2,"input",20),r.NdJ("ngModelChange",function(t){r.CHM(e);return r.oxw().cancelAll=t})("ngModelChange",function(){return r.CHM(e),r.oxw().radioChanged()}),r.qZA(),r.TgZ(3,"label"),r._uU(4),r.ALo(5,"translate"),r.qZA(),r.qZA(),r.TgZ(6,"clr-radio-wrapper"),r.TgZ(7,"input",20),r.NdJ("ngModelChange",function(t){r.CHM(e);return r.oxw().cancelAll=t})("ngModelChange",function(){return r.CHM(e),r.oxw().radioChanged()}),r.qZA(),r.TgZ(8,"label"),r._uU(9),r.ALo(10,"translate"),r.qZA(),r.qZA(),r.BQk()}if(2&e){const e=r.oxw();r.xp6(2),r.Q6J("value",!0)("ngModel",e.cancelAll),r.xp6(2),r.Oqu(r.lcZ(5,6,"order.cancel-entire-order")),r.xp6(3),r.Q6J("value",!1)("ngModel",e.cancelAll),r.xp6(2),r.Oqu(r.lcZ(10,8,"order.cancel-specified-items"))}}function B(e,t){1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.cancel-selected-items")," "))}function V(e,t){1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.cancel-order")," "))}function G(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",21),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",22),r.NdJ("click",function(){return r.CHM(e),r.oxw().select()}),r.YNc(4,B,3,3,"ng-container",6),r.YNc(5,V,3,3,"ng-container",6),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,4,"common.cancel")),r.xp6(2),r.Q6J("disabled",!e.reason||!e.order.active&&0===e.selectionCount),r.xp6(1),r.Q6J("ngIf",!e.order.active),r.xp6(1),r.Q6J("ngIf",e.order.active)}}function W(e,t){if(1&e&&(r.TgZ(0,"vdr-chip"),r._uU(1),r.qZA(),r._uU(2)),2&e){const e=t.item;r.xp6(1),r.Oqu(e.code),r.xp6(1),r.hij(" ",e.promotionName," ")}}function K(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.select-state"))}function X(e,t){if(1&e&&(r.TgZ(0,"option",4),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"stateI18nToken"),r.qZA()),2&e){const e=t.$implicit;r.Q6J("value",e),r.xp6(1),r.hij(" ",r.lcZ(2,2,r.lcZ(3,4,e))," ")}}function z(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",7),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA()}2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"common.cancel")," "))}const ee=function(e){return{state:e}};function te(e,t){if(1&e){const e=r.EpF();r.YNc(0,z,3,3,"button",5),r.TgZ(1,"button",6),r.NdJ("click",function(){return r.CHM(e),r.oxw().select()}),r._uU(2),r.ALo(3,"translate"),r.ALo(4,"translate"),r.ALo(5,"stateI18nToken"),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("ngIf",e.cancellable),r.xp6(1),r.Q6J("disabled",!e.selectedState),r.xp6(1),r.hij(" ",r.xi3(3,3,"order.transition-to-state",r.VKq(10,ee,r.lcZ(4,6,r.lcZ(5,8,e.selectedState))))," ")}}function ne(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.select-address"))}function re(e,t){if(1&e&&(r.TgZ(0,"vdr-radio-card",7),r._UZ(1,"vdr-formatted-address",8),r.qZA()),2&e){const e=t.$implicit;r.Q6J("item",e),r.xp6(1),r.Q6J("address",e)}}function ie(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"clr-tab-content"),r.TgZ(1,"vdr-radio-card-fieldset",5),r.NdJ("selectItem",function(t){r.CHM(e);return r.oxw(3).selectedAddress=t}),r.YNc(2,re,2,2,"vdr-radio-card",6),r.qZA(),r.qZA()}if(2&e){const e=r.oxw(2).ngIf,t=r.oxw();r.xp6(1),r.Q6J("idFn",t.addressIdFn)("selectedItemId",t.selectedAddress&&t.addressIdFn(t.selectedAddress)),r.xp6(1),r.Q6J("ngForOf",e)}}function oe(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"clr-tab"),r.TgZ(1,"button",3),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.YNc(4,ie,3,3,"ng-template",4),r.NdJ("clrIfActiveChange",function(t){r.CHM(e);return r.oxw(2).useExisting=t}),r.qZA()}if(2&e){const e=r.oxw(2);r.xp6(2),r.Oqu(r.lcZ(3,2,"order.existing-address")),r.xp6(2),r.Q6J("clrIfActive",e.useExisting)}}function se(e,t){if(1&e&&(r.TgZ(0,"clr-tab-content"),r._UZ(1,"vdr-address-form",9),r.ALo(2,"async"),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("formGroup",e.addressForm)("availableCountries",r.lcZ(2,2,e.availableCountries$))}}function ae(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"clr-tabs"),r.YNc(1,oe,5,4,"clr-tab",1),r.TgZ(2,"clr-tab"),r.TgZ(3,"button",3),r._uU(4),r.ALo(5,"translate"),r.qZA(),r.YNc(6,se,3,4,"ng-template",4),r.NdJ("clrIfActiveChange",function(t){r.CHM(e);return r.oxw().createNew=t}),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();r.xp6(1),r.Q6J("ngIf",n.customerId&&e.length),r.xp6(3),r.Oqu(r.lcZ(5,3,"customer.create-new-address")),r.xp6(2),r.Q6J("clrIfActive",n.createNew)}}function ce(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",10),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",11),r.NdJ("click",function(){return r.CHM(e),r.oxw().select()}),r._uU(4),r.ALo(5,"translate"),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,3,"common.cancel")),r.xp6(2),r.Q6J("disabled",e.useExisting&&!e.selectedAddress||e.createNew&&e.addressForm.invalid),r.xp6(1),r.hij(" ",r.lcZ(5,5,"common.okay")," ")}}function le(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.set-customer-for-order"))}function de(e,t){if(1&e&&(r._UZ(0,"clr-icon",7),r.TgZ(1,"span",8),r._uU(2),r.qZA(),r.TgZ(3,"vdr-chip"),r._uU(4),r.qZA()),2&e){const e=t.item;r.xp6(2),r.AsE("",e.firstName," ",e.lastName,""),r.xp6(2),r.Oqu(e.emailAddress)}}function ue(e,t){if(1&e&&(r._UZ(0,"clr-icon",7),r.TgZ(1,"span",8),r._uU(2),r.qZA(),r.TgZ(3,"vdr-chip"),r._uU(4),r.qZA()),2&e){const e=t.item;r.xp6(2),r.AsE("",e.firstName," ",e.lastName,""),r.xp6(2),r.Oqu(e.emailAddress)}}function pe(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"clr-tab-content"),r.TgZ(1,"ng-select",4),r.NdJ("ngModelChange",function(t){r.CHM(e);return r.oxw().selectedCustomer=t}),r.ALo(2,"async"),r.YNc(3,de,5,3,"ng-template",5),r.YNc(4,ue,5,3,"ng-template",6),r.qZA(),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Q6J("items",r.lcZ(2,9,e.customers$))("addTag",!1)("multiple",!0)("hideSelected",!0)("trackByFn",e.trackByFn)("minTermLength",2)("loading",e.isLoading)("typeahead",e.input$)("ngModel",e.selectedCustomer)}}function ge(e,t){if(1&e&&(r.TgZ(0,"clr-tab-content"),r.TgZ(1,"form",9),r.TgZ(2,"vdr-form-field",10),r.ALo(3,"translate"),r._UZ(4,"input",11),r.qZA(),r.TgZ(5,"vdr-form-field",12),r.ALo(6,"translate"),r._UZ(7,"input",13),r.qZA(),r.TgZ(8,"vdr-form-field",14),r.ALo(9,"translate"),r._UZ(10,"input",15),r.qZA(),r.TgZ(11,"vdr-form-field",16),r.ALo(12,"translate"),r._UZ(13,"input",17),r.qZA(),r.TgZ(14,"vdr-form-field",18),r.ALo(15,"translate"),r._UZ(16,"input",19),r.qZA(),r.qZA(),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("formGroup",e.customerForm),r.xp6(1),r.Q6J("label",r.lcZ(3,6,"customer.title")),r.xp6(3),r.Q6J("label",r.lcZ(6,8,"customer.first-name")),r.xp6(3),r.Q6J("label",r.lcZ(9,10,"customer.last-name")),r.xp6(3),r.Q6J("label",r.lcZ(12,12,"customer.email-address")),r.xp6(3),r.Q6J("label",r.lcZ(15,14,"customer.phone-number"))}}function fe(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",20),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",21),r.NdJ("click",function(){return r.CHM(e),r.oxw().select()}),r._uU(4),r.ALo(5,"translate"),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,3,"common.cancel")),r.xp6(2),r.Q6J("disabled",e.useExisting&&0===e.selectedCustomer.length||e.createNew&&e.customerForm.invalid),r.xp6(1),r.hij(" ",r.lcZ(5,5,"common.okay")," ")}}function me(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.select-shipping-method"))}function he(e,t){if(1&e&&r._UZ(0,"vdr-object-tree",9),2&e){const e=r.oxw().$implicit;r.Q6J("value",e.metadata)}}function Ze(e,t){if(1&e&&(r.TgZ(0,"vdr-radio-card",4),r.TgZ(1,"div",5),r.TgZ(2,"vdr-labeled-data",6),r.ALo(3,"translate"),r._uU(4),r.qZA(),r.TgZ(5,"div",7),r.TgZ(6,"vdr-labeled-data",6),r.ALo(7,"translate"),r._uU(8),r.ALo(9,"localeCurrency"),r.qZA(),r.TgZ(10,"vdr-labeled-data",6),r.ALo(11,"translate"),r._uU(12),r.ALo(13,"localeCurrency"),r.qZA(),r.qZA(),r.YNc(14,he,1,1,"vdr-object-tree",8),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw();r.Q6J("item",e),r.xp6(2),r.Q6J("label",r.lcZ(3,8,"settings.shipping-method")),r.xp6(2),r.hij(" ",e.name," "),r.xp6(2),r.Q6J("label",r.lcZ(7,10,"common.price")),r.xp6(2),r.hij(" ",r.xi3(9,12,e.price,n.currencyCode)," "),r.xp6(2),r.Q6J("label",r.lcZ(11,15,"common.price-with-tax")),r.xp6(2),r.hij(" ",r.xi3(13,17,e.priceWithTax,n.currencyCode)," "),r.xp6(2),r.Q6J("ngIf",e.metadata)}}function xe(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",10),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",11),r.NdJ("click",function(){return r.CHM(e),r.oxw().select()}),r._uU(4),r.ALo(5,"translate"),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,3,"common.cancel")),r.xp6(2),r.Q6J("disabled",!e.selectedMethod),r.xp6(1),r.hij(" ",r.lcZ(5,5,"common.okay")," ")}}function ve(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"vdr-action-bar"),r.TgZ(1,"vdr-ab-left"),r.TgZ(2,"div",1),r._UZ(3,"vdr-entity-info",2),r.ALo(4,"async"),r._UZ(5,"vdr-order-state-label",3),r.qZA(),r.qZA(),r.TgZ(6,"vdr-ab-right"),r.TgZ(7,"button",4),r.NdJ("click",function(){return r.CHM(e),r.oxw().completeOrder()}),r._UZ(8,"clr-icon",5),r._uU(9),r.ALo(10,"translate"),r.qZA(),r.TgZ(11,"vdr-dropdown"),r.TgZ(12,"button",6),r._UZ(13,"clr-icon",7),r.qZA(),r.TgZ(14,"vdr-dropdown-menu",8),r.TgZ(15,"button",9),r.NdJ("click",function(){return r.CHM(e),r.oxw().deleteOrder()}),r._UZ(16,"clr-icon",10),r._uU(17),r.ALo(18,"translate"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();r.xp6(3),r.Q6J("entity",r.lcZ(4,5,n.entity$)),r.xp6(2),r.Q6J("state",e.state),r.xp6(2),r.Q6J("disabled",!e.customer||!e.lines.length||!e.shippingLines.length),r.xp6(2),r.hij(" ",r.lcZ(10,7,"order.complete-draft-order")," "),r.xp6(8),r.hij(" ",r.lcZ(18,9,"order.delete-draft-order")," ")}}function ye(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",30),r.NdJ("click",function(){r.CHM(e);const t=r.oxw(2);return t.displayCouponCodeInput=!t.displayCouponCodeInput}),r._uU(1),r.ALo(2,"translate"),r.qZA()}2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.set-coupon-codes")," "))}function Ae(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"label"),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"vdr-coupon-code-selector",31),r.NdJ("addCouponCode",function(t){return r.CHM(e),r.oxw(2).applyCouponCode(t)})("removeCouponCode",function(t){return r.CHM(e),r.oxw(2).removeCouponCode(t)}),r.qZA(),r.qZA()}if(2&e){const e=r.oxw().ngIf;r.xp6(2),r.Oqu(r.lcZ(3,2,"order.set-coupon-codes")),r.xp6(2),r.Q6J("couponCodes",e.couponCodes)}}function be(e,t){if(1&e&&(r.TgZ(0,"tr"),r.TgZ(1,"td"),r._uU(2),r.qZA(),r.TgZ(3,"td"),r._uU(4),r.ALo(5,"percent"),r.qZA(),r.TgZ(6,"td"),r._uU(7),r.ALo(8,"localeCurrency"),r.qZA(),r.TgZ(9,"td"),r._uU(10),r.ALo(11,"localeCurrency"),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw(2).ngIf;r.xp6(2),r.Oqu(e.description),r.xp6(2),r.Oqu(r.lcZ(5,4,e.taxRate/100)),r.xp6(3),r.Oqu(r.xi3(8,6,e.taxBase,n.currencyCode)),r.xp6(3),r.Oqu(r.xi3(11,9,e.taxTotal,n.currencyCode))}}function Ce(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"h4"),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"table",32),r.TgZ(5,"thead"),r.TgZ(6,"tr"),r.TgZ(7,"th"),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.TgZ(10,"th"),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"th"),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"th"),r._uU(17),r.ALo(18,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(19,"tbody"),r.YNc(20,be,12,12,"tr",28),r.qZA(),r.qZA(),r.BQk()),2&e){const e=r.oxw().ngIf;r.xp6(2),r.Oqu(r.lcZ(3,6,"order.tax-summary")),r.xp6(6),r.Oqu(r.lcZ(9,8,"common.description")),r.xp6(3),r.Oqu(r.lcZ(12,10,"order.tax-rate")),r.xp6(3),r.Oqu(r.lcZ(15,12,"order.tax-base")),r.xp6(3),r.Oqu(r.lcZ(18,14,"order.tax-total")),r.xp6(3),r.Q6J("ngForOf",e.taxSummary)}}function qe(e,t){1&e&&r._UZ(0,"clr-icon",33)}function Te(e,t){1&e&&r._UZ(0,"clr-icon",34)}function Oe(e,t){if(1&e&&r._UZ(0,"vdr-customer-label",35),2&e){const e=r.oxw().ngIf;r.Q6J("customer",e.customer)}}function _e(e,t){1&e&&r._UZ(0,"clr-icon",33)}function Ie(e,t){1&e&&r._UZ(0,"clr-icon",34)}function we(e,t){if(1&e&&r._UZ(0,"vdr-formatted-address",36),2&e){const e=r.oxw().ngIf;r.Q6J("address",e.billingAddress)}}function Le(e,t){1&e&&r._UZ(0,"clr-icon",33)}function Fe(e,t){1&e&&r._UZ(0,"clr-icon",34)}function Ne(e,t){if(1&e&&r._UZ(0,"vdr-formatted-address",36),2&e){const e=r.oxw().ngIf;r.Q6J("address",e.shippingAddress)}}function Je(e,t){if(1&e&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&e){const e=t.$implicit;r.xp6(1),r.hij(" ",e.shippingMethod.name," ")}}function Ue(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"div",11),r.TgZ(2,"div",12),r.TgZ(3,"vdr-draft-order-variant-selector",13),r.NdJ("addItem",function(t){return r.CHM(e),r.oxw().addItemToOrder(t)}),r.qZA(),r.TgZ(4,"vdr-order-table",14),r.NdJ("adjust",function(t){return r.CHM(e),r.oxw().adjustOrderLine(t)})("remove",function(t){return r.CHM(e),r.oxw().removeOrderLine(t)}),r.qZA(),r.TgZ(5,"div",15),r.YNc(6,ye,3,3,"button",16),r.YNc(7,Ae,5,4,"div",0),r.qZA(),r.YNc(8,Ce,21,16,"ng-container",0),r.qZA(),r.TgZ(9,"div",17),r.TgZ(10,"div",18),r.TgZ(11,"div",19),r.YNc(12,qe,1,0,"clr-icon",20),r.YNc(13,Te,1,0,"clr-icon",21),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"div",22),r.TgZ(17,"div",23),r.YNc(18,Oe,1,1,"vdr-customer-label",24),r.TgZ(19,"button",25),r.NdJ("click",function(){return r.CHM(e),r.oxw().setCustomer()}),r._uU(20),r.ALo(21,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(22,"div",22),r.TgZ(23,"h4",26),r.YNc(24,_e,1,0,"clr-icon",20),r.YNc(25,Ie,1,0,"clr-icon",21),r._uU(26),r.ALo(27,"translate"),r.qZA(),r.TgZ(28,"div",23),r.YNc(29,we,1,1,"vdr-formatted-address",27),r.TgZ(30,"button",25),r.NdJ("click",function(){return r.CHM(e),r.oxw().setBillingAddress()}),r._uU(31),r.ALo(32,"translate"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(33,"div",18),r.TgZ(34,"div",19),r.YNc(35,Le,1,0,"clr-icon",20),r.YNc(36,Fe,1,0,"clr-icon",21),r._uU(37),r.ALo(38,"translate"),r.qZA(),r.TgZ(39,"div",22),r.TgZ(40,"div",23),r.YNc(41,Ne,1,1,"vdr-formatted-address",27),r.TgZ(42,"button",25),r.NdJ("click",function(){return r.CHM(e),r.oxw().setShippingAddress()}),r._uU(43),r.ALo(44,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(45,"div",22),r.TgZ(46,"div",23),r.YNc(47,Je,2,1,"div",28),r.TgZ(48,"button",25),r.NdJ("click",function(){return r.CHM(e),r.oxw().setShippingMethod()}),r._uU(49),r.ALo(50,"translate"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(51,"vdr-order-custom-fields-card",29),r.NdJ("updateClick",function(t){return r.CHM(e),r.oxw().updateCustomFields(t)}),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();r.xp6(3),r.Q6J("orderLineCustomFields",n.orderLineCustomFields)("currencyCode",e.currencyCode),r.xp6(1),r.Q6J("order",e)("orderLineCustomFields",n.orderLineCustomFields)("isDraft",!0),r.xp6(2),r.Q6J("ngIf",0===e.couponCodes.length&&!n.displayCouponCodeInput),r.xp6(1),r.Q6J("ngIf",e.couponCodes.length||n.displayCouponCodeInput),r.xp6(1),r.Q6J("ngIf",e.taxSummary.length),r.xp6(4),r.Q6J("ngIf",!e.customer),r.xp6(1),r.Q6J("ngIf",e.customer),r.xp6(1),r.hij(" ",r.lcZ(15,27,"order.customer")," "),r.xp6(4),r.Q6J("ngIf",e.customer),r.xp6(2),r.hij(" ",r.lcZ(21,29,"order.set-customer-for-order")," "),r.xp6(4),r.Q6J("ngIf",!e.billingAddress.streetLine1),r.xp6(1),r.Q6J("ngIf",e.billingAddress.streetLine1),r.xp6(1),r.hij(" ",r.lcZ(27,31,"order.billing-address")," "),r.xp6(3),r.Q6J("ngIf",e.billingAddress),r.xp6(2),r.hij(" ",r.lcZ(32,33,"order.set-billing-address")," "),r.xp6(4),r.Q6J("ngIf",!e.shippingAddress.streetLine1||!e.shippingLines.length),r.xp6(1),r.Q6J("ngIf",e.shippingAddress.streetLine1&&e.shippingLines.length),r.xp6(1),r.hij(" ",r.lcZ(38,35,"order.shipping")," "),r.xp6(4),r.Q6J("ngIf",e.shippingAddress),r.xp6(2),r.hij(" ",r.lcZ(44,37,"order.set-shipping-address")," "),r.xp6(4),r.Q6J("ngForOf",e.shippingLines),r.xp6(2),r.hij(" ",r.lcZ(50,39,"order.set-shipping-method")," "),r.xp6(2),r.Q6J("customFieldsConfig",n.customFields)("customFieldValues",e.customFields)}}function Me(e,t){if(1&e&&(r.TgZ(0,"div",16),r._UZ(1,"vdr-custom-field-control",17),r.qZA()),2&e){const e=t.$implicit,n=r.oxw(3);r.xp6(1),r.Q6J("compact",!0)("readonly",!1)("customField",e)("customFieldsFormGroup",n.customFieldsFormGroup)}}function Se(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Me,2,4,"div",15),r.BQk()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("ngForOf",e.orderLineCustomFields)}}function Pe(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",1),r.TgZ(1,"div",5),r._UZ(2,"img",6),r.ALo(3,"assetPreview"),r.TgZ(4,"div",7),r.TgZ(5,"div"),r._uU(6),r.qZA(),r.TgZ(7,"div",8),r._uU(8),r.qZA(),r.qZA(),r.TgZ(9,"div",9),r.TgZ(10,"div",8),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"div",8),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.qZA(),r._UZ(16,"div",10),r.TgZ(17,"div",7),r.TgZ(18,"div"),r._uU(19),r.ALo(20,"localeCurrency"),r.qZA(),r.TgZ(21,"div",11),r.ALo(22,"translate"),r._uU(23),r.ALo(24,"localeCurrency"),r.qZA(),r.qZA(),r.TgZ(25,"div"),r.TgZ(26,"input",12),r.NdJ("ngModelChange",function(t){r.CHM(e);return r.oxw().quantity=t}),r.qZA(),r.qZA(),r.TgZ(27,"button",13),r.NdJ("click",function(){const t=r.CHM(e).ngIf;return r.oxw().addItemClick(t)}),r._uU(28),r.ALo(29,"translate"),r.qZA(),r.qZA(),r.YNc(30,Se,2,1,"ng-container",14),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();r.xp6(2),r.Q6J("src",r.xi3(3,15,e.featuredAsset||e.product.featuredAsset,32),r.LSH),r.xp6(4),r.Oqu(null==e?null:e.name),r.xp6(2),r.Oqu(null==e?null:e.sku),r.xp6(3),r.AsE(" ",r.lcZ(12,18,"catalog.stock-on-hand"),": ",e.stockOnHand," "),r.xp6(3),r.AsE(" ",r.lcZ(15,20,"catalog.stock-allocated"),": ",e.stockAllocated," "),r.xp6(5),r.Oqu(r.xi3(20,22,null==e?null:e.priceWithTax,n.currencyCode)),r.xp6(2),r.Q6J("title",r.lcZ(22,25,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(24,27,null==e?null:e.price,n.currencyCode)," "),r.xp6(3),r.Q6J("disabled",!e)("ngModel",n.quantity),r.xp6(1),r.Q6J("disabled",!e),r.xp6(1),r.hij(" ",r.lcZ(29,30,"order.add-item-to-order")," "),r.xp6(2),r.Q6J("ngIf",n.orderLineCustomFields.length)}}function Qe(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.fulfill-order"))}function ke(e,t){if(1&e&&(r._UZ(0,"img",17),r.ALo(1,"assetPreview")),2&e){const e=r.oxw().$implicit;r.Q6J("src",r.xi3(1,1,e.featuredAsset,"tiny"),r.LSH)}}function De(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"input",18),r.NdJ("ngModelChange",function(t){r.CHM(e);const n=r.oxw().$implicit;return r.oxw().fulfillmentQuantities[n.id].fulfillCount=t}),r.qZA()}if(2&e){const e=r.oxw().$implicit,t=r.oxw();r.Q6J("disabled",0===t.getUnfulfilledCount(e))("ngModel",t.fulfillmentQuantities[e.id].fulfillCount)("max",t.fulfillmentQuantities[e.id].max)}}function Ye(e,t){if(1&e&&(r.TgZ(0,"tr",9),r.TgZ(1,"td",10),r.YNc(2,ke,2,4,"img",11),r.qZA(),r.TgZ(3,"td",12),r._uU(4),r.qZA(),r.TgZ(5,"td",13),r._uU(6),r.qZA(),r.TgZ(7,"td",14),r._uU(8),r.qZA(),r.TgZ(9,"td",14),r._uU(10),r.qZA(),r.TgZ(11,"td",15),r.YNc(12,De,1,3,"input",16),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw();r.ekj("ignore",0===n.getUnfulfilledCount(e)),r.xp6(2),r.Q6J("ngIf",e.featuredAsset),r.xp6(2),r.Oqu(e.productVariant.name),r.xp6(2),r.Oqu(e.productVariant.sku),r.xp6(2),r.Oqu(n.getUnfulfilledCount(e)),r.xp6(2),r.Oqu(e.productVariant.stockOnHand),r.xp6(2),r.Q6J("ngIf",n.fulfillmentQuantities[e.id])}}function je(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",19),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",20),r.NdJ("click",function(){return r.CHM(e),r.oxw().select()}),r._uU(4),r.ALo(5,"translate"),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,3,"common.cancel")),r.xp6(2),r.Q6J("disabled",!e.canSubmit()),r.xp6(1),r.hij(" ",r.lcZ(5,5,"order.create-fulfillment")," ")}}function Ee(e,t){if(1&e&&r._UZ(0,"vdr-fulfillment-detail",7),2&e){const e=r.oxw();r.Q6J("fulfillmentId",null==e.fulfillment?null:e.fulfillment.id)("order",e.order)}}function $e(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"button",14),r.NdJ("click",function(){const t=r.CHM(e).ngIf;return r.oxw(2).transitionState.emit(t)}),r._uU(2),r.ALo(3,"translate"),r.ALo(4,"translate"),r.ALo(5,"stateI18nToken"),r.qZA(),r.BQk()}if(2&e){const e=t.ngIf;r.xp6(2),r.hij(" ",r.xi3(3,1,"order.set-fulfillment-state",r.VKq(8,ee,r.lcZ(4,4,r.lcZ(5,6,e))))," ")}}function Re(e,t){if(1&e&&(r.ynx(0),r._UZ(1,"clr-icon",18),r._uU(2),r.ALo(3,"translate"),r.ALo(4,"translate"),r.ALo(5,"stateI18nToken"),r.BQk()),2&e){const e=r.oxw().$implicit;r.xp6(2),r.hij(" ",r.xi3(3,1,"order.transition-to-state",r.VKq(8,ee,r.lcZ(4,4,r.lcZ(5,6,e))))," ")}}function He(e,t){1&e&&(r._UZ(0,"clr-icon",19),r._uU(1),r.ALo(2,"translate")),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.cancel-fulfillment")," "))}function Be(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"button",15),r.NdJ("click",function(){const t=r.CHM(e).$implicit;return r.oxw(2).transitionState.emit(t)}),r.YNc(2,Re,6,10,"ng-container",16),r.YNc(3,He,3,3,"ng-template",null,17,r.W1O),r.qZA(),r.BQk()}if(2&e){const e=t.$implicit,n=r.MAs(4);r.xp6(2),r.Q6J("ngIf","Cancelled"!==e)("ngIfElse",n)}}function Ve(e,t){if(1&e&&(r.TgZ(0,"div",8),r.YNc(1,$e,6,10,"ng-container",9),r.TgZ(2,"vdr-dropdown"),r.TgZ(3,"button",10),r._UZ(4,"clr-icon",11),r.qZA(),r.TgZ(5,"vdr-dropdown-menu",12),r.YNc(6,Be,5,2,"ng-container",13),r.qZA(),r.qZA(),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",e.nextSuggestedState()),r.xp6(5),r.Q6J("ngForOf",e.nextOtherStates())}}function Ge(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._uU(2),r.qZA()),2&e){const e=r.oxw();r.Q6J("label",r.lcZ(1,2,"order.tracking-code")),r.xp6(2),r.hij(" ",null==e.fulfillment?null:e.fulfillment.trackingCode,"\n")}}function We(e,t){if(1&e&&r._UZ(0,"vdr-custom-field-control",5),2&e){const e=r.oxw().$implicit,t=r.oxw();r.Q6J("readonly",!0)("compact",!0)("customField",e)("customFieldsFormGroup",t.customFieldFormGroup)}}function Ke(e,t){if(1&e&&(r.ynx(0),r.YNc(1,We,1,4,"vdr-custom-field-control",4),r.BQk()),2&e){const e=t.$implicit,n=r.oxw();r.xp6(1),r.Q6J("ngIf",n.customFieldFormGroup.get(e.name))}}function Xe(e,t){1&e&&r._UZ(0,"clr-icon",2)}function ze(e,t){1&e&&r._UZ(0,"clr-icon",9)}function et(e,t){1&e&&r._UZ(0,"clr-icon",10)}function tt(e,t){1&e&&r._UZ(0,"clr-icon",11)}function nt(e,t){1&e&&(r.TgZ(0,"label",12),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.line-fulfillment-all")," "))}const rt=function(e,t){return{total:e,count:t}};function it(e,t){if(1&e&&(r.TgZ(0,"label",12),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.hij(" ",r.xi3(2,1,"order.line-fulfillment-partial",r.WLB(4,rt,e.line.quantity,e.fulfilledCount))," ")}}function ot(e,t){1&e&&(r.TgZ(0,"label",12),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.line-fulfillment-none")," "))}function st(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",15),r.ALo(1,"translate"),r._uU(2),r.qZA()),2&e){const e=r.oxw().$implicit;r.Q6J("label",r.lcZ(1,2,"order.tracking-code")),r.xp6(2),r.hij(" ",e.fulfillment.trackingCode," ")}}const at=function(e){return{count:e}};function ct(e,t){if(1&e&&(r.TgZ(0,"div",13),r.TgZ(1,"div",14),r._uU(2),r.ALo(3,"translate"),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"vdr-labeled-data",15),r.ALo(6,"translate"),r._uU(7),r.ALo(8,"localeDate"),r.qZA(),r.TgZ(9,"vdr-labeled-data",15),r.ALo(10,"translate"),r._uU(11),r.qZA(),r.YNc(12,st,3,4,"vdr-labeled-data",16),r.qZA()),2&e){const e=t.$implicit;r.xp6(2),r.lnq(" ",r.lcZ(3,8,"order.fulfillment")," #",e.fulfillment.id," (",r.xi3(4,10,"order.item-count",r.VKq(20,at,e.count)),") "),r.xp6(3),r.Q6J("label",r.lcZ(6,13,"common.created-at")),r.xp6(2),r.hij(" ",r.xi3(8,15,e.fulfillment.createdAt,"medium")," "),r.xp6(2),r.Q6J("label",r.lcZ(10,18,"order.fulfillment-method")),r.xp6(2),r.hij(" ",e.fulfillment.method," "),r.xp6(1),r.Q6J("ngIf",e.fulfillment.trackingCode)}}function lt(e,t){if(1&e&&(r.TgZ(0,"vdr-dropdown",1),r.TgZ(1,"button",2),r.YNc(2,ze,1,0,"clr-icon",3),r.YNc(3,et,1,0,"clr-icon",4),r.YNc(4,tt,1,0,"clr-icon",5),r.qZA(),r.TgZ(5,"vdr-dropdown-menu",6),r.YNc(6,nt,3,3,"label",7),r.YNc(7,it,3,7,"label",7),r.YNc(8,ot,3,3,"label",7),r.YNc(9,ct,13,22,"div",8),r.qZA(),r.qZA()),2&e){const e=r.oxw();r.xp6(2),r.Q6J("ngIf","full"===e.fulfillmentStatus),r.xp6(1),r.Q6J("ngIf","partial"===e.fulfillmentStatus),r.xp6(1),r.Q6J("ngIf","none"===e.fulfillmentStatus),r.xp6(2),r.Q6J("ngIf","full"===e.fulfillmentStatus),r.xp6(1),r.Q6J("ngIf","partial"===e.fulfillmentStatus),r.xp6(1),r.Q6J("ngIf","none"===e.fulfillmentStatus),r.xp6(1),r.Q6J("ngForOf",e.fulfillments)}}function dt(e,t){if(1&e&&(r.TgZ(0,"span",1),r.ALo(1,"translate"),r._UZ(2,"clr-icon",2),r.qZA()),2&e){const e=r.oxw();r.Q6J("title",r.xi3(1,1,"order.refunded-count",r.VKq(4,at,e.getRefundedCount())))}}function ut(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._uU(2),r.qZA()),2&e){const e=r.oxw();r.Q6J("label",r.lcZ(1,2,"order.note")),r.xp6(2),r.Oqu(e.modification.note)}}function pt(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._uU(2),r.ALo(3,"localeCurrency"),r.qZA()),2&e){const e=t.$implicit,n=r.oxw();let i;r.Q6J("label",r.lcZ(1,3,"order.surcharges")),r.xp6(2),r.AsE(" ",null==(i=n.getSurcharge(e.id))?null:i.description," ",r.xi3(3,5,null==(i=n.getSurcharge(e.id))?null:i.priceWithTax,n.order.currencyCode),"")}}function gt(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._UZ(2,"vdr-simple-item-list",3),r.qZA()),2&e){const e=r.oxw();r.Q6J("label",r.lcZ(1,2,"order.added-items")),r.xp6(2),r.Q6J("items",e.getAddedItems())}}function ft(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._UZ(2,"vdr-simple-item-list",3),r.qZA()),2&e){const e=r.oxw();r.Q6J("label",r.lcZ(1,2,"order.removed-items")),r.xp6(2),r.Q6J("items",e.getRemovedItems())}}function mt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",9),r.NdJ("click",function(){r.CHM(e);return r.oxw(2).editable=!0}),r._UZ(1,"clr-icon",10),r._uU(2),r.ALo(3,"translate"),r.qZA()}2&e&&(r.xp6(2),r.hij(" ",r.lcZ(3,1,"common.edit")," "))}function ht(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",11),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).onUpdateClick()}),r._UZ(1,"clr-icon",12),r._uU(2),r.ALo(3,"translate"),r.qZA()}if(2&e){const e=r.oxw(2);r.Q6J("disabled",e.customFieldForm.pristine||e.customFieldForm.invalid),r.xp6(2),r.hij(" ",r.lcZ(3,2,"common.update")," ")}}function Zt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",9),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).onCancelClick()}),r._UZ(1,"clr-icon",13),r._uU(2),r.ALo(3,"translate"),r.qZA()}2&e&&(r.xp6(2),r.hij(" ",r.lcZ(3,1,"common.cancel")," "))}function xt(e,t){if(1&e&&(r.TgZ(0,"div",1),r.TgZ(1,"div",2),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"div",3),r.TgZ(5,"div",4),r._UZ(6,"vdr-tabbed-custom-fields",5),r.qZA(),r.qZA(),r.TgZ(7,"div",6),r.YNc(8,mt,4,3,"button",7),r.YNc(9,ht,4,4,"button",8),r.YNc(10,Zt,4,3,"button",7),r.qZA(),r.qZA()),2&e){const e=r.oxw();r.xp6(2),r.hij(" ",r.lcZ(3,10,"common.custom-fields")," "),r.xp6(3),r.ekj("editable",e.editable),r.xp6(1),r.Q6J("customFields",e.customFieldsConfig)("customFieldsFormGroup",e.customFieldForm)("readonly",!e.editable)("compact",!0),r.xp6(2),r.Q6J("ngIf",!e.editable),r.xp6(1),r.Q6J("ngIf",e.editable),r.xp6(1),r.Q6J("ngIf",e.editable)}}function vt(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.order-state-diagram"))}function yt(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.refund-and-cancel-order"))}function At(e,t){if(1&e&&(r.TgZ(0,"div",36),r._uU(1),r.TgZ(2,"div",37),r._uU(3),r.ALo(4,"currency"),r.ALo(5,"number"),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw(3).$implicit,i=r.oxw();r.xp6(1),r.hij(" ",e.description," "),r.xp6(2),r.hij(" ",r.xi3(4,2,r.xi3(5,5,e.amount/100/n.quantity,"1.0-2"),i.order.currencyCode)," ")}}function bt(e,t){if(1&e&&(r.TgZ(0,"vdr-dropdown"),r.TgZ(1,"div",32),r.TgZ(2,"button",33),r._UZ(3,"clr-icon",34),r.qZA(),r.qZA(),r.TgZ(4,"vdr-dropdown-menu"),r.YNc(5,At,6,8,"div",35),r.qZA(),r.qZA()),2&e){const e=r.oxw().ngIf;r.xp6(5),r.Q6J("ngForOf",e)}}function Ct(e,t){if(1&e&&(r.ynx(0),r.YNc(1,bt,6,1,"vdr-dropdown",26),r.BQk()),2&e){const e=t.ngIf;r.xp6(1),r.Q6J("ngIf",e.length)}}function qt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"input",38),r.NdJ("ngModelChange",function(t){r.CHM(e);const n=r.oxw().$implicit;return r.oxw().lineQuantities[n.id].quantity=t})("input",function(){r.CHM(e);const t=r.oxw().$implicit,n=r.oxw();return n.handleZeroQuantity(n.lineQuantities[t.id])}),r.qZA()}if(2&e){const e=r.oxw().$implicit,t=r.oxw();r.Q6J("ngModel",t.lineQuantities[e.id].quantity)("max",e.quantity)}}function Tt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"input",39),r.NdJ("ngModelChange",function(t){r.CHM(e);const n=r.oxw().$implicit;return r.oxw().lineQuantities[n.id].refund=t}),r.qZA()}if(2&e){const e=r.oxw().$implicit,t=r.oxw();r.Q6J("disabled",0===t.lineQuantities[e.id].quantity)("ngModel",t.lineQuantities[e.id].refund)}}function Ot(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"input",39),r.NdJ("ngModelChange",function(t){r.CHM(e);const n=r.oxw().$implicit;return r.oxw().lineQuantities[n.id].cancel=t}),r.qZA()}if(2&e){const e=r.oxw().$implicit,t=r.oxw();r.Q6J("disabled",0===t.lineQuantities[e.id].quantity)("ngModel",t.lineQuantities[e.id].cancel)}}function _t(e,t){if(1&e&&(r.TgZ(0,"tr",18),r.TgZ(1,"td",19),r._UZ(2,"img",20),r.ALo(3,"assetPreview"),r.qZA(),r.TgZ(4,"td",21),r._uU(5),r.qZA(),r.TgZ(6,"td",22),r._uU(7),r.qZA(),r.TgZ(8,"td",23),r._uU(9),r._UZ(10,"vdr-line-refunds",24),r.qZA(),r.TgZ(11,"td",23),r._uU(12),r.ALo(13,"localeCurrency"),r.qZA(),r.TgZ(14,"td",23),r.TgZ(15,"div",25),r._uU(16),r.ALo(17,"localeCurrency"),r.YNc(18,Ct,2,1,"ng-container",26),r.qZA(),r.qZA(),r.TgZ(19,"td",27),r.YNc(20,qt,1,2,"input",28),r.qZA(),r.TgZ(21,"td",29),r.TgZ(22,"div",30),r.YNc(23,Tt,1,2,"input",31),r.qZA(),r.qZA(),r.TgZ(24,"td",29),r.TgZ(25,"div",30),r.YNc(26,Ot,1,2,"input",31),r.qZA(),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw();r.xp6(2),r.Q6J("src",r.xi3(3,12,e.featuredAsset,"tiny"),r.LSH),r.xp6(3),r.Oqu(e.productVariant.name),r.xp6(2),r.Oqu(e.productVariant.sku),r.xp6(2),r.hij(" ",e.quantity," "),r.xp6(1),r.Q6J("line",e)("payments",n.order.payments),r.xp6(2),r.hij(" ",r.xi3(13,15,e.unitPriceWithTax,n.order.currencyCode)," "),r.xp6(4),r.hij(" ",r.xi3(17,18,e.proratedUnitPriceWithTax,n.order.currencyCode)," "),r.xp6(2),r.Q6J("ngIf",e.discounts),r.xp6(2),r.Q6J("ngIf",n.lineCanBeRefundedOrCancelled(e)),r.xp6(3),r.Q6J("ngIf",n.lineCanBeRefundedOrCancelled(e)),r.xp6(3),r.Q6J("ngIf",n.lineCanBeRefundedOrCancelled(e))}}function It(e,t){if(1&e&&(r.TgZ(0,"option",40),r._uU(1),r.ALo(2,"localeCurrency"),r.qZA()),2&e){const e=t.$implicit,n=r.oxw();r.Q6J("ngValue",e)("disabled","Settled"!==e.state),r.xp6(1),r.lnq(" #",e.id," ",e.method,": ",r.xi3(2,5,e.amount,n.order.currencyCode)," ")}}const wt=function(e,t){return{min:e,max:t}};function Lt(e,t){if(1&e&&(r.TgZ(0,"div",41),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"currency"),r.ALo(4,"localeCurrency"),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.hij(" ",r.xi3(2,1,"order.refund-total-error",r.WLB(10,wt,r.xi3(3,4,0,e.order.currencyCode),r.xi3(4,7,e.settledPaymentsTotal,e.order.currencyCode)))," ")}}function Ft(e,t){1&e&&(r.TgZ(0,"div",42),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.refund-total-warning")," "))}const Nt=function(e){return{amount:e}};function Jt(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"localeCurrency"),r.BQk()),2&e){const e=r.oxw(2);r.xp6(1),r.hij(" ",r.xi3(2,1,"order.refund-with-amount",r.VKq(7,Nt,r.xi3(3,4,e.refundTotal,e.order.currencyCode)))," ")}}function Ut(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.hij(" ",r.lcZ(1,1,"order.cancel-selected-items")," ")}function Mt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",43),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",44),r.NdJ("click",function(){return r.CHM(e),r.oxw().select()}),r.YNc(4,Jt,4,9,"ng-container",45),r.YNc(5,Ut,2,3,"ng-template",null,46,r.W1O),r.qZA()}if(2&e){const e=r.MAs(6),t=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,4,"common.cancel")),r.xp6(2),r.Q6J("disabled",!t.canSubmit()),r.xp6(1),r.Q6J("ngIf",t.isRefunding())("ngIfElse",e)}}function St(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.settle-refund"))}function Pt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",4),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",5),r.NdJ("click",function(){return r.CHM(e),r.oxw().submit()}),r._uU(4),r.ALo(5,"translate"),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,3,"common.cancel")),r.xp6(2),r.Q6J("disabled",!e.transactionId),r.xp6(1),r.hij(" ",r.lcZ(5,5,"order.settle-refund")," ")}}const Qt=function(e){return{method:e}};function kt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",16),r.NdJ("click",function(){r.CHM(e);const t=r.oxw().ngIf;return r.oxw().addManualPayment(t)}),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"localeCurrency"),r.qZA()}if(2&e){const e=r.oxw().ngIf,t=r.oxw();r.xp6(1),r.AsE(" ",r.lcZ(2,2,"order.add-payment-to-order")," (",r.xi3(3,4,t.outstandingPaymentAmount(e),e.currencyCode),") ")}}function Dt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",16),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).transitionToState("ArrangingAdditionalPayment")}),r._uU(1),r.ALo(2,"translate"),r.qZA()}2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.arrange-additional-payment")," "))}function Yt(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"button",14),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).transitionToModifying()}),r._UZ(2,"clr-icon",17),r._uU(3),r.ALo(4,"translate"),r.qZA(),r._UZ(5,"div",13),r.BQk()}2&e&&(r.xp6(3),r.hij(" ",r.lcZ(4,1,"order.modify-order")," "))}function jt(e,t){1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.refund-and-cancel-order")," "))}function Et(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.hij(" ",r.lcZ(1,1,"order.cancel-order")," ")}function $t(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",14),r.NdJ("click",function(){r.CHM(e);const t=r.oxw().ngIf;return r.oxw().cancelOrRefund(t)}),r._UZ(1,"clr-icon",18),r.YNc(2,jt,3,3,"ng-container",19),r.YNc(3,Et,2,3,"ng-template",null,20,r.W1O),r.qZA()}if(2&e){const e=r.MAs(4),t=r.oxw().ngIf,n=r.oxw();r.xp6(2),r.Q6J("ngIf",n.orderHasSettledPayments(t))("ngIfElse",e)}}function Rt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",14),r.NdJ("click",function(){const t=r.CHM(e).$implicit;return r.oxw(3).transitionToState(t)}),r._UZ(1,"clr-icon",22),r._uU(2),r.ALo(3,"translate"),r.ALo(4,"translate"),r.ALo(5,"stateI18nToken"),r.qZA()}if(2&e){const e=t.$implicit;r.xp6(2),r.hij(" ",r.xi3(3,1,"order.transition-to-state",r.VKq(8,ee,r.lcZ(4,4,r.lcZ(5,6,e))))," ")}}function Ht(e,t){if(1&e&&(r.ynx(0),r._UZ(1,"div",13),r.YNc(2,Rt,6,10,"button",21),r.ALo(3,"async"),r.BQk()),2&e){const e=r.oxw(2);r.xp6(2),r.Q6J("ngForOf",r.lcZ(3,1,e.nextStates$))}}function Bt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"vdr-action-bar"),r.TgZ(1,"vdr-ab-left"),r.TgZ(2,"div",1),r._UZ(3,"vdr-entity-info",2),r.ALo(4,"async"),r.TgZ(5,"vdr-order-state-label",3),r.TgZ(6,"button",4),r.NdJ("click",function(){return r.CHM(e),r.oxw().openStateDiagram()}),r.ALo(7,"translate"),r._UZ(8,"clr-icon",5),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"vdr-ab-right"),r._UZ(10,"vdr-action-bar-items",6),r.YNc(11,kt,4,7,"button",7),r.YNc(12,Dt,3,3,"button",7),r.TgZ(13,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().fulfillOrder()}),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"vdr-dropdown"),r.TgZ(17,"button",9),r._UZ(18,"clr-icon",10),r.qZA(),r.TgZ(19,"vdr-dropdown-menu",11),r.YNc(20,Yt,6,3,"ng-container",0),r.YNc(21,$t,5,2,"button",12),r.YNc(22,Ht,4,3,"ng-container",0),r.ALo(23,"async"),r._UZ(24,"div",13),r.TgZ(25,"button",14),r.NdJ("click",function(){const t=r.CHM(e).ngIf;return r.oxw().manuallyTransitionToState(t)}),r._UZ(26,"clr-icon",15),r._uU(27),r.ALo(28,"translate"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();let i;r.xp6(3),r.Q6J("entity",r.lcZ(4,11,n.entity$)),r.xp6(2),r.Q6J("state",e.state),r.xp6(1),r.Q6J("title",r.lcZ(7,13,"order.order-state-diagram")),r.xp6(5),r.Q6J("ngIf",("ArrangingPayment"===e.state||"ArrangingAdditionalPayment"===e.state)&&(n.hasUnsettledModifications(e)||0<n.outstandingPaymentAmount(e))),r.xp6(1),r.Q6J("ngIf",!1===e.active&&"ArrangingAdditionalPayment"!==e.state&&"ArrangingPayment"!==e.state&&0<n.outstandingPaymentAmount(e)),r.xp6(1),r.Q6J("disabled",!n.canAddFulfillment(e)),r.xp6(1),r.hij(" ",r.lcZ(15,15,"order.fulfill-order")," "),r.xp6(6),r.Q6J("ngIf",e.nextStates.includes("Modifying")),r.xp6(1),r.Q6J("ngIf",e.nextStates.includes("Cancelled")),r.xp6(1),r.Q6J("ngIf",null==(i=r.lcZ(23,17,n.nextStates$))?null:i.length),r.xp6(5),r.hij(" ",r.lcZ(28,19,"order.manually-transition-to-state")," ")}}function Vt(e,t){if(1&e&&(r.TgZ(0,"tr"),r.TgZ(1,"td"),r._uU(2),r.qZA(),r.TgZ(3,"td"),r._uU(4),r.ALo(5,"percent"),r.qZA(),r.TgZ(6,"td"),r._uU(7),r.ALo(8,"localeCurrency"),r.qZA(),r.TgZ(9,"td"),r._uU(10),r.ALo(11,"localeCurrency"),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw().ngIf;r.xp6(2),r.Oqu(e.description),r.xp6(2),r.Oqu(r.lcZ(5,4,e.taxRate/100)),r.xp6(3),r.Oqu(r.xi3(8,6,e.taxBase,n.currencyCode)),r.xp6(3),r.Oqu(r.xi3(11,9,e.taxTotal,n.currencyCode))}}function Gt(e,t){1&e&&(r.TgZ(0,"h6"),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.shipping-address")," "))}function Wt(e,t){1&e&&(r.TgZ(0,"h6"),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.billing-address")," "))}function Kt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"vdr-order-payment-card",39),r.NdJ("settlePayment",function(t){return r.CHM(e),r.oxw(3).settlePayment(t)})("transitionPaymentState",function(t){return r.CHM(e),r.oxw(3).transitionPaymentState(t)})("settleRefund",function(t){return r.CHM(e),r.oxw(3).settleRefund(t)}),r.qZA()}if(2&e){const e=t.$implicit,n=r.oxw(2).ngIf;r.Q6J("currencyCode",n.currencyCode)("payment",e)}}function Xt(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Kt,1,2,"vdr-order-payment-card",38),r.BQk()),2&e){const e=r.oxw().ngIf;r.xp6(1),r.Q6J("ngForOf",e.payments)}}function zt(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"vdr-fulfillment-card",40),r.NdJ("transitionState",function(t){const n=r.CHM(e).$implicit;return r.oxw(2).transitionFulfillment(n.id,t)}),r.qZA(),r.BQk()}if(2&e){const e=t.$implicit,n=r.oxw().ngIf;r.xp6(1),r.Q6J("fulfillment",e)("order",n)}}function en(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"div",23),r.TgZ(2,"div",24),r._UZ(3,"vdr-order-table",25),r.TgZ(4,"h4"),r._uU(5),r.ALo(6,"translate"),r.qZA(),r.TgZ(7,"table",26),r.TgZ(8,"thead"),r.TgZ(9,"tr"),r.TgZ(10,"th"),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"th"),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"th"),r._uU(17),r.ALo(18,"translate"),r.qZA(),r.TgZ(19,"th"),r._uU(20),r.ALo(21,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(22,"tbody"),r.YNc(23,Vt,12,12,"tr",27),r.qZA(),r.qZA(),r._UZ(24,"vdr-custom-detail-component-host",28),r.TgZ(25,"vdr-order-history",29),r.NdJ("addNote",function(t){return r.CHM(e),r.oxw().addNote(t)})("updateNote",function(t){return r.CHM(e),r.oxw().updateNote(t)})("deleteNote",function(t){return r.CHM(e),r.oxw().deleteNote(t)}),r.ALo(26,"async"),r.qZA(),r.qZA(),r.TgZ(27,"div",30),r.TgZ(28,"vdr-order-custom-fields-card",31),r.NdJ("updateClick",function(t){return r.CHM(e),r.oxw().updateCustomFields(t)}),r.qZA(),r.TgZ(29,"div",32),r.TgZ(30,"div",33),r._uU(31),r.ALo(32,"translate"),r.qZA(),r.TgZ(33,"div",34),r.TgZ(34,"div",35),r._UZ(35,"vdr-customer-label",36),r.YNc(36,Gt,3,3,"h6",0),r._UZ(37,"vdr-formatted-address",37),r.YNc(38,Wt,3,3,"h6",0),r._UZ(39,"vdr-formatted-address",37),r.qZA(),r.qZA(),r.qZA(),r.YNc(40,Xt,2,1,"ng-container",0),r.YNc(41,zt,2,2,"ng-container",27),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();r.xp6(3),r.Q6J("order",e)("orderLineCustomFields",n.orderLineCustomFields),r.xp6(2),r.Oqu(r.lcZ(6,22,"order.tax-summary")),r.xp6(6),r.Oqu(r.lcZ(12,24,"common.description")),r.xp6(3),r.Oqu(r.lcZ(15,26,"order.tax-rate")),r.xp6(3),r.Oqu(r.lcZ(18,28,"order.tax-base")),r.xp6(3),r.Oqu(r.lcZ(21,30,"order.tax-total")),r.xp6(3),r.Q6J("ngForOf",e.taxSummary),r.xp6(1),r.Q6J("entity$",n.entity$)("detailForm",n.detailForm),r.xp6(1),r.Q6J("order",e)("history",r.lcZ(26,32,n.history$)),r.xp6(3),r.Q6J("customFieldsConfig",n.customFields)("customFieldValues",e.customFields),r.xp6(3),r.hij(" ",r.lcZ(32,34,"order.customer")," "),r.xp6(4),r.Q6J("customer",e.customer),r.xp6(1),r.Q6J("ngIf",n.getOrderAddressLines(e.shippingAddress).length),r.xp6(1),r.Q6J("address",e.shippingAddress),r.xp6(1),r.Q6J("ngIf",n.getOrderAddressLines(e.billingAddress).length),r.xp6(1),r.Q6J("address",e.billingAddress),r.xp6(1),r.Q6J("ngIf",e.payments&&e.payments.length),r.xp6(1),r.Q6J("ngForOf",e.fulfillments)}}function tn(e,t){1&e&&(r._uU(0),r.ALo(1,"translate")),2&e&&r.Oqu(r.lcZ(1,1,"order.confirm-modifications"))}function nn(e,t){if(1&e&&(r.TgZ(0,"option",9),r._uU(1),r.ALo(2,"localeCurrency"),r.qZA()),2&e){const e=t.$implicit,n=r.oxw(2);r.Q6J("ngValue",e),r.xp6(1),r.lnq(" #",e.id," ",e.method,": ",r.xi3(2,4,e.amount,n.order.currencyCode)," ")}}function rn(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"clr-select-container"),r.TgZ(2,"label"),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"select",5),r.NdJ("ngModelChange",function(t){r.CHM(e);return r.oxw().selectedPayment=t}),r.YNc(6,nn,3,7,"option",6),r.qZA(),r.qZA(),r.TgZ(7,"label",7),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.TgZ(10,"textarea",8),r.NdJ("ngModelChange",function(t){r.CHM(e);return r.oxw().refundNote=t}),r.qZA(),r.qZA()}if(2&e){const e=r.oxw();r.xp6(3),r.Oqu(r.lcZ(4,5,"order.payment-to-refund")),r.xp6(2),r.Q6J("ngModel",e.selectedPayment),r.xp6(1),r.Q6J("ngForOf",e.order.payments),r.xp6(2),r.Oqu(r.lcZ(9,7,"order.refund-cancellation-reason")),r.xp6(2),r.Q6J("ngModel",e.refundNote)}}function on(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",10),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"button",11),r.NdJ("click",function(){return r.CHM(e),r.oxw().submit()}),r._uU(4),r.ALo(5,"translate"),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Oqu(r.lcZ(2,3,"common.cancel")),r.xp6(2),r.Q6J("disabled",e.priceDifference<0&&!e.selectedPayment),r.xp6(1),r.hij(" ",r.lcZ(5,5,"common.confirm")," ")}}function sn(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"vdr-action-bar"),r.TgZ(1,"vdr-ab-left"),r.TgZ(2,"div",1),r._UZ(3,"vdr-entity-info",2),r.ALo(4,"async"),r._UZ(5,"vdr-order-state-label",3),r.qZA(),r.qZA(),r.TgZ(6,"vdr-ab-right"),r.TgZ(7,"button",4),r.NdJ("click",function(){const t=r.CHM(e).ngIf;return r.oxw().transitionToPriorState(t)}),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();r.xp6(3),r.Q6J("entity",r.lcZ(4,3,n.entity$)),r.xp6(2),r.Q6J("state",e.state),r.xp6(3),r.hij(" ",r.lcZ(9,5,"order.cancel-modification")," ")}}function an(e,t){1&e&&(r.TgZ(0,"th"),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"common.custom-fields")))}function cn(e,t){if(1&e&&(r._UZ(0,"img",41),r.ALo(1,"assetPreview")),2&e){const e=r.oxw().$implicit;r.Q6J("src",r.xi3(1,1,e.featuredAsset,"tiny"),r.LSH)}}const ln=function(e){return[e]};function dn(e,t){if(1&e&&(r.TgZ(0,"td",42),r._UZ(1,"vdr-tabbed-custom-fields",43),r.qZA()),2&e){const e=r.oxw().index,t=r.oxw(2);r.xp6(1),r.Q6J("customFields",t.orderLineCustomFields)("customFieldsFormGroup",t.orderLineCustomFieldsFormArray.get(r.VKq(3,ln,e)))("compact",!0)}}function un(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"tr",29),r.TgZ(1,"td",30),r.YNc(2,cn,2,4,"img",31),r.qZA(),r.TgZ(3,"td",32),r._uU(4),r.qZA(),r.TgZ(5,"td",33),r._uU(6),r.qZA(),r.TgZ(7,"td",34),r._uU(8),r.ALo(9,"localeCurrency"),r.TgZ(10,"div",16),r.ALo(11,"translate"),r._uU(12),r.ALo(13,"localeCurrency"),r.qZA(),r.qZA(),r.TgZ(14,"td",35),r.TgZ(15,"input",36),r.NdJ("input",function(t){const n=r.CHM(e).$implicit;return r.oxw(2).updateLineQuantity(n,t.target.value)}),r.qZA(),r._UZ(16,"vdr-line-refunds",37),r._UZ(17,"vdr-line-fulfillment",38),r.qZA(),r.YNc(18,dn,2,5,"td",39),r.TgZ(19,"td",40),r._uU(20),r.ALo(21,"localeCurrency"),r.TgZ(22,"div",16),r.ALo(23,"translate"),r._uU(24),r.ALo(25,"localeCurrency"),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.$implicit,n=r.oxw().ngIf,i=r.oxw();r.ekj("is-cancelled",0===e.quantity)("modified",i.isLineModified(e)),r.xp6(2),r.Q6J("ngIf",e.featuredAsset),r.xp6(2),r.Oqu(e.productVariant.name),r.xp6(2),r.Oqu(e.productVariant.sku),r.xp6(2),r.hij(" ",r.xi3(9,19,e.unitPriceWithTax,n.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(11,22,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(13,24,e.unitPrice,n.currencyCode)," "),r.xp6(3),r.Q6J("value",e.quantity),r.xp6(1),r.Q6J("line",e)("payments",n.payments),r.xp6(1),r.Q6J("line",e)("orderState",n.state),r.xp6(1),r.Q6J("ngIf",i.orderLineCustomFields.length),r.xp6(2),r.hij(" ",r.xi3(21,27,e.linePriceWithTax,n.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(23,30,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(25,32,e.linePrice,n.currencyCode)," ")}}function pn(e,t){if(1&e&&(r._UZ(0,"img",41),r.ALo(1,"assetPreview")),2&e){const e=r.oxw().$implicit;r.Q6J("src",r.xi3(1,1,e.productAsset,"tiny"),r.LSH)}}function gn(e,t){if(1&e&&(r.ynx(0),r._UZ(1,"vdr-custom-field-control",48),r.BQk()),2&e){const e=t.$implicit,n=r.oxw(2).index,i=r.oxw(2);r.xp6(1),r.Q6J("customField",e)("customFieldsFormGroup",i.addItemCustomFieldsFormArray.get(r.VKq(3,ln,n)))("compact",!0)}}function fn(e,t){if(1&e&&(r.TgZ(0,"td",42),r.YNc(1,gn,2,5,"ng-container",47),r.qZA()),2&e){const e=r.oxw(3);r.xp6(1),r.Q6J("ngForOf",e.orderLineCustomFields)}}function mn(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"tr",44),r.TgZ(1,"td",30),r.YNc(2,pn,2,4,"img",31),r.qZA(),r.TgZ(3,"td",32),r._uU(4),r.qZA(),r.TgZ(5,"td",33),r._uU(6),r.qZA(),r.TgZ(7,"td",34),r._uU(8),r.ALo(9,"localeCurrency"),r.TgZ(10,"div",16),r.ALo(11,"translate"),r._uU(12),r.ALo(13,"localeCurrency"),r.qZA(),r.qZA(),r.TgZ(14,"td",35),r.TgZ(15,"input",36),r.NdJ("input",function(t){const n=r.CHM(e).$implicit;return r.oxw(2).updateAddedItemQuantity(n,t.target.value)}),r.qZA(),r.TgZ(16,"button",45),r.NdJ("click",function(){const t=r.CHM(e).index;return r.oxw(2).removeAddedItem(t)}),r._UZ(17,"clr-icon",46),r.qZA(),r.qZA(),r.YNc(18,fn,2,1,"td",39),r.TgZ(19,"td",40),r._uU(20),r.ALo(21,"currency"),r.TgZ(22,"div",16),r.ALo(23,"translate"),r._uU(24),r.ALo(25,"currency"),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.$implicit,n=r.oxw().ngIf,i=r.oxw();r.xp6(2),r.Q6J("ngIf",e.productAsset),r.xp6(2),r.Oqu(e.productVariantName),r.xp6(2),r.Oqu(e.sku),r.xp6(2),r.hij(" ",r.xi3(9,11,e.priceWithTax,n.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(11,14,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(13,16,e.price,n.currencyCode)," "),r.xp6(3),r.Q6J("value",e.quantity),r.xp6(3),r.Q6J("ngIf",i.orderLineCustomFields.length),r.xp6(2),r.hij(" ",r.xi3(21,19,e.priceWithTax*e.quantity/100,n.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(23,22,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(25,24,e.price*e.quantity/100,n.currencyCode)," ")}}function hn(e,t){1&e&&r._UZ(0,"td")}function Zn(e,t){if(1&e&&(r.TgZ(0,"tr",49),r.TgZ(1,"td",50),r._uU(2),r.qZA(),r.TgZ(3,"td",33),r._uU(4),r.qZA(),r._UZ(5,"td",51),r._UZ(6,"td"),r.YNc(7,hn,1,0,"td",0),r.TgZ(8,"td",40),r._uU(9),r.ALo(10,"localeCurrency"),r.TgZ(11,"div",16),r.ALo(12,"translate"),r._uU(13),r.ALo(14,"localeCurrency"),r.qZA(),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw().ngIf,i=r.oxw();r.xp6(2),r.Oqu(e.description),r.xp6(2),r.Oqu(e.sku),r.xp6(3),r.Q6J("ngIf",i.orderLineCustomFields.length),r.xp6(2),r.hij(" ",r.xi3(10,6,e.priceWithTax,n.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(12,9,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(14,11,e.price,n.currencyCode)," ")}}function xn(e,t){1&e&&r._UZ(0,"td")}function vn(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"localeCurrency"),r.TgZ(3,"div",16),r.ALo(4,"translate"),r._uU(5),r.ALo(6,"localeCurrency"),r.qZA(),r.BQk()),2&e){const e=t.ngIf,n=r.oxw(2).ngIf;r.xp6(1),r.hij(" ",r.xi3(2,3,e.priceWithTax,n.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(4,6,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(6,8,e.price,n.currencyCode)," ")}}function yn(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"tr",52),r.TgZ(1,"td",50),r._uU(2),r.TgZ(3,"button",45),r.NdJ("click",function(){const t=r.CHM(e).index;return r.oxw(2).removeSurcharge(t)}),r._UZ(4,"clr-icon",46),r.qZA(),r.qZA(),r.TgZ(5,"td",33),r._uU(6),r.qZA(),r._UZ(7,"td",51),r._UZ(8,"td"),r.YNc(9,xn,1,0,"td",0),r.TgZ(10,"td",40),r.YNc(11,vn,7,11,"ng-container",0),r.qZA(),r.qZA()}if(2&e){const e=t.$implicit,n=r.oxw(2);r.xp6(2),r.hij(" ",e.description," "),r.xp6(4),r.Oqu(e.sku),r.xp6(3),r.Q6J("ngIf",n.orderLineCustomFields.length),r.xp6(2),r.Q6J("ngIf",n.getSurchargePrices(e))}}function An(e,t){1&e&&r._UZ(0,"td")}function bn(e,t){if(1&e&&(r._UZ(0,"img",59),r.ALo(1,"assetPreview")),2&e){const e=t.ngIf;r.Q6J("src",r.xi3(1,1,e,"tiny"),r.LSH)}}function Cn(e,t){if(1&e&&(r.TgZ(0,"div",56),r.YNc(1,bn,2,4,"img",57),r.TgZ(2,"div"),r.TgZ(3,"strong",58),r._uU(4),r.qZA(),r.TgZ(5,"small"),r._uU(6),r.qZA(),r.TgZ(7,"div"),r._uU(8),r.ALo(9,"localeCurrency"),r.qZA(),r.qZA(),r.qZA()),2&e){const e=r.oxw(2).ngIf,t=r.oxw();r.xp6(1),r.Q6J("ngIf",t.addItemSelectedVariant.productAsset),r.xp6(3),r.Oqu(t.addItemSelectedVariant.productVariantName),r.xp6(2),r.Oqu(t.addItemSelectedVariant.sku),r.xp6(2),r.hij(" ",r.xi3(9,4,t.getSelectedItemPrice(t.addItemSelectedVariant),e.currencyCode)," ")}}function qn(e,t){if(1&e&&(r.ynx(0),r._UZ(1,"vdr-custom-field-control",60),r.BQk()),2&e){const e=t.$implicit,n=r.oxw(3);r.xp6(1),r.Q6J("readonly",!n.addItemSelectedVariant)("customField",e)("customFieldsFormGroup",n.addItemCustomFieldsForm)("compact",!0)}}function Tn(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"clr-accordion-content"),r.TgZ(1,"vdr-product-selector",53),r.NdJ("productSelected",function(t){r.CHM(e);return r.oxw(2).addItemSelectedVariant=t}),r.qZA(),r.YNc(2,Cn,10,7,"div",54),r.YNc(3,qn,2,4,"ng-container",47),r.TgZ(4,"button",55),r.NdJ("click",function(){r.CHM(e);const t=r.oxw(2);return t.addItemToOrder(t.addItemSelectedVariant)}),r._uU(5),r.ALo(6,"translate"),r.qZA(),r.qZA()}if(2&e){const e=r.oxw(2);r.xp6(2),r.Q6J("ngIf",e.addItemSelectedVariant),r.xp6(1),r.Q6J("ngForOf",e.orderLineCustomFields),r.xp6(1),r.Q6J("disabled",!e.addItemSelectedVariant||e.addItemCustomFieldsForm.invalid),r.xp6(1),r.hij(" ",r.lcZ(6,4,"order.add-item-to-order")," ")}}function On(e,t){if(1&e&&(r.TgZ(0,"clr-accordion-content"),r._UZ(1,"vdr-coupon-code-selector",61),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("control",e.couponCodesControl)}}const _n=function(e){return{rate:e}};function In(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"clr-accordion-content"),r.TgZ(1,"form",62),r.NdJ("submit",function(){r.CHM(e);const t=r.oxw(2);return t.addSurcharge(t.surchargeForm.value)}),r.TgZ(2,"vdr-form-field",63),r.ALo(3,"translate"),r._UZ(4,"input",64),r.qZA(),r.TgZ(5,"vdr-form-field",65),r.ALo(6,"translate"),r._UZ(7,"input",66),r.qZA(),r.TgZ(8,"vdr-form-field",67),r.ALo(9,"translate"),r._UZ(10,"vdr-currency-input",68),r.qZA(),r.TgZ(11,"vdr-form-field",69),r.ALo(12,"translate"),r._UZ(13,"input",70),r.qZA(),r.TgZ(14,"vdr-form-field",71),r.ALo(15,"translate"),r.TgZ(16,"vdr-affixed-input",72),r._UZ(17,"input",73),r.qZA(),r.qZA(),r.TgZ(18,"vdr-form-field",74),r.ALo(19,"translate"),r._UZ(20,"input",75),r.qZA(),r.TgZ(21,"button",76),r._uU(22),r.ALo(23,"translate"),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=r.oxw().ngIf,t=r.oxw();let n,i;r.xp6(1),r.Q6J("formGroup",t.surchargeForm),r.xp6(1),r.Q6J("label",r.lcZ(3,10,"common.description")),r.xp6(3),r.Q6J("label",r.lcZ(6,12,"order.product-sku")),r.xp6(3),r.Q6J("label",r.lcZ(9,14,"common.price")),r.xp6(2),r.Q6J("currencyCode",e.currencyCode),r.xp6(1),r.Q6J("label",r.xi3(12,16,"catalog.price-includes-tax-at",r.VKq(25,_n,null==(n=t.surchargeForm.get("taxRate"))?null:n.value))),r.xp6(3),r.Q6J("label",r.lcZ(15,19,"order.tax-rate")),r.xp6(4),r.Q6J("label",r.lcZ(19,21,"order.tax-description")),r.xp6(3),r.Q6J("disabled",t.surchargeForm.invalid||t.surchargeForm.pristine||0===(null==(i=t.surchargeForm.get("price"))?null:i.value)),r.xp6(1),r.hij(" ",r.lcZ(23,23,"order.add-surcharge")," ")}}function wn(e,t){if(1&e&&(r.TgZ(0,"clr-accordion-content"),r._UZ(1,"vdr-address-form",77),r.ALo(2,"async"),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("formGroup",e.shippingAddressForm)("availableCountries",r.lcZ(2,3,e.availableCountries$))("customFields",e.addressCustomFields)}}function Ln(e,t){if(1&e&&(r.TgZ(0,"clr-accordion-content"),r._UZ(1,"vdr-address-form",77),r.ALo(2,"async"),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("formGroup",e.billingAddressForm)("availableCountries",r.lcZ(2,3,e.availableCountries$))("customFields",e.addressCustomFields)}}function Fn(e,t){if(1&e&&(r.TgZ(0,"li"),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.hij(" ",r.xi3(2,1,"order.modification-adding-items",r.VKq(4,at,null==e.modifyOrderInput.addItems?null:e.modifyOrderInput.addItems.length))," ")}}function Nn(e,t){if(1&e&&(r.TgZ(0,"li"),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.hij(" ",r.xi3(2,1,"order.modification-adjusting-lines",r.VKq(4,at,null==e.modifyOrderInput.adjustOrderLines?null:e.modifyOrderInput.adjustOrderLines.length))," ")}}function Jn(e,t){if(1&e&&(r.TgZ(0,"li"),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.hij(" ",r.xi3(2,1,"order.modification-adding-surcharges",r.VKq(4,at,null==e.modifyOrderInput.surcharges?null:e.modifyOrderInput.surcharges.length))," ")}}function Un(e,t){1&e&&(r.TgZ(0,"li"),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.modification-updating-shipping-address")," "))}function Mn(e,t){1&e&&(r.TgZ(0,"li"),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.modification-updating-billing-address")," "))}function Sn(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"div",5),r.TgZ(2,"div",6),r.TgZ(3,"table",7),r.TgZ(4,"thead"),r.TgZ(5,"tr"),r._UZ(6,"th"),r.TgZ(7,"th"),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.TgZ(10,"th"),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"th"),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"th"),r._uU(17),r.ALo(18,"translate"),r.qZA(),r.YNc(19,an,3,3,"th",0),r.TgZ(20,"th"),r._uU(21),r.ALo(22,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(23,"tbody"),r.YNc(24,un,26,35,"tr",8),r.YNc(25,mn,26,27,"tr",9),r.YNc(26,Zn,15,14,"tr",10),r.YNc(27,yn,12,4,"tr",11),r.TgZ(28,"tr",12),r.TgZ(29,"td",13),r._uU(30),r.ALo(31,"translate"),r.qZA(),r.TgZ(32,"td",14),r._uU(33),r.qZA(),r._UZ(34,"td",15),r.YNc(35,An,1,0,"td",0),r.TgZ(36,"td",14),r._uU(37),r.ALo(38,"localeCurrency"),r.TgZ(39,"div",16),r.ALo(40,"translate"),r._uU(41),r.ALo(42,"localeCurrency"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(43,"h4",17),r._uU(44),r.ALo(45,"translate"),r.qZA(),r.TgZ(46,"clr-accordion"),r.TgZ(47,"clr-accordion-panel"),r.TgZ(48,"clr-accordion-title"),r._uU(49),r.ALo(50,"translate"),r.qZA(),r.YNc(51,Tn,7,6,"clr-accordion-content",18),r.qZA(),r.TgZ(52,"clr-accordion-panel"),r.TgZ(53,"clr-accordion-title"),r._uU(54),r.ALo(55,"translate"),r.qZA(),r.YNc(56,On,2,1,"clr-accordion-content",18),r.qZA(),r.TgZ(57,"clr-accordion-panel"),r.TgZ(58,"clr-accordion-title"),r._uU(59),r.ALo(60,"translate"),r.qZA(),r.YNc(61,In,24,27,"clr-accordion-content",18),r.qZA(),r.TgZ(62,"clr-accordion-panel"),r.TgZ(63,"clr-accordion-title"),r._uU(64),r.ALo(65,"translate"),r.qZA(),r.YNc(66,wn,3,5,"clr-accordion-content",18),r.qZA(),r.TgZ(67,"clr-accordion-panel"),r.TgZ(68,"clr-accordion-title"),r._uU(69),r.ALo(70,"translate"),r.qZA(),r.YNc(71,Ln,3,5,"clr-accordion-content",18),r.qZA(),r.qZA(),r.qZA(),r.TgZ(72,"div",19),r.TgZ(73,"div",20),r.TgZ(74,"div",21),r._uU(75),r.ALo(76,"translate"),r.qZA(),r.TgZ(77,"div",22),r.TgZ(78,"ul"),r.YNc(79,Fn,3,6,"li",0),r.YNc(80,Nn,3,6,"li",0),r.YNc(81,Jn,3,6,"li",0),r.YNc(82,Un,3,3,"li",0),r.YNc(83,Mn,3,3,"li",0),r.qZA(),r.qZA(),r.TgZ(84,"div",22),r.TgZ(85,"label",23),r._uU(86),r.ALo(87,"translate"),r.qZA(),r.TgZ(88,"textarea",24),r.NdJ("ngModelChange",function(t){r.CHM(e);return r.oxw().note=t}),r.qZA(),r.TgZ(89,"clr-checkbox-wrapper",25),r.TgZ(90,"input",26),r.NdJ("ngModelChange",function(t){r.CHM(e);return r.oxw().recalculateShipping=t}),r.qZA(),r.TgZ(91,"label"),r._uU(92),r.ALo(93,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(94,"div",27),r.TgZ(95,"button",28),r.NdJ("click",function(){const t=r.CHM(e).ngIf;return r.oxw().previewAndModify(t)}),r._uU(96),r.ALo(97,"translate"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();r.xp6(8),r.Oqu(r.lcZ(9,35,"order.product-name")),r.xp6(3),r.Oqu(r.lcZ(12,37,"order.product-sku")),r.xp6(3),r.Oqu(r.lcZ(15,39,"order.unit-price")),r.xp6(3),r.Oqu(r.lcZ(18,41,"order.quantity")),r.xp6(2),r.Q6J("ngIf",n.orderLineCustomFields.length),r.xp6(2),r.Oqu(r.lcZ(22,43,"order.total")),r.xp6(3),r.Q6J("ngForOf",e.lines),r.xp6(1),r.Q6J("ngForOf",n.addedLines)("ngForTrackBy",n.trackByProductVariantId),r.xp6(1),r.Q6J("ngForOf",e.surcharges),r.xp6(1),r.Q6J("ngForOf",n.modifyOrderInput.surcharges),r.xp6(3),r.Oqu(r.lcZ(31,45,"order.shipping")),r.xp6(3),r.Oqu(null==e.shippingLines[0]||null==e.shippingLines[0].shippingMethod?null:e.shippingLines[0].shippingMethod.name),r.xp6(2),r.Q6J("ngIf",n.orderLineCustomFields.length),r.xp6(2),r.hij(" ",r.xi3(38,47,e.shippingWithTax,e.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(40,50,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(42,52,e.shipping,e.currencyCode)," "),r.xp6(3),r.Oqu(r.lcZ(45,55,"order.modifications")),r.xp6(5),r.Oqu(r.lcZ(50,57,"order.add-item-to-order")),r.xp6(5),r.Oqu(r.lcZ(55,59,"order.set-coupon-codes")),r.xp6(5),r.Oqu(r.lcZ(60,61,"order.add-surcharge")),r.xp6(5),r.Oqu(r.lcZ(65,63,"order.edit-shipping-address")),r.xp6(5),r.Oqu(r.lcZ(70,65,"order.edit-billing-address")),r.xp6(6),r.hij(" ",r.lcZ(76,67,"order.modification-summary")," "),r.xp6(4),r.Q6J("ngIf",null==n.modifyOrderInput.addItems?null:n.modifyOrderInput.addItems.length),r.xp6(1),r.Q6J("ngIf",null==n.modifyOrderInput.adjustOrderLines?null:n.modifyOrderInput.adjustOrderLines.length),r.xp6(1),r.Q6J("ngIf",null==n.modifyOrderInput.surcharges?null:n.modifyOrderInput.surcharges.length),r.xp6(1),r.Q6J("ngIf",n.shippingAddressForm.dirty),r.xp6(1),r.Q6J("ngIf",n.billingAddressForm.dirty),r.xp6(3),r.Oqu(r.lcZ(87,69,"order.note")),r.xp6(2),r.Q6J("ngModel",n.note),r.xp6(2),r.Q6J("ngModel",n.recalculateShipping),r.xp6(2),r.Oqu(r.lcZ(93,71,"order.modification-recalculate-shipping")),r.xp6(3),r.Q6J("disabled",!n.canPreviewChanges()),r.xp6(1),r.hij(" ",r.lcZ(97,73,"order.preview-changes")," ")}}const Pn=["portal"];function Qn(e,t){1&e&&(r.TgZ(0,"span",12),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.note-only-visible-to-administrators")," "))}function kn(e,t){1&e&&(r.TgZ(0,"span",13),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.note-visible-to-customer")," "))}function Dn(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"vdr-order-history-entry-host",16),r.NdJ("expandClick",function(){r.CHM(e);const t=r.oxw(2);return t.expanded=!t.expanded}),r.qZA()}if(2&e){const e=r.oxw().$implicit,t=r.oxw();r.Q6J("order",t.order)("entry",e)("expanded",t.expanded)}}function Yn(e,t){1&e&&(r.TgZ(0,"div",11),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.history-order-fulfilled")," "))}function jn(e,t){1&e&&(r.TgZ(0,"div",11),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.history-order-cancelled")," "))}const En=function(e,t){return{from:e,to:t}};function $n(e,t){if(1&e&&(r._uU(0),r.ALo(1,"translate")),2&e){const e=r.oxw(3).$implicit;r.hij(" ",r.xi3(1,1,"order.history-order-transition",r.WLB(4,En,e.data.from,e.data.to))," ")}}function Rn(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Yn,3,3,"div",21),r.YNc(2,jn,3,3,"div",21),r.YNc(3,$n,2,7,"ng-template",22),r.BQk()),2&e){const e=r.oxw(2).$implicit;r.xp6(1),r.Q6J("ngIf","Delivered"===e.data.to),r.xp6(1),r.Q6J("ngIf","Cancelled"===e.data.to),r.xp6(1),r.Q6J("ngIf","Cancelled"!==e.data.to&&"Delivered"!==e.data.to)}}function Hn(e,t){1&e&&(r.TgZ(0,"vdr-chip",27),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"order.modification-settled")))}function Bn(e,t){1&e&&(r.TgZ(0,"vdr-chip",28),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"order.modification-not-settled")))}function Vn(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.TgZ(3,"strong"),r._uU(4),r.ALo(5,"localeCurrency"),r.qZA(),r.YNc(6,Hn,3,3,"vdr-chip",24),r.YNc(7,Bn,3,3,"vdr-chip",25),r.TgZ(8,"vdr-history-entry-detail"),r._UZ(9,"vdr-modification-detail",26),r.qZA(),r.BQk()),2&e){const e=t.ngIf,n=r.oxw(4);r.xp6(1),r.hij(" ",r.lcZ(2,6,"order.modify-order-price-difference"),": "),r.xp6(3),r.Oqu(r.xi3(5,8,e.priceChange,n.order.currencyCode)),r.xp6(2),r.Q6J("ngIf",e.isSettled),r.xp6(1),r.Q6J("ngIf",!e.isSettled),r.xp6(2),r.Q6J("order",n.order)("modification",e)}}function Gn(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"div",11),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.YNc(4,Vn,10,11,"ng-container",23),r.BQk()),2&e){const e=r.oxw(2).$implicit,t=r.oxw();r.xp6(2),r.hij(" ",r.lcZ(3,2,"order.history-order-modified")," "),r.xp6(2),r.Q6J("ngIf",t.getModification(e.data.modificationId))}}function Wn(e,t){if(1&e&&(r.TgZ(0,"vdr-history-entry-detail"),r._UZ(1,"vdr-payment-detail",31),r.qZA()),2&e){const e=t.ngIf,n=r.oxw(5);r.xp6(1),r.Q6J("payment",e)("currencyCode",n.order.currencyCode)}}function Kn(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"div",11),r._uU(2),r.ALo(3,"translate"),r.qZA(),r._uU(4),r.ALo(5,"translate"),r.YNc(6,Wn,2,2,"vdr-history-entry-detail",23),r.BQk()),2&e){const e=r.oxw(3).$implicit,t=r.oxw();let n;r.xp6(2),r.hij(" ",r.lcZ(3,4,"order.history-payment-settled")," "),r.xp6(2),r.AsE(" ",r.lcZ(5,6,"order.transaction-id"),": ",null==(n=t.getPayment(e))?null:n.transactionId," "),r.xp6(2),r.Q6J("ngIf",t.getPayment(e))}}const Xn=function(e,t,n){return{from:e,to:t,id:n}};function zn(e,t){if(1&e&&(r._uU(0),r.ALo(1,"translate")),2&e){const e=r.oxw(3).$implicit,t=r.oxw();let n;r.hij(" ",r.xi3(1,1,"order.history-payment-transition",r.kEZ(4,Xn,e.data.from,e.data.to,null==(n=t.getPayment(e))?null:n.transactionId))," ")}}function er(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Kn,7,8,"ng-container",29),r.YNc(2,zn,2,8,"ng-template",null,30,r.W1O),r.BQk()),2&e){const e=r.MAs(3),t=r.oxw(2).$implicit;r.xp6(1),r.Q6J("ngIf","Settled"===t.data.to)("ngIfElse",e)}}function tr(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&e){const e=r.oxw(2).$implicit;r.xp6(1),r.hij(" ",r.xi3(2,1,"order.history-refund-transition",r.kEZ(4,Xn,e.data.from,e.data.to,e.data.refundId))," ")}}function nr(e,t){if(1&e&&(r.TgZ(0,"vdr-history-entry-detail"),r.TgZ(1,"vdr-labeled-data",32),r.ALo(2,"translate"),r._uU(3),r.qZA(),r.TgZ(4,"vdr-labeled-data",32),r.ALo(5,"translate"),r._UZ(6,"vdr-simple-item-list",33),r.qZA(),r.TgZ(7,"vdr-labeled-data",32),r.ALo(8,"translate"),r._uU(9),r.qZA(),r.qZA()),2&e){const e=t.ngIf,n=r.oxw(3).$implicit;r.xp6(1),r.Q6J("label",r.lcZ(2,6,"order.cancellation-reason")),r.xp6(2),r.hij(" ",n.data.reason," "),r.xp6(1),r.Q6J("label",r.lcZ(5,8,"order.contents")),r.xp6(2),r.Q6J("items",e),r.xp6(1),r.Q6J("label",r.lcZ(8,10,"order.shipping-cancelled")),r.xp6(2),r.hij(" ",n.data.shippingCancelled," ")}}function rr(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.YNc(3,nr,10,12,"vdr-history-entry-detail",23),r.BQk()),2&e){const e=r.oxw(2).$implicit,t=r.oxw();r.xp6(1),r.hij(" ",r.xi3(2,2,"order.history-items-cancelled",r.VKq(5,at,e.data.orderItemIds.length))," "),r.xp6(2),r.Q6J("ngIf",t.getCancelledItems(e))}}function ir(e,t){if(1&e&&(r.TgZ(0,"vdr-history-entry-detail"),r._UZ(1,"vdr-fulfillment-detail",34),r.qZA()),2&e){const e=t.ngIf,n=r.oxw(4);r.xp6(1),r.Q6J("fulfillmentId",e.id)("order",n.order)}}function or(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.YNc(3,ir,2,2,"vdr-history-entry-detail",23),r.BQk()),2&e){const e=r.oxw(2).$implicit,t=r.oxw();r.xp6(1),r.hij(" ",r.lcZ(2,2,"order.history-fulfillment-created")," "),r.xp6(2),r.Q6J("ngIf",t.getFulfillment(e))}}function sr(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"div",11),r._uU(2),r.ALo(3,"translate"),r.qZA(),r._uU(4),r.ALo(5,"translate"),r.BQk()),2&e){const e=r.oxw(3).$implicit,t=r.oxw();let n;r.xp6(2),r.hij(" ",r.lcZ(3,3,"order.history-fulfillment-delivered")," "),r.xp6(2),r.AsE(" ",r.lcZ(5,5,"order.tracking-code"),": ",null==(n=t.getFulfillment(e))?null:n.trackingCode," ")}}function ar(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"div",11),r._uU(2),r.ALo(3,"translate"),r.qZA(),r._uU(4),r.ALo(5,"translate"),r.BQk()),2&e){const e=r.oxw(3).$implicit,t=r.oxw();let n;r.xp6(2),r.hij(" ",r.lcZ(3,3,"order.history-fulfillment-shipped")," "),r.xp6(2),r.AsE(" ",r.lcZ(5,5,"order.tracking-code"),": ",null==(n=t.getFulfillment(e))?null:n.trackingCode," ")}}function cr(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&e){const e=r.oxw(3).$implicit;r.xp6(1),r.hij(" ",r.xi3(2,1,"order.history-fulfillment-transition",r.WLB(4,En,e.data.from,e.data.to))," ")}}function lr(e,t){if(1&e&&(r.TgZ(0,"vdr-history-entry-detail"),r._UZ(1,"vdr-fulfillment-detail",34),r.qZA()),2&e){const e=t.ngIf,n=r.oxw(4);r.xp6(1),r.Q6J("fulfillmentId",e.id)("order",n.order)}}function dr(e,t){if(1&e&&(r.ynx(0),r.YNc(1,sr,6,7,"ng-container",23),r.YNc(2,ar,6,7,"ng-container",23),r.YNc(3,cr,3,7,"ng-container",23),r.YNc(4,lr,2,2,"vdr-history-entry-detail",23),r.BQk()),2&e){const e=r.oxw(2).$implicit,t=r.oxw();r.xp6(1),r.Q6J("ngIf","Delivered"===e.data.to),r.xp6(1),r.Q6J("ngIf","Shipped"===e.data.to),r.xp6(1),r.Q6J("ngIf","Delivered"!==e.data.to&&"Shipped"!==e.data.to),r.xp6(1),r.Q6J("ngIf",t.getFulfillment(e))}}function ur(e,t){1&e&&(r.TgZ(0,"span",47),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"common.public")))}function pr(e,t){1&e&&(r.TgZ(0,"span",48),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&e&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"common.private")))}function gr(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"div",35),r.TgZ(2,"div",36),r.YNc(3,ur,3,3,"span",37),r.YNc(4,pr,3,3,"span",38),r._uU(5),r.qZA(),r._UZ(6,"div",39),r.TgZ(7,"vdr-dropdown"),r.TgZ(8,"button",40),r._UZ(9,"clr-icon",41),r.qZA(),r.TgZ(10,"vdr-dropdown-menu",42),r.TgZ(11,"button",43),r.NdJ("click",function(){r.CHM(e);const t=r.oxw(2).$implicit;return r.oxw().updateNote.emit(t)}),r.ALo(12,"hasPermission"),r._UZ(13,"clr-icon",44),r._uU(14),r.ALo(15,"translate"),r.qZA(),r._UZ(16,"div",45),r.TgZ(17,"button",43),r.NdJ("click",function(){r.CHM(e);const t=r.oxw(2).$implicit;return r.oxw().deleteNote.emit(t)}),r.ALo(18,"hasPermission"),r._UZ(19,"clr-icon",46),r._uU(20),r.ALo(21,"translate"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.BQk()}if(2&e){const e=r.oxw(2).$implicit;r.xp6(3),r.Q6J("ngIf",e.isPublic),r.xp6(1),r.Q6J("ngIf",!e.isPublic),r.xp6(1),r.hij(" ",e.data.note," "),r.xp6(6),r.Q6J("disabled",!r.lcZ(12,7,"UpdateOrder")),r.xp6(3),r.hij(" ",r.lcZ(15,9,"common.edit")," "),r.xp6(3),r.Q6J("disabled",!r.lcZ(18,11,"UpdateOrder")),r.xp6(3),r.hij(" ",r.lcZ(21,13,"common.delete")," ")}}const fr=function(e){return["/marketing","promotions",e]};function mr(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.TgZ(3,"vdr-chip"),r.TgZ(4,"a",49),r._uU(5),r.qZA(),r.qZA(),r.BQk()),2&e){const e=r.oxw(2).$implicit;r.xp6(1),r.hij(" ",r.lcZ(2,3,"order.history-coupon-code-applied"),": "),r.xp6(3),r.Q6J("routerLink",r.VKq(5,fr,e.data.promotionId)),r.xp6(1),r.Oqu(e.data.couponCode)}}function hr(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.TgZ(3,"vdr-chip"),r.TgZ(4,"span",50),r._uU(5),r.qZA(),r.qZA(),r.BQk()),2&e){const e=r.oxw(2).$implicit;r.xp6(1),r.hij(" ",r.lcZ(2,2,"order.history-coupon-code-removed"),": "),r.xp6(4),r.Oqu(e.data.couponCode)}}function Zr(e,t){if(1&e&&(r.TgZ(0,"vdr-history-entry-detail"),r._UZ(1,"vdr-object-tree",51),r.qZA()),2&e){const e=r.oxw(3).$implicit;r.xp6(1),r.Q6J("value",e.data)}}function xr(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"div",11),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.YNc(4,Zr,2,1,"vdr-history-entry-detail",23),r.BQk()),2&e){const e=r.oxw(2).$implicit;r.xp6(2),r.hij(" ",r.lcZ(3,2,e.type)," "),r.xp6(2),r.Q6J("ngIf",e.data)}}function vr(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"vdr-timeline-entry",17),r.NdJ("expandClick",function(){r.CHM(e);const t=r.oxw(2);return t.expanded=!t.expanded}),r.ynx(1,18),r.YNc(2,Rn,4,3,"ng-container",19),r.YNc(3,Gn,5,4,"ng-container",19),r.YNc(4,er,4,2,"ng-container",19),r.YNc(5,tr,3,8,"ng-container",19),r.YNc(6,rr,4,7,"ng-container",19),r.YNc(7,or,4,4,"ng-container",19),r.YNc(8,dr,5,4,"ng-container",19),r.YNc(9,gr,22,15,"ng-container",19),r.YNc(10,mr,6,7,"ng-container",19),r.YNc(11,hr,6,4,"ng-container",19),r.YNc(12,xr,5,4,"ng-container",20),r.BQk(),r.qZA()}if(2&e){const e=r.oxw().$implicit,t=r.oxw();r.Q6J("displayType",t.getDisplayType(e))("iconShape",t.getTimelineIcon(e))("createdAt",e.createdAt)("name",t.getName(e))("featured",t.isFeatured(e))("collapsed",!t.expanded&&!t.isFeatured(e)),r.xp6(1),r.Q6J("ngSwitch",e.type),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_STATE_TRANSITION),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_MODIFIED),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_PAYMENT_TRANSITION),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_REFUND_TRANSITION),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_CANCELLATION),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_FULFILLMENT),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_FULFILLMENT_TRANSITION),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_NOTE),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_COUPON_APPLIED),r.xp6(1),r.Q6J("ngSwitchCase",t.type.ORDER_COUPON_REMOVED)}}function yr(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Dn,1,3,"vdr-order-history-entry-host",14),r.YNc(2,vr,13,17,"ng-template",null,15,r.W1O),r.BQk()),2&e){const e=t.$implicit,n=r.MAs(3),i=r.oxw();r.xp6(1),r.Q6J("ngIf",i.hasCustomComponent(e.type))("ngIfElse",n)}}function Ar(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",19),r.NdJ("click",function(){const t=r.CHM(e).$implicit;return r.oxw(2).selectFilterPreset(t.name)}),r._uU(1),r.ALo(2,"translate"),r.qZA()}if(2&e){const e=t.$implicit,n=r.oxw().ngIf;r.ekj("btn-primary",n===e.name),r.xp6(1),r.hij(" ",r.lcZ(2,3,e.label)," ")}}function br(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",17),r.YNc(1,Ar,3,5,"button",18),r.TgZ(2,"button",19),r.NdJ("click",function(){return r.CHM(e),r.oxw().selectFilterPreset("custom")}),r._uU(3),r.ALo(4,"translate"),r._UZ(5,"clr-icon",20),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,n=r.oxw();r.xp6(1),r.Q6J("ngForOf",n.filterPresets),r.xp6(1),r.ekj("btn-primary","custom"===e),r.xp6(1),r.hij(" ",r.lcZ(4,4,"order.filter-custom")," ")}}function Cr(e,t){if(1&e&&(r._uU(0),r.ALo(1,"translate"),r.ALo(2,"stateI18nToken")),2&e){const e=t.item;r.Oqu(r.lcZ(1,1,r.lcZ(2,3,e)))}}function qr(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"span",21),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"stateI18nToken"),r.qZA(),r.TgZ(4,"span",22),r.NdJ("click",function(){const t=r.CHM(e),n=t.item;return t.clear(n)}),r._uU(5,"\xd7"),r.qZA()}if(2&e){const e=t.item;r.xp6(1),r.hij(" ",r.lcZ(2,1,r.lcZ(3,3,e)),"")}}const Tr=function(){return["./draft/create"]};function Or(e,t){1&e&&(r.TgZ(0,"a",24),r._UZ(1,"clr-icon",25),r._uU(2),r.ALo(3,"translate"),r.qZA()),2&e&&(r.Q6J("routerLink",r.DdM(4,Tr)),r.xp6(2),r.hij(" ",r.lcZ(3,2,"catalog.create-draft-order")," "))}const _r=function(){return["CreateOrder"]};function Ir(e,t){1&e&&(r.ynx(0),r.YNc(1,Or,4,5,"a",23),r.BQk()),2&e&&(r.xp6(1),r.Q6J("vdrIfPermissions",r.DdM(1,_r)))}const wr=function(e){return["./",e,"modify"]},Lr=function(e){return["./draft",e]},Fr=function(e){return["./",e]};function Nr(e,t){if(1&e&&(r.TgZ(0,"td",26),r._uU(1),r.qZA(),r.TgZ(2,"td",26),r._UZ(3,"vdr-customer-label",27),r.qZA(),r.TgZ(4,"td",26),r._UZ(5,"vdr-order-state-label",28),r.qZA(),r.TgZ(6,"td",26),r._uU(7),r.ALo(8,"localeCurrency"),r.qZA(),r.TgZ(9,"td",26),r._uU(10),r.ALo(11,"timeAgo"),r.qZA(),r.TgZ(12,"td",26),r._uU(13),r.ALo(14,"localeDate"),r.qZA(),r.TgZ(15,"td",26),r._uU(16),r.qZA(),r.TgZ(17,"td",29),r._UZ(18,"vdr-table-row-action",30),r.ALo(19,"translate"),r.qZA()),2&e){const e=t.item,n=r.oxw();r.xp6(1),r.Oqu(e.code),r.xp6(2),r.Q6J("customer",e.customer),r.xp6(2),r.Q6J("state",e.state),r.xp6(2),r.Oqu(r.xi3(8,9,e.totalWithTax,e.currencyCode)),r.xp6(3),r.Oqu(r.lcZ(11,12,e.updatedAt)),r.xp6(3),r.Oqu(r.xi3(14,14,e.orderPlacedAt,"medium")),r.xp6(3),r.Oqu(n.getShippingNames(e)),r.xp6(2),r.Q6J("label",r.lcZ(19,17,"common.open"))("linkTo","Modifying"===e.state?r.VKq(19,wr,e.id):"Draft"===e.state?r.VKq(21,Lr,e.id):r.VKq(23,Fr,e.id))}}function Jr(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.BQk()),2&e){const e=r.oxw();r.xp6(1),r.hij("#",e.payment.transactionId,"")}}function Ur(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",11),r.ALo(1,"translate"),r._uU(2),r.qZA()),2&e){const e=r.oxw().$implicit;r.Q6J("label",r.lcZ(1,2,"order.transaction-id")),r.xp6(2),r.hij(" ",e.transactionId," ")}}function Mr(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",11),r.ALo(1,"translate"),r._uU(2),r.qZA()),2&e){const e=r.oxw().$implicit;r.Q6J("label",r.lcZ(1,2,"order.refund-reason")),r.xp6(2),r.hij(" ",e.reason," ")}}function Sr(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",11),r.ALo(1,"translate"),r._UZ(2,"vdr-object-tree",13),r.qZA()),2&e){const e=r.oxw().$implicit;r.Q6J("label",r.lcZ(1,2,"order.refund-metadata")),r.xp6(2),r.Q6J("value",e.metadata)}}function Pr(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",14),r.TgZ(1,"button",15),r.NdJ("click",function(){r.CHM(e);const t=r.oxw().$implicit;return r.oxw().settleRefund.emit(t)}),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.qZA()}2&e&&(r.xp6(2),r.hij(" ",r.lcZ(3,1,"order.settle-refund")," "))}function Qr(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"div",1),r._UZ(2,"clr-icon",9),r._uU(3),r.ALo(4,"translate"),r._UZ(5,"div",10),r._UZ(6,"vdr-refund-state-label",4),r.qZA(),r.TgZ(7,"div",5),r.TgZ(8,"vdr-labeled-data",11),r.ALo(9,"translate"),r._uU(10),r.ALo(11,"localeDate"),r.qZA(),r.TgZ(12,"vdr-labeled-data",11),r.ALo(13,"translate"),r._uU(14),r.ALo(15,"localeCurrency"),r.qZA(),r.YNc(16,Ur,3,4,"vdr-labeled-data",12),r.YNc(17,Mr,3,4,"vdr-labeled-data",12),r.YNc(18,Sr,3,4,"vdr-labeled-data",12),r.qZA(),r.YNc(19,Pr,4,3,"div",8),r.BQk()),2&e){const e=t.$implicit,n=r.oxw();r.xp6(3),r.AsE(" ",r.lcZ(4,11,"order.refund")," #",e.id," "),r.xp6(3),r.Q6J("state",e.state),r.xp6(2),r.Q6J("label",r.lcZ(9,13,"common.created-at")),r.xp6(2),r.hij(" ",r.xi3(11,15,e.createdAt,"medium")," "),r.xp6(2),r.Q6J("label",r.lcZ(13,18,"order.refund-total")),r.xp6(2),r.hij(" ",r.xi3(15,20,e.total,n.currencyCode)," "),r.xp6(2),r.Q6J("ngIf",e.transactionId),r.xp6(1),r.Q6J("ngIf",e.reason),r.xp6(1),r.Q6J("ngIf",n.refundHasMetadata(e)),r.xp6(1),r.Q6J("ngIf","Pending"===e.state)}}function kr(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",15),r.NdJ("click",function(){r.CHM(e);const t=r.oxw(2);return t.settlePayment.emit(t.payment)}),r._uU(1),r.ALo(2,"translate"),r.qZA()}2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.settle-payment")," "))}function Dr(e,t){if(1&e&&(r.ynx(0),r._UZ(1,"clr-icon",23),r._uU(2),r.ALo(3,"translate"),r.ALo(4,"translate"),r.ALo(5,"stateI18nToken"),r.BQk()),2&e){const e=r.oxw().$implicit;r.xp6(2),r.hij(" ",r.xi3(3,1,"order.transition-to-state",r.VKq(8,ee,r.lcZ(4,4,r.lcZ(5,6,e))))," ")}}function Yr(e,t){1&e&&(r._UZ(0,"clr-icon",24),r._uU(1),r.ALo(2,"translate")),2&e&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"order.cancel-payment")," "))}function jr(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"button",20),r.NdJ("click",function(){const t=r.CHM(e).$implicit,n=r.oxw(2);return n.transitionPaymentState.emit({payment:n.payment,state:t})}),r.YNc(2,Dr,6,10,"ng-container",21),r.YNc(3,Yr,3,3,"ng-template",null,22,r.W1O),r.qZA(),r.BQk()}if(2&e){const e=t.$implicit,n=r.MAs(4);r.xp6(2),r.Q6J("ngIf","Cancelled"!==e)("ngIfElse",n)}}function Er(e,t){if(1&e&&(r.TgZ(0,"div",14),r.YNc(1,kr,3,3,"button",16),r.TgZ(2,"vdr-dropdown"),r.TgZ(3,"button",17),r._UZ(4,"clr-icon",18),r.qZA(),r.TgZ(5,"vdr-dropdown-menu",19),r.YNc(6,jr,5,2,"ng-container",7),r.qZA(),r.qZA(),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",e.payment.nextStates.includes("Settled")),r.xp6(5),r.Q6J("ngForOf",e.nextOtherStates())}}function $r(e,t){if(1&e&&(r.TgZ(0,"div",3),r._UZ(1,"div",4),r._UZ(2,"clr-icon",5),r.TgZ(3,"div",6),r._uU(4),r.ALo(5,"translate"),r.ALo(6,"stateI18nToken"),r.qZA(),r.qZA()),2&e){const e=r.oxw();r.xp6(4),r.hij(" ",r.lcZ(5,1,r.lcZ(6,3,e.cancelledState))," ")}}function Rr(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"vdr-order-process-node",1),r.NdJ("mouseenter",function(){const t=r.CHM(e).$implicit;return r.oxw().onMouseOver(t.name)})("mouseleave",function(){return r.CHM(e),r.oxw().onMouseOut()}),r.ALo(2,"async"),r.qZA(),r.BQk()}if(2&e){const e=t.$implicit,n=t.index,i=r.oxw();r.xp6(1),r.Q6J("node",e)("index",n)("active",r.lcZ(2,3,i.activeState$)===e.name)}}function Hr(e,t){if(1&e&&(r.ynx(0),r._UZ(1,"vdr-order-process-edge",2),r.BQk()),2&e){const e=t.$implicit;r.xp6(1),r.Q6J("from",e.from)("to",e.to)("index",e.index)}}function Br(e,t){if(1&e&&(r._UZ(0,"img",24),r.ALo(1,"assetPreview")),2&e){const e=r.oxw().$implicit;r.Q6J("src",r.xi3(1,1,e.featuredAsset,"tiny"),r.LSH)}}function Vr(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.BQk()),2&e){const e=r.oxw().$implicit;r.xp6(1),r.hij(" ",e.quantity," ")}}function Gr(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",25),r.TgZ(1,"input",26,27),r.NdJ("blur",function(){r.CHM(e);const t=r.MAs(2),n=r.oxw().$implicit;return r.oxw().draftInputBlur(n,t.valueAsNumber)}),r.qZA(),r.TgZ(3,"button",28),r.NdJ("click",function(){r.CHM(e);const t=r.oxw().$implicit;return r.oxw().remove.emit({lineId:t.id})}),r._UZ(4,"clr-icon",29),r.qZA(),r.qZA()}if(2&e){const e=r.oxw().$implicit;r.xp6(1),r.Q6J("value",e.quantity)}}function Wr(e,t){if(1&e&&(r.TgZ(0,"div",32),r.TgZ(1,"a",33),r._uU(2),r.qZA(),r.TgZ(3,"div",34),r._uU(4),r.ALo(5,"localeCurrency"),r.TgZ(6,"div",7),r.ALo(7,"translate"),r._uU(8),r.ALo(9,"localeCurrency"),r.qZA(),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw(4);r.xp6(1),r.Q6J("routerLink",n.getPromotionLink(e)),r.xp6(1),r.Oqu(e.description),r.xp6(2),r.hij(" ",r.xi3(5,5,e.amountWithTax,n.order.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(7,8,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(9,10,e.amount,n.order.currencyCode)," ")}}function Kr(e,t){if(1&e&&(r.TgZ(0,"vdr-dropdown"),r.TgZ(1,"div",30),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"vdr-dropdown-menu"),r.YNc(5,Wr,10,13,"div",31),r.qZA(),r.qZA()),2&e){const e=r.oxw().ngIf;r.xp6(2),r.hij(" ",r.lcZ(3,2,"order.promotions-applied")," "),r.xp6(3),r.Q6J("ngForOf",e)}}function Xr(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Kr,6,4,"vdr-dropdown",23),r.BQk()),2&e){const e=t.ngIf;r.xp6(1),r.Q6J("ngIf",e.length)}}function zr(e,t){if(1&e&&(r.TgZ(0,"div",38),r._UZ(1,"vdr-custom-field-control",39),r.qZA()),2&e){const e=t.$implicit;r.xp6(1),r.Q6J("compact",!0)("readonly",!0)("customField",e.config)("customFieldsFormGroup",e.formGroup)}}function ei(e,t){if(1&e&&(r.TgZ(0,"tr"),r.TgZ(1,"td",35),r.TgZ(2,"div",36),r.YNc(3,zr,2,4,"div",37),r.qZA(),r.qZA(),r.qZA()),2&e){const e=r.oxw().ngIf;r.xp6(3),r.Q6J("ngForOf",e)}}function ti(e,t){if(1&e&&(r.ynx(0),r.YNc(1,ei,4,1,"tr",23),r.BQk()),2&e){const e=t.ngIf;r.xp6(1),r.Q6J("ngIf",e.length)}}function ni(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"tr",11),r.TgZ(2,"td",12),r.YNc(3,Br,2,4,"img",13),r.qZA(),r.TgZ(4,"td",14),r._uU(5),r.qZA(),r.TgZ(6,"td",15),r._uU(7),r.qZA(),r.TgZ(8,"td",16),r._uU(9),r.ALo(10,"localeCurrency"),r.TgZ(11,"div",7),r.ALo(12,"translate"),r._uU(13),r.ALo(14,"localeCurrency"),r.qZA(),r.qZA(),r.TgZ(15,"td",17),r.YNc(16,Vr,2,1,"ng-container",18),r.YNc(17,Gr,5,1,"ng-template",null,19,r.W1O),r._UZ(19,"vdr-line-refunds",20),r._UZ(20,"vdr-line-fulfillment",21),r.qZA(),r.TgZ(21,"td",22),r._uU(22),r.ALo(23,"localeCurrency"),r.TgZ(24,"div",7),r.ALo(25,"translate"),r._uU(26),r.ALo(27,"localeCurrency"),r.qZA(),r.YNc(28,Xr,2,1,"ng-container",23),r.qZA(),r.qZA(),r.YNc(29,ti,2,1,"ng-container",23),r.BQk()),2&e){const e=t.$implicit,n=r.MAs(18),i=r.oxw();r.xp6(1),r.ekj("is-cancelled",0===e.quantity),r.xp6(2),r.Q6J("ngIf",e.featuredAsset),r.xp6(2),r.Oqu(e.productVariant.name),r.xp6(2),r.Oqu(e.productVariant.sku),r.xp6(2),r.hij(" ",r.xi3(10,19,e.unitPriceWithTax,i.order.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(12,22,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(14,24,e.unitPrice,i.order.currencyCode)," "),r.xp6(3),r.Q6J("ngIf",!i.isDraft)("ngIfElse",n),r.xp6(3),r.Q6J("line",e)("payments",i.order.payments),r.xp6(1),r.Q6J("line",e)("orderState",i.order.state),r.xp6(2),r.hij(" ",r.xi3(23,27,e.linePriceWithTax,i.order.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(25,30,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(27,32,e.linePrice,i.order.currencyCode)," "),r.xp6(2),r.Q6J("ngIf",i.getLineDiscounts(e)),r.xp6(1),r.Q6J("ngIf",i.customFieldsForLine[e.id])}}function ri(e,t){if(1&e&&(r.TgZ(0,"tr",40),r.TgZ(1,"td",41),r._uU(2),r.qZA(),r.TgZ(3,"td",15),r._uU(4),r.qZA(),r._UZ(5,"td",42),r.TgZ(6,"td",22),r._uU(7),r.ALo(8,"localeCurrency"),r.TgZ(9,"div",7),r.ALo(10,"translate"),r._uU(11),r.ALo(12,"localeCurrency"),r.qZA(),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw();r.xp6(2),r.Oqu(e.description),r.xp6(2),r.Oqu(e.sku),r.xp6(3),r.hij(" ",r.xi3(8,5,e.priceWithTax,n.order.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(10,8,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(12,10,e.price,n.order.currencyCode)," ")}}function ii(e,t){if(1&e&&(r.TgZ(0,"vdr-chip"),r._uU(1),r.qZA()),2&e){const e=t.ngIf;r.xp6(1),r.Oqu(e)}}function oi(e,t){if(1&e&&(r.TgZ(0,"tr",44),r.TgZ(1,"td",45),r.TgZ(2,"a",46),r._uU(3),r.qZA(),r.YNc(4,ii,2,1,"vdr-chip",23),r.qZA(),r.TgZ(5,"td",6),r._uU(6),r.ALo(7,"localeCurrency"),r.TgZ(8,"div",7),r.ALo(9,"translate"),r._uU(10),r.ALo(11,"localeCurrency"),r.qZA(),r.qZA(),r.qZA()),2&e){const e=r.oxw().$implicit,t=r.oxw();r.xp6(2),r.Q6J("routerLink",t.getPromotionLink(e)),r.xp6(1),r.Oqu(e.description),r.xp6(1),r.Q6J("ngIf",t.getCouponCodeForAdjustment(t.order,e)),r.xp6(2),r.hij(" ",r.xi3(7,6,e.amountWithTax,t.order.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(9,9,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(11,11,e.amount,t.order.currencyCode)," ")}}function si(e,t){if(1&e&&(r.ynx(0),r.YNc(1,oi,12,14,"tr",43),r.BQk()),2&e){const e=t.$implicit;r.xp6(1),r.Q6J("ngIf","OTHER"!==e.type)}}function ai(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._uU(2),r.qZA()),2&e){const e=r.oxw();r.Q6J("label",r.lcZ(1,2,"order.error-message")),r.xp6(2),r.hij(" ",e.payment.errorMessage,"\n")}}function ci(e,t){if(1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._uU(2),r.qZA()),2&e){const e=r.oxw();r.Q6J("label",r.lcZ(1,2,"order.transaction-id")),r.xp6(2),r.hij(" ",e.payment.transactionId,"\n")}}function li(e,t){1&e&&r._UZ(0,"clr-icon",2)}function di(e,t){1&e&&r._UZ(0,"clr-icon",2)}function ui(e,t){if(1&e&&(r.TgZ(0,"li",2),r.TgZ(1,"div",3),r._uU(2),r.qZA(),r._UZ(3,"clr-icon",4),r._uU(4),r.qZA()),2&e){const e=t.$implicit;r.Q6J("title",e.name),r.xp6(2),r.Oqu(e.quantity),r.xp6(2),r.hij(" ",e.name," ")}}class pi{constructor(e){this.dataService=e,this.form=new i.cw({method:new i.NI("",i.kI.required),transactionId:new i.NI("",i.kI.required)})}ngOnInit(){this.paymentMethods$=this.dataService.settings.getPaymentMethods(999).mapSingle(e=>e.paymentMethods.items)}submit(){const e=this.form.value;this.resolveWith({method:e.method,transactionId:e.transactionId})}cancel(){this.resolveWith()}}pi.\u0275fac=function(e){return new(e||pi)(r.Y36(o.DoR))},pi.\u0275cmp=r.Xpm({type:pi,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(r.YNc(0,D,2,3,"ng-template",0),r.TgZ(1,"form",1),r.TgZ(2,"vdr-form-field",2),r.ALo(3,"translate"),r._UZ(4,"ng-select",3),r.ALo(5,"async"),r.qZA(),r.TgZ(6,"vdr-form-field",4),r.ALo(7,"translate"),r._UZ(8,"input",5),r.qZA(),r.qZA(),r.YNc(9,Y,7,11,"ng-template",6)),2&e&&(r.xp6(1),r.Q6J("formGroup",t.form),r.xp6(1),r.Q6J("label",r.lcZ(3,5,"order.payment-method")),r.xp6(2),r.Q6J("items",r.lcZ(5,7,t.paymentMethods$))("addTag",!0),r.xp6(2),r.Q6J("label",r.lcZ(7,9,"order.transaction-id")))},directives:[o.q6K,i._Y,i.JL,i.sg,o.hgI,M.w9,i.JJ,i.u,o.y_K,i.Fj,o.nPI],pipes:[S.X$,P.Ov,o.kgx],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0}),pi.ctorParameters=()=>[{type:o.DoR}];class gi{constructor(e){var t;this.i18nService=e,this.cancelAll=!0,this.lineQuantities={},this.reasons=null!==(t=(0,o.hq7)().cancellationReasons)&&void 0!==t?t:[(0,s.J)("order.cancel-reason-customer-request"),(0,s.J)("order.cancel-reason-not-available")],this.reasons=this.reasons.map(e=>this.i18nService.translate(e))}get selectionCount(){return Object.values(this.lineQuantities).reduce((e,t)=>e+t,0)}ngOnInit(){this.lineQuantities=this.order.lines.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.id]:t.quantity}),{})}radioChanged(){if(this.cancelAll)for(const e of this.order.lines)this.lineQuantities[e.id]=e.quantity;else for(const e of this.order.lines)this.lineQuantities[e.id]=0}checkIfAllSelected(){var e;for(const[t,n]of Object.entries(this.lineQuantities)){const r=null===(e=this.order.lines.find(e=>e.id===t))||void 0===e?void 0:e.quantity;if(r&&n<r)return}this.cancelAll=!0}select(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason,cancelShipping:this.cancelAll})}cancel(){this.resolveWith()}getLineInputs(){if(!this.order.active)return Object.entries(this.lineQuantities).map(([e,t])=>({orderLineId:e,quantity:t})).filter(e=>0<e.quantity)}}gi.\u0275fac=function(e){return new(e||gi)(r.Y36(o.Dp7))},gi.\u0275cmp=r.Xpm({type:gi,selectors:[["vdr-cancel-order-dialog"]],decls:30,vars:23,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-disabled","is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[4,"ngIf"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input"],["type","radio","clrRadio","","name","options",3,"value","ngModel","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(r.YNc(0,j,2,3,"ng-template",0),r.TgZ(1,"div",1),r.TgZ(2,"div",2),r.TgZ(3,"table",3),r.TgZ(4,"thead"),r.TgZ(5,"tr"),r._UZ(6,"th"),r.TgZ(7,"th"),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.TgZ(10,"th"),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"th"),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"th"),r._uU(17),r.ALo(18,"translate"),r.qZA(),r.TgZ(19,"th"),r._uU(20),r.ALo(21,"translate"),r.qZA(),r.qZA(),r.qZA(),r.YNc(22,R,17,17,"tr",4),r.qZA(),r.qZA(),r.TgZ(23,"div",5),r.YNc(24,H,11,10,"ng-container",6),r.TgZ(25,"label",7),r._uU(26),r.ALo(27,"translate"),r.qZA(),r.TgZ(28,"ng-select",8),r.NdJ("ngModelChange",function(e){return t.reason=e}),r.qZA(),r.qZA(),r.qZA(),r.YNc(29,G,6,6,"ng-template",9)),2&e&&(r.xp6(8),r.Oqu(r.lcZ(9,11,"order.product-name")),r.xp6(3),r.Oqu(r.lcZ(12,13,"order.product-sku")),r.xp6(3),r.Oqu(r.lcZ(15,15,"order.quantity")),r.xp6(3),r.Oqu(r.lcZ(18,17,"order.unit-price")),r.xp6(3),r.Oqu(r.lcZ(21,19,"order.cancel")),r.xp6(2),r.Q6J("ngForOf",t.order.lines),r.xp6(2),r.Q6J("ngIf",!0!==t.order.active),r.xp6(2),r.Oqu(r.lcZ(27,21,"order.cancellation-reason")),r.xp6(2),r.Q6J("items",t.reasons)("addTag",!0)("ngModel",t.reason))},directives:[o.q6K,P.sg,P.O5,Q.MgK,M.w9,i.JJ,i.On,o.nPI,o.y_K,i.qQ,i.wV,i.Fd,i.Fj,Q.EeQ,i._,Q.asN],pipes:[S.X$,o.Mgf,o.kgx],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0}),gi.ctorParameters=()=>[{type:o.Dp7}];class fi{constructor(e){this.dataService=e,this.addCouponCode=new r.vpe,this.removeCouponCode=new r.vpe,this.couponCodeInput$=new a.xQ}ngOnInit(){var e;this.availableCouponCodes$=(0,c.z)(this.couponCodeInput$.pipe((0,Z.x)(),(0,x.w)(e=>this.dataService.promotion.getPromotions(10,0,{couponCode:{contains:e}}).single$),(0,v.U)(({promotions:e})=>e.items.map(e=>({code:e.couponCode,promotionName:e.name}))),(0,y.O)([]))),this.control||(this.control=new i.NI(null!==(e=this.couponCodes)&&void 0!==e?e:[]))}}fi.\u0275fac=function(e){return new(e||fi)(r.Y36(o.DoR))},fi.\u0275cmp=r.Xpm({type:fi,selectors:[["vdr-coupon-code-selector"]],inputs:{control:"control",couponCodes:"couponCodes"},outputs:{addCouponCode:"addCouponCode",removeCouponCode:"removeCouponCode"},decls:3,vars:9,consts:[["appendTo","body","bindLabel","code","bindValue","code","typeToSearchText","",3,"items","addTag","multiple","hideSelected","minTermLength","typeahead","formControl","add","remove"],["ng-option-tmp",""]],template:function(e,t){1&e&&(r.TgZ(0,"ng-select",0),r.NdJ("add",function(e){return t.addCouponCode.emit(e.code)})("remove",function(e){return t.removeCouponCode.emit(null==e.value?null:e.value.code)}),r.ALo(1,"async"),r.YNc(2,W,3,2,"ng-template",1),r.qZA()),2&e&&r.Q6J("items",r.lcZ(1,7,t.availableCouponCodes$))("addTag",!1)("multiple",!0)("hideSelected",!0)("minTermLength",2)("typeahead",t.couponCodeInput$)("formControl",t.control)},directives:[M.w9,i.JJ,i.oH,M.Z2,o.Ywx],pipes:[P.Ov],styles:[""],changeDetection:0}),fi.ctorParameters=()=>[{type:o.DoR}],fi.propDecorators={couponCodes:[{type:r.IIB}],control:[{type:r.IIB}],addCouponCode:[{type:r.r_U}],removeCouponCode:[{type:r.r_U}]};class mi{constructor(){this.nextStates=[],this.message="",this.selectedState=""}select(){this.selectedState&&this.resolveWith(this.selectedState)}cancel(){this.resolveWith()}}mi.\u0275fac=function(e){return new(e||mi)},mi.\u0275cmp=r.Xpm({type:mi,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["clrSelect","","name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(e,t){1&e&&(r.YNc(0,K,2,3,"ng-template",0),r.TgZ(1,"p"),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"clr-select-container"),r.TgZ(5,"select",1),r.NdJ("ngModelChange",function(e){return t.selectedState=e}),r.YNc(6,X,4,6,"option",2),r.qZA(),r.qZA(),r.YNc(7,te,6,12,"ng-template",3)),2&e&&(r.xp6(2),r.Oqu(r.lcZ(3,3,t.message)),r.xp6(3),r.Q6J("ngModel",t.selectedState),r.xp6(1),r.Q6J("ngForOf",t.nextStates))},directives:[o.q6K,Q.dTv,o.y_K,i.EJ,Q.otW,i.JJ,i.On,P.sg,o.nPI,i.YN,i.Kr,P.O5],pipes:[S.X$,o.Nir],styles:[""],changeDetection:0});class hi{constructor(e,t,n,r){this.dataService=e,this.modalService=t,this.notificationService=n,this.i18nService=r}transitionToPreModifyingState(e,t){return this.getPreModifyingState(e).pipe((0,x.w)(n=>{const r={orderId:e,nextStates:t,message:this.i18nService.translate((0,s.J)("order.unable-to-transition-to-state-try-another"),{state:n}),cancellable:!1,retry:10};return n?this.transitionToStateOrThrow(e,n).pipe((0,A.K)(e=>this.manuallyTransitionToState(r))):this.manuallyTransitionToState(r)}))}manuallyTransitionToState(e){return this.modalService.fromComponent(mi,{locals:{nextStates:e.nextStates,cancellable:e.cancellable,message:e.message},closable:!1,size:"md"}).pipe((0,x.w)(t=>{if(t)return this.transitionToStateOrThrow(e.orderId,t);if(e.cancellable)return l.E;throw new Error("An order state must be selected")}),(t=t=>t.pipe((0,b.g)(2e3),(0,C.q)(e.retry)),e=>e.lift(new m(t,e))));var t}getPreModifyingState(e){return this.dataService.order.getOrderHistory(e,{filter:{type:{eq:o.iYD.ORDER_STATE_TRANSITION}},sort:{createdAt:o.Asd.DESC}}).mapSingle(e=>e.order).pipe((0,v.U)(e=>{const t=null==e?void 0:e.history.items.find(e=>"Modifying"===e.data.to);if(t)return t.data.from}))}transitionToStateOrThrow(e,t){return this.dataService.order.transitionToState(e,t).pipe((0,v.U)(({transitionOrderToState:e})=>{switch(null==e?void 0:e.__typename){case"Order":return null==e?void 0:e.state;case"OrderStateTransitionError":throw this.notificationService.error(null==e?void 0:e.transitionError),new Error(null==e?void 0:e.transitionError)}}))}}hi.\u0275fac=function(e){return new(e||hi)(r.LFG(o.DoR),r.LFG(o.Z7U),r.LFG(o.gqp),r.LFG(o.Dp7))},hi.\u0275prov=r.Yz7({factory:function(){return new hi(r.LFG(o.DoR),r.LFG(o.Z7U),r.LFG(o.gqp),r.LFG(o.Dp7))},token:hi,providedIn:"root"}),hi.ctorParameters=()=>[{type:o.DoR},{type:o.Z7U},{type:o.gqp},{type:o.Dp7}];const Zi=N.Ps`
    query GetCustomerAddresses($customerId: ID!) {
        customer(id: $customerId) {
            id
            addresses {
                ...Address
            }
        }
    }
    ${o.UYy}
`;class xi{constructor(e,t){this.dataService=e,this.formBuilder=t,this.useExisting=!0,this.createNew=!1}ngOnInit(){var e,t,n,r,o,s,a,c,l,u,p,g,f,m,h,Z,x,v;this.addressForm=this.formBuilder.group({fullName:[null!==(t=null===(e=this.currentAddress)||void 0===e?void 0:e.fullName)&&void 0!==t?t:""],company:[null!==(r=null===(n=this.currentAddress)||void 0===n?void 0:n.company)&&void 0!==r?r:""],streetLine1:[null!==(s=null===(o=this.currentAddress)||void 0===o?void 0:o.streetLine1)&&void 0!==s?s:"",i.kI.required],streetLine2:[null!==(c=null===(a=this.currentAddress)||void 0===a?void 0:a.streetLine2)&&void 0!==c?c:""],city:[null!==(u=null===(l=this.currentAddress)||void 0===l?void 0:l.city)&&void 0!==u?u:"",i.kI.required],province:[null!==(g=null===(p=this.currentAddress)||void 0===p?void 0:p.province)&&void 0!==g?g:""],postalCode:[null!==(m=null===(f=this.currentAddress)||void 0===f?void 0:f.postalCode)&&void 0!==m?m:"",i.kI.required],countryCode:[null!==(Z=null===(h=this.currentAddress)||void 0===h?void 0:h.countryCode)&&void 0!==Z?Z:"",i.kI.required],phoneNumber:[null!==(v=null===(x=this.currentAddress)||void 0===x?void 0:x.phoneNumber)&&void 0!==v?v:""]}),this.useExisting=!!this.customerId,this.addresses$=this.customerId?this.dataService.query(Zi,{customerId:this.customerId}).mapSingle(({customer:e})=>{var t;return null!==(t=null==e?void 0:e.addresses)&&void 0!==t?t:[]}).pipe((0,q.b)(e=>{this.currentAddress&&(this.selectedAddress=e.find(e=>{var t,n;return e.streetLine1===(null===(t=this.currentAddress)||void 0===t?void 0:t.streetLine1)&&e.postalCode===(null===(n=this.currentAddress)||void 0===n?void 0:n.postalCode)})),0===e.length&&(this.createNew=!0,this.useExisting=!1)})):(0,d.of)([]),this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(({countries:e})=>e.items)}trackByFn(e){return e.id}addressIdFn(e){return e.streetLine1+e.postalCode}cancel(){this.resolveWith()}select(){if(this.useExisting&&this.selectedAddress&&this.resolveWith(Object.assign(Object.assign({},(0,F.e)(this.selectedAddress,["fullName","company","streetLine1","streetLine2","city","province","phoneNumber","postalCode"])),{countryCode:this.selectedAddress.country.code})),this.createNew&&this.addressForm.valid){const e=this.addressForm.value;this.resolveWith(e)}}}xi.\u0275fac=function(e){return new(e||xi)(r.Y36(o.DoR),r.Y36(i.qu))},xi.\u0275cmp=r.Xpm({type:xi,selectors:[["vdr-select-address-dialog"]],decls:4,vars:3,consts:[["vdrDialogTitle",""],[4,"ngIf"],["vdrDialogButtons",""],["clrTabLink",""],[3,"clrIfActive","clrIfActiveChange"],[1,"block","mt4",3,"idFn","selectedItemId","selectItem"],[3,"item",4,"ngFor","ngForOf"],[3,"item"],[3,"address"],[3,"formGroup","availableCountries"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(r.YNc(0,ne,2,3,"ng-template",0),r.YNc(1,ae,7,5,"clr-tabs",1),r.ALo(2,"async"),r.YNc(3,ce,6,7,"ng-template",2)),2&e&&(r.xp6(1),r.Q6J("ngIf",r.lcZ(2,1,t.addresses$)))},directives:[o.q6K,P.O5,o.nPI,Q.gKI,Q.dl,Q.S4y,Q.Iq$,Q.Qs7,Q.tam,Q.UkA,o.myM,P.sg,o.C9C,o.b28,o.CY4,i.JL,i.sg],pipes:[P.Ov,S.X$],styles:[""],changeDetection:0}),xi.ctorParameters=()=>[{type:o.DoR},{type:i.qu}];class vi{constructor(e,t){this.dataService=e,this.formBuilder=t,this.isLoading=!1,this.input$=new a.xQ,this.selectedCustomer=[],this.useExisting=!0,this.createNew=!1,this.customerForm=this.formBuilder.group({title:"",firstName:["",i.kI.required],lastName:["",i.kI.required],phoneNumber:"",emailAddress:["",[i.kI.required,i.kI.email]]})}ngOnInit(){this.customers$=(0,c.z)((0,d.of)([]),this.input$.pipe((0,T.b)(200),(0,Z.x)(),(0,q.b)(()=>this.isLoading=!0),(0,x.w)(e=>this.dataService.customer.getCustomerList(10,0,e).mapStream(({customers:e})=>e.items).pipe((0,A.K)(()=>(0,d.of)([])),(0,q.b)(()=>this.isLoading=!1)))))}trackByFn(e){return e.id}cancel(){this.resolveWith()}select(){if(this.useExisting&&1===this.selectedCustomer.length&&this.resolveWith(this.selectedCustomer[0]),this.createNew&&this.customerForm.valid){const e=this.customerForm.value;this.resolveWith(e)}}}vi.\u0275fac=function(e){return new(e||vi)(r.Y36(o.DoR),r.Y36(i.qu))},vi.\u0275cmp=r.Xpm({type:vi,selectors:[["vdr-select-customer-dialog"]],decls:13,vars:8,consts:[["vdrDialogTitle",""],["clrTabLink",""],[3,"clrIfActive","clrIfActiveChange"],["vdrDialogButtons",""],["appendTo","body","bindLabel","name",1,"mt4",3,"items","addTag","multiple","hideSelected","trackByFn","minTermLength","loading","typeahead","ngModel","ngModelChange"],["ng-label-tmp",""],["ng-option-tmp",""],["shape","user",1,"is-solid"],[1,"ml2","mr2"],[3,"formGroup"],["for","title",3,"label"],["id","title","type","text","formControlName","title"],["for","firstName",3,"label"],["id","firstName","type","text","formControlName","firstName"],["for","lastName",3,"label"],["id","lastName","type","text","formControlName","lastName"],["for","emailAddress",3,"label"],["id","emailAddress","type","text","formControlName","emailAddress"],["for","phoneNumber",3,"label"],["id","phoneNumber","type","text","formControlName","phoneNumber"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(r.YNc(0,le,2,3,"ng-template",0),r.TgZ(1,"clr-tabs"),r.TgZ(2,"clr-tab"),r.TgZ(3,"button",1),r._uU(4),r.ALo(5,"translate"),r.qZA(),r.YNc(6,pe,5,11,"ng-template",2),r.NdJ("clrIfActiveChange",function(e){return t.useExisting=e}),r.qZA(),r.TgZ(7,"clr-tab"),r.TgZ(8,"button",1),r._uU(9),r.ALo(10,"translate"),r.qZA(),r.YNc(11,ge,17,16,"ng-template",2),r.NdJ("clrIfActiveChange",function(e){return t.createNew=e}),r.qZA(),r.qZA(),r.YNc(12,fe,6,7,"ng-template",3)),2&e&&(r.xp6(4),r.Oqu(r.lcZ(5,4,"order.existing-customer")),r.xp6(2),r.Q6J("clrIfActive",t.useExisting),r.xp6(3),r.Oqu(r.lcZ(10,6,"customer.create-new-customer")),r.xp6(2),r.Q6J("clrIfActive",t.createNew))},directives:[o.q6K,Q.gKI,Q.dl,Q.S4y,Q.Iq$,Q.Qs7,Q.tam,o.nPI,Q.UkA,M.w9,i.JJ,i.On,M.bb,M.Z2,Q.qvL,o.Ywx,i._Y,i.JL,i.sg,o.hgI,o.y_K,i.Fj,i.u],pipes:[S.X$,P.Ov],styles:[""],changeDetection:0}),vi.ctorParameters=()=>[{type:o.DoR},{type:i.qu}];class yi{constructor(){}ngOnInit(){this.currentSelectionId&&(this.selectedMethod=this.eligibleShippingMethods.find(e=>e.id===this.currentSelectionId))}methodIdFn(e){return e.id}cancel(){this.resolveWith()}select(){this.selectedMethod&&this.resolveWith(this.selectedMethod.id)}}yi.\u0275fac=function(e){return new(e||yi)},yi.\u0275cmp=r.Xpm({type:yi,selectors:[["vdr-select-shipping-method-dialog"]],decls:4,vars:3,consts:[["vdrDialogTitle",""],[3,"idFn","selectedItemId","selectItem"],[3,"item",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"item"],[1,"result-details"],[3,"label"],[1,"price-row"],[3,"value",4,"ngIf"],[3,"value"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(r.YNc(0,me,2,3,"ng-template",0),r.TgZ(1,"vdr-radio-card-fieldset",1),r.NdJ("selectItem",function(e){return t.selectedMethod=e}),r.YNc(2,Ze,15,20,"vdr-radio-card",2),r.qZA(),r.YNc(3,xe,6,7,"ng-template",3)),2&e&&(r.xp6(1),r.Q6J("idFn",t.methodIdFn)("selectedItemId",null==t.selectedMethod?null:t.selectedMethod.id),r.xp6(1),r.Q6J("ngForOf",t.eligibleShippingMethods))},directives:[o.q6K,o.myM,P.sg,o.nPI,o.C9C,o.WGc,P.O5,o._8q],pipes:[S.X$,o.kgx],styles:[""],changeDetection:0}),yi.ctorParameters=()=>[];class Ai extends o.UT_{constructor(e,t,n,r,o,s,c,l){super(t,e,n,o),this.changeDetector=r,this.dataService=o,this.notificationService=s,this.modalService=c,this.orderTransitionService=l,this.detailForm=new i.cw({}),this.fetchHistory=new a.xQ,this.displayCouponCodeInput=!1}ngOnInit(){this.init(),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.eligibleShippingMethods$=this.entity$.pipe((0,x.w)(e=>this.dataService.order.getDraftOrderEligibleShippingMethods(e.id).mapSingle(({eligibleShippingMethodsForDraftOrder:e})=>e))),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine")}ngOnDestroy(){this.destroy()}addItemToOrder(e){this.dataService.order.addItemToDraftOrder(this.id,e).subscribe(e=>{"Order"!==e.addItemToDraftOrder.__typename&&this.notificationService.error(e.addItemToDraftOrder.message)})}adjustOrderLine(e){this.dataService.order.adjustDraftOrderLine(this.id,{orderLineId:e.lineId,quantity:e.quantity}).subscribe(e=>{"Order"!==e.adjustDraftOrderLine.__typename&&this.notificationService.error(e.adjustDraftOrderLine.message)})}removeOrderLine(e){this.dataService.order.removeDraftOrderLine(this.id,e.lineId).subscribe(e=>{"Order"!==e.removeDraftOrderLine.__typename&&this.notificationService.error(e.removeDraftOrderLine.message)})}getOrderAddressLines(e){return e?Object.values(e).filter(e=>"OrderAddress"!==e).filter(e=>!!e):[]}setCustomer(){this.modalService.fromComponent(vi).subscribe(e=>{this.hasId(e)?this.dataService.order.setCustomerForDraftOrder(this.id,{customerId:e.id}).subscribe():e&&this.dataService.order.setCustomerForDraftOrder(this.id,{input:e}).subscribe()})}setShippingAddress(){this.entity$.pipe((0,C.q)(1),(0,x.w)(e=>{var t,n;return this.modalService.fromComponent(xi,{locals:{customerId:null===(t=e.customer)||void 0===t?void 0:t.id,currentAddress:null!==(n=e.shippingAddress)&&void 0!==n?n:void 0}})})).subscribe(e=>{e&&this.dataService.order.setDraftOrderShippingAddress(this.id,e).subscribe()})}setBillingAddress(){this.entity$.pipe((0,C.q)(1),(0,x.w)(e=>{var t,n;return this.modalService.fromComponent(xi,{locals:{customerId:null===(t=e.customer)||void 0===t?void 0:t.id,currentAddress:null!==(n=e.billingAddress)&&void 0!==n?n:void 0}})})).subscribe(e=>{e&&this.dataService.order.setDraftOrderBillingAddress(this.id,e).subscribe()})}applyCouponCode(e){this.dataService.order.applyCouponCodeToDraftOrder(this.id,e).subscribe()}removeCouponCode(e){this.dataService.order.removeCouponCodeFromDraftOrder(this.id,e).subscribe()}setShippingMethod(){(0,u.aj)(this.entity$,this.eligibleShippingMethods$).pipe((0,C.q)(1),(0,x.w)(([e,t])=>{var n,r;return this.modalService.fromComponent(yi,{locals:{eligibleShippingMethods:t,currencyCode:e.currencyCode,currentSelectionId:null===(r=null===(n=e.shippingLines)||void 0===n?void 0:n[0])||void 0===r?void 0:r.shippingMethod.id}})})).subscribe(e=>{e&&this.dataService.order.setDraftOrderShippingMethod(this.id,e).subscribe()})}updateCustomFields(e){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe()}deleteOrder(){this.dataService.order.deleteDraftOrder(this.id).subscribe(({deleteDraftOrder:e})=>{e.result===o.PcR.DELETED?(this.notificationService.success((0,s.J)("common.notify-delete-success"),{entity:"Order"}),this.router.navigate(["/orders"])):e.message&&this.notificationService.error(e.message)})}completeOrder(){this.dataService.order.transitionToState(this.id,"ArrangingPayment").subscribe(({transitionOrderToState:e})=>{"Order"===(null==e?void 0:e.__typename)?this.router.navigate(["/orders",this.id]):"OrderStateTransitionError"===(null==e?void 0:e.__typename)&&this.notificationService.error(e.transitionError)})}hasId(e){return"object"==typeof e&&!!e.id}setFormValues(e){}}Ai.\u0275fac=function(e){return new(e||Ai)(r.Y36(L.F0),r.Y36(L.gz),r.Y36(o.iHG),r.Y36(r.sBO),r.Y36(o.DoR),r.Y36(o.gqp),r.Y36(o.Z7U),r.Y36(hi))},Ai.\u0275cmp=r.Xpm({type:Ai,selectors:[["vdr-draft-order-detail"]],features:[r.qOj],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-primary",3,"disabled","click"],["shape","check"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","trash",1,"is-danger"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"orderLineCustomFields","currencyCode","addItem"],[3,"order","orderLineCustomFields","isDraft","adjust","remove"],[1,"flex"],["class","btn btn-link btn-sm mr2",3,"click",4,"ngIf"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],["shape","unknown-status","class","is-warning",4,"ngIf"],["shape","check","class","is-success",4,"ngIf"],[1,"card-block"],[1,"card-text"],["class","block mb2",3,"customer",4,"ngIf"],[1,"btn","btn-link","btn-sm",3,"click"],[1,"card-title"],["class","block mb2",3,"address",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"btn","btn-link","btn-sm","mr2",3,"click"],[3,"couponCodes","addCouponCode","removeCouponCode"],[1,"table"],["shape","unknown-status",1,"is-warning"],["shape","check",1,"is-success"],[1,"block","mb2",3,"customer"],[1,"block","mb2",3,"address"]],template:function(e,t){1&e&&(r.YNc(0,ve,19,11,"vdr-action-bar",0),r.ALo(1,"async"),r.YNc(2,Ue,52,41,"div",0),r.ALo(3,"async")),2&e&&(r.Q6J("ngIf",r.lcZ(1,2,t.entity$)),r.xp6(2),r.Q6J("ngIf",r.lcZ(3,4,t.entity$)))},directives:function(){return[P.O5,o.KkL,o.BND,o.Vqt,o.GXt,o.mz,Q.qvL,o.JOL,o.UaT,o.N9E,o.HH4,bi,Bi,P.sg,Li,Q.MgK,fi,o.d$,o.b28]},pipes:function(){return[P.Ov,S.X$,P.Zx,o.kgx]},styles:[""],changeDetection:0}),Ai.ctorParameters=()=>[{type:L.F0},{type:L.gz},{type:o.iHG},{type:r.sBO},{type:o.DoR},{type:o.gqp},{type:o.Z7U},{type:hi}];class bi{constructor(e){this.dataService=e,this.addItem=new r.vpe,this.customFieldsFormGroup=new i.cw({}),this.selectedVariantId$=new a.xQ,this.quantity=1}ngOnInit(){this.selectedVariant$=this.selectedVariantId$.pipe((0,x.w)(e=>e?this.dataService.product.getProductVariant(e).mapSingle(({productVariant:e})=>e):[void 0]));for(const e of this.orderLineCustomFields)this.customFieldsFormGroup.addControl(e.name,new i.NI(""))}addItemClick(e){e&&(this.addItem.emit({productVariantId:e.id,quantity:this.quantity,customFields:this.orderLineCustomFields.length?this.customFieldsFormGroup.value:void 0}),this.selectedVariantId$.next(void 0),this.customFieldsFormGroup.reset())}}bi.\u0275fac=function(e){return new(e||bi)(r.Y36(o.DoR))},bi.\u0275cmp=r.Xpm({type:bi,selectors:[["vdr-draft-order-variant-selector"]],inputs:{currencyCode:"currencyCode",orderLineCustomFields:"orderLineCustomFields"},outputs:{addItem:"addItem"},decls:8,vars:6,consts:[[1,"card"],[1,"card-block"],[1,"card-title"],[3,"productSelected"],["class","card-block",4,"ngIf"],[1,"variant-details"],[1,"mr2",3,"src"],[1,"details"],[1,"small"],[1,"details","ml4"],[1,"flex-spacer"],[1,"small",3,"title"],["type","number","min","0",3,"disabled","ngModel","ngModelChange"],[1,"btn","btn-small","btn-primary",3,"disabled","click"],[4,"ngIf"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"compact","readonly","customField","customFieldsFormGroup"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"h4",2),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"vdr-product-selector",3),r.NdJ("productSelected",function(e){return t.selectedVariantId$.next(e.productVariantId)}),r.qZA(),r.qZA(),r.YNc(6,Pe,31,32,"div",4),r.ALo(7,"async"),r.qZA()),2&e&&(r.xp6(3),r.Oqu(r.lcZ(4,2,"order.add-item-to-order")),r.xp6(3),r.Q6J("ngIf",r.lcZ(7,4,t.selectedVariant$)))},directives:[o.cyK,P.O5,o.y_K,i.qQ,i.wV,i.Fj,i.JJ,i.On,P.sg,o.M1s],pipes:[S.X$,P.Ov,o.Mgf,o.kgx],styles:[".variant-details[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-details[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img);width:32px;height:32px}.variant-details[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{font-size:.65rem;line-height:.7rem}.variant-details[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:48px;margin:0 6px}.variant-details[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}"],changeDetection:0}),bi.ctorParameters=()=>[{type:o.DoR}],bi.propDecorators={currencyCode:[{type:r.IIB}],orderLineCustomFields:[{type:r.IIB}],addItem:[{type:r.r_U}]};class Ci{constructor(e,t){this.dataService=e,this.changeDetector=t,this.fulfillmentHandlerControl=new i.NI,this.fulfillmentQuantities={}}ngOnInit(){this.dataService.settings.getGlobalSettings().single$.subscribe(({globalSettings:e})=>{this.fulfillmentQuantities=this.order.lines.reduce((t,n)=>{const r=this.getFulfillableCount(n,e.trackInventory);return Object.assign(Object.assign({},t),{[n.id]:{fulfillCount:r,max:r}})},{}),this.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(e=>e.fulfillmentHandlers).subscribe(e=>{this.fulfillmentHandlerDef=e.find(e=>{var t,n;return e.code===(null===(n=null===(t=this.order.shippingLines[0])||void 0===t?void 0:t.shippingMethod)||void 0===n?void 0:n.fulfillmentHandlerCode)})||e[0],this.fulfillmentHandler=(0,o.miO)(this.fulfillmentHandlerDef),this.fulfillmentHandlerControl.patchValue(this.fulfillmentHandler),this.changeDetector.markForCheck()})}getFulfillableCount(e,t){const{trackInventory:n,stockOnHand:r}=e.productVariant,i=n===o.TvZ.INHERIT?t:n===o.TvZ.TRUE,s=this.getUnfulfilledCount(e);return i?Math.min(s,r):s}getUnfulfilledCount(e){var t,n;const r=null!==(n=null===(t=e.fulfillments)||void 0===t?void 0:t.map(e=>e.summary).flat().filter(t=>t.orderLine.id===e.id).reduce((e,t)=>e+t.quantity,0))&&void 0!==n?n:0;return e.quantity-r}canSubmit(){const e=Object.values(this.fulfillmentQuantities).reduce((e,{fulfillCount:t})=>e+t,0);return(0,o.dOS)(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<e}select(){const e=Object.entries(this.fulfillmentQuantities).map(([e,{fulfillCount:t}])=>({orderLineId:e,quantity:t}));this.resolveWith({lines:e,handler:(0,o.RnJ)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}cancel(){this.resolveWith()}}Ci.\u0275fac=function(e){return new(e||Ci)(r.Y36(o.DoR),r.Y36(r.sBO))},Ci.\u0275cmp=r.Xpm({type:Ci,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(r.YNc(0,Qe,2,3,"ng-template",0),r.TgZ(1,"div",1),r.TgZ(2,"div",2),r.TgZ(3,"table",3),r.TgZ(4,"thead"),r.TgZ(5,"tr"),r._UZ(6,"th"),r.TgZ(7,"th"),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.TgZ(10,"th"),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"th"),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"th"),r._uU(17),r.ALo(18,"translate"),r.qZA(),r.TgZ(19,"th"),r._uU(20),r.ALo(21,"translate"),r.qZA(),r.qZA(),r.qZA(),r.YNc(22,Ye,13,8,"tr",4),r.qZA(),r.qZA(),r.TgZ(23,"div",5),r._UZ(24,"vdr-formatted-address",6),r.TgZ(25,"h6"),r._uU(26),r.ALo(27,"translate"),r.qZA(),r._uU(28),r.TgZ(29,"strong"),r._uU(30),r.ALo(31,"localeCurrency"),r.qZA(),r._UZ(32,"vdr-configurable-input",7),r.qZA(),r.qZA(),r.YNc(33,je,6,7,"ng-template",8)),2&e&&(r.xp6(8),r.Oqu(r.lcZ(9,14,"order.product-name")),r.xp6(3),r.Oqu(r.lcZ(12,16,"order.product-sku")),r.xp6(3),r.Oqu(r.lcZ(15,18,"order.unfulfilled")),r.xp6(3),r.Oqu(r.lcZ(18,20,"catalog.stock-on-hand")),r.xp6(3),r.Oqu(r.lcZ(21,22,"order.fulfill")),r.xp6(2),r.Q6J("ngForOf",t.order.lines),r.xp6(2),r.Q6J("address",t.order.shippingAddress),r.xp6(2),r.Oqu(r.lcZ(27,24,"order.shipping-method")),r.xp6(2),r.hij(" ",null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name," "),r.xp6(2),r.Oqu(r.xi3(31,26,t.order.shipping,t.order.currencyCode)),r.xp6(2),r.Q6J("operationDefinition",t.fulfillmentHandlerDef)("operation",t.fulfillmentHandler)("formControl",t.fulfillmentHandlerControl)("removable",!1))},directives:[o.q6K,P.sg,o.b28,o.qq8,i.JJ,i.oH,o.nPI,P.O5,o.y_K,i.qQ,i.wV,i.Fd,i.Fj,i.On],pipes:[S.X$,o.kgx,o.Mgf],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0}),Ci.ctorParameters=()=>[{type:o.DoR},{type:r.sBO}];class qi{constructor(){this.transitionState=new r.vpe}nextSuggestedState(){var e;if(!this.fulfillment)return;const{nextStates:t}=this.fulfillment,n=e=>t.includes(e)?e:t[0];switch(null===(e=this.fulfillment)||void 0===e?void 0:e.state){case"Pending":return n("Shipped");case"Shipped":return n("Delivered");default:return t.find(e=>"Cancelled"!==e)}}nextOtherStates(){if(!this.fulfillment)return[];const e=this.nextSuggestedState();return this.fulfillment.nextStates.filter(t=>t!==e)}}qi.\u0275fac=function(e){return new(e||qi)},qi.\u0275cmp=r.Xpm({type:qi,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:10,vars:6,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"div"),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"div",2),r._UZ(6,"vdr-fulfillment-state-label",3),r.qZA(),r.qZA(),r.TgZ(7,"div",4),r.YNc(8,Ee,1,2,"vdr-fulfillment-detail",5),r.qZA(),r.YNc(9,Ve,7,2,"div",6),r.qZA()),2&e&&(r.xp6(3),r.Oqu(r.lcZ(4,4,"order.fulfillment")),r.xp6(3),r.Q6J("state",null==t.fulfillment?null:t.fulfillment.state),r.xp6(2),r.Q6J("ngIf",!!t.fulfillment),r.xp6(1),r.Q6J("ngIf",null==t.fulfillment?null:t.fulfillment.nextStates.length))},directives:function(){return[Oi,P.O5,Ti,o.JOL,o.UaT,Q.qvL,o.N9E,P.sg,o.HH4]},pipes:function(){return[S.X$,o.Nir]},styles:[".fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0}),qi.propDecorators={fulfillment:[{type:r.IIB}],order:[{type:r.IIB}],transitionState:[{type:r.r_U}]};class Ti{constructor(e){this.serverConfigService=e,this.customFieldConfig=[],this.customFieldFormGroup=new i.cw({})}ngOnInit(){this.customFieldConfig=this.serverConfigService.getCustomFieldsFor("Fulfillment")}ngOnChanges(e){this.buildCustomFieldsFormGroup()}get fulfillment(){return this.order.fulfillments&&this.order.fulfillments.find(e=>e.id===this.fulfillmentId)}get items(){var e,t;return null!==(t=null===(e=this.fulfillment)||void 0===e?void 0:e.summary.map(e=>{var t,n;return{name:null!==(n=null===(t=this.order.lines.find(t=>t.id===e.orderLine.id))||void 0===t?void 0:t.productVariant.name)&&void 0!==n?n:"",quantity:e.quantity}}))&&void 0!==t?t:[]}buildCustomFieldsFormGroup(){const e=this.fulfillment.customFields;for(const t of this.serverConfigService.getCustomFieldsFor("Fulfillment"))this.customFieldFormGroup.addControl(t.name,new i.NI(e[t.name]))}customFieldIsObject(e){return Array.isArray(e)||(0,J.isObject)(e)}}Ti.\u0275fac=function(e){return new(e||Ti)(r.Y36(o.iHG))},Ti.\u0275cmp=r.Xpm({type:Ti,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},features:[r.TTD],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"readonly","compact","customField","customFieldsFormGroup",4,"ngIf"],[3,"readonly","compact","customField","customFieldsFormGroup"]],template:function(e,t){1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._uU(2),r.ALo(3,"localeDate"),r.qZA(),r.TgZ(4,"vdr-labeled-data",0),r.ALo(5,"translate"),r._uU(6),r.qZA(),r.YNc(7,Ge,3,4,"vdr-labeled-data",1),r.TgZ(8,"vdr-labeled-data",0),r.ALo(9,"translate"),r._UZ(10,"vdr-simple-item-list",2),r.qZA(),r.YNc(11,Ke,2,1,"ng-container",3)),2&e&&(r.Q6J("label",r.lcZ(1,8,"common.created-at")),r.xp6(2),r.hij(" ",r.xi3(3,10,null==t.fulfillment?null:t.fulfillment.createdAt,"medium"),"\n"),r.xp6(2),r.Q6J("label",r.lcZ(5,13,"order.fulfillment-method")),r.xp6(2),r.hij(" ",null==t.fulfillment?null:t.fulfillment.method,"\n"),r.xp6(1),r.Q6J("ngIf",null==t.fulfillment?null:t.fulfillment.trackingCode),r.xp6(1),r.Q6J("label",r.lcZ(9,15,"order.contents")),r.xp6(2),r.Q6J("items",t.items),r.xp6(1),r.Q6J("ngForOf",t.customFieldConfig))},directives:function(){return[o.WGc,P.O5,Ki,P.sg,o.M1s]},pipes:function(){return[S.X$,o.HbD]},styles:[""],changeDetection:0}),Ti.ctorParameters=()=>[{type:o.iHG}],Ti.propDecorators={fulfillmentId:[{type:r.IIB}],order:[{type:r.IIB}]};class Oi{get chipColorType(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}Oi.\u0275fac=function(e){return new(e||Oi)},Oi.\u0275cmp=r.Xpm({type:Oi,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(r.TgZ(0,"vdr-chip",0),r.ALo(1,"translate"),r.YNc(2,Xe,1,0,"clr-icon",1),r._uU(3),r.ALo(4,"translate"),r.ALo(5,"stateI18nToken"),r.qZA()),2&e&&(r.Q6J("title",r.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),r.xp6(2),r.Q6J("ngIf","Delivered"===t.state),r.xp6(1),r.hij(" ",r.lcZ(4,6,r.lcZ(5,8,t.state)),"\n"))},directives:[o.Ywx,P.O5,Q.qvL],pipes:[S.X$,o.Nir],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),Oi.propDecorators={state:[{type:r.IIB}]};class _i{constructor(){this.fulfilledCount=0,this.fulfillments=[]}ngOnChanges(e){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.items.length),this.fulfillments=this.getFulfillments(this.line))}getDeliveredCount(e){var t,n;return null!==(n=null===(t=e.fulfillments)||void 0===t?void 0:t.reduce((t,n)=>{var r,i;return t+(null!==(i=null===(r=n.summary.find(t=>t.orderLine.id===e.id))||void 0===r?void 0:r.quantity)&&void 0!==i?i:0)},0))&&void 0!==n?n:0}getFulfillmentStatus(e,t){return e===t?"full":0<e&&e<t?"partial":"none"}getFulfillments(e){var t,n;return null!==(n=null===(t=e.fulfillments)||void 0===t?void 0:t.map(t=>{var n;const r=t.summary.find(t=>t.orderLine.id===e.id);return{count:null!==(n=null==r?void 0:r.quantity)&&void 0!==n?n:0,fulfillment:t}}))&&void 0!==n?n:[]}}_i.\u0275fac=function(e){return new(e||_i)},_i.\u0275cmp=r.Xpm({type:_i,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",orderState:"orderState"},features:[r.TTD],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(e,t){1&e&&r.YNc(0,lt,10,7,"vdr-dropdown",0),2&e&&r.Q6J("ngIf",t.fulfilledCount||"PartiallyDelivered"===t.orderState)},directives:[P.O5,o.JOL,o.UaT,o.N9E,P.sg,Q.qvL,Q.MgK,o.WGc],pipes:[S.X$,o.HbD],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-500)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-500)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-500)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0}),_i.propDecorators={line:[{type:r.IIB}],orderState:[{type:r.IIB}]};class Ii{getRefundedCount(){var e,t;const n=null!==(t=null===(e=this.payments)||void 0===e?void 0:e.reduce((e,t)=>[...e,...t.refunds],[]))&&void 0!==t?t:[];return this.line.items.filter(e=>{if(null===e.refundId&&!e.cancelled)return!1;if(e.refundId){const t=n.find(t=>t.id===e.refundId);return"Failed"!==(null==t?void 0:t.state)}return!1}).length}}Ii.\u0275fac=function(e){return new(e||Ii)},Ii.\u0275cmp=r.Xpm({type:Ii,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(e,t){1&e&&r.YNc(0,dt,3,6,"span",0),2&e&&r.Q6J("ngIf",t.getRefundedCount())},directives:[P.O5,Q.qvL,k.Lv],pipes:[S.X$],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0}),Ii.propDecorators={line:[{type:r.IIB}],payments:[{type:r.IIB}]};class wi{constructor(){this.addedItems=new Map,this.removedItems=new Map}ngOnChanges(){const{added:e,removed:t}=this.getModifiedLines();this.addedItems=e,this.removedItems=t}getSurcharge(e){return this.order.surcharges.find(t=>t.id===e)}getAddedItems(){return[...this.addedItems.entries()].map(([e,t])=>({name:e.productVariant.name,quantity:t}))}getRemovedItems(){return[...this.removedItems.entries()].map(([e,t])=>({name:e.productVariant.name,quantity:t}))}getModifiedLines(){var e,t;const n=new Map,r=new Map;for(const i of this.modification.orderItems||[]){const o=this.getOrderLineAndItem(i.id);if(o){const{line:i,item:s}=o;if(s.cancelled){const t=null!==(e=r.get(i))&&void 0!==e?e:0;r.set(i,t+1)}else{const e=null!==(t=n.get(i))&&void 0!==t?t:0;n.set(i,e+1)}}}return{added:n,removed:r}}getOrderLineAndItem(e){for(const t of this.order.lines){const n=t.items.find(t=>t.id===e);if(n)return{line:t,item:n}}}}wi.\u0275fac=function(e){return new(e||wi)},wi.\u0275cmp=r.Xpm({type:wi,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[r.TTD],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(e,t){1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._uU(2),r.qZA(),r.YNc(3,ut,3,4,"vdr-labeled-data",1),r.YNc(4,pt,4,8,"vdr-labeled-data",2),r.YNc(5,gt,3,4,"vdr-labeled-data",1),r.YNc(6,ft,3,4,"vdr-labeled-data",1)),2&e&&(r.Q6J("label",r.lcZ(1,6,"common.ID")),r.xp6(2),r.Oqu(t.modification.id),r.xp6(1),r.Q6J("ngIf",t.modification.note),r.xp6(1),r.Q6J("ngForOf",t.modification.surcharges),r.xp6(1),r.Q6J("ngIf",t.getAddedItems().length),r.xp6(1),r.Q6J("ngIf",t.getRemovedItems().length))},directives:function(){return[o.WGc,P.O5,P.sg,Ki]},pipes:function(){return[S.X$,o.kgx]},styles:[""],changeDetection:0}),wi.propDecorators={order:[{type:r.IIB}],modification:[{type:r.IIB}]};class Li{constructor(e,t){this.formBuilder=e,this.modalService=t,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new r.vpe,this.editable=!1}ngOnInit(){this.customFieldForm=this.formBuilder.group({});for(const e of this.customFieldsConfig)this.customFieldForm.addControl(e.name,this.formBuilder.control(this.customFieldValues[e.name]))}onUpdateClick(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}onCancelClick(){this.customFieldForm.dirty?this.modalService.dialog({title:(0,s.J)("catalog.confirm-cancel"),buttons:[{type:"secondary",label:(0,s.J)("common.keep-editing")},{type:"danger",label:(0,s.J)("common.discard-changes"),returnValue:!0}]}).subscribe(e=>{e&&(this.customFieldForm.reset(),this.customFieldForm.markAsPristine(),this.editable=!1)}):this.editable=!1}}Li.\u0275fac=function(e){return new(e||Li)(r.Y36(i.qu),r.Y36(o.Z7U))},Li.\u0275cmp=r.Xpm({type:Li,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],["entityName","Order",3,"customFields","customFieldsFormGroup","readonly","compact"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"],["shape","times"]],template:function(e,t){1&e&&r.YNc(0,xt,11,12,"div",0),2&e&&r.Q6J("ngIf",t.customFieldsConfig.length)},directives:[P.O5,o.yc0,Q.qvL],pipes:[S.X$],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0}),Li.ctorParameters=()=>[{type:i.qu},{type:o.Z7U}],Li.propDecorators={customFieldsConfig:[{type:r.IIB}],customFieldValues:[{type:r.IIB}],updateClick:[{type:r.r_U}]};class Fi{constructor(e){this.serverConfigService=e,this.states=[]}ngOnInit(){this.states=this.serverConfigService.getOrderProcessStates()}}Fi.\u0275fac=function(e){return new(e||Fi)(r.Y36(o.iHG))},Fi.\u0275cmp=r.Xpm({type:Fi,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(e,t){1&e&&(r.YNc(0,vt,2,3,"ng-template",0),r._UZ(1,"vdr-order-process-graph",1)),2&e&&(r.xp6(1),r.Q6J("states",t.states)("initialState",t.activeState))},directives:function(){return[o.q6K,Hi]},pipes:function(){return[S.X$]},styles:[""],changeDetection:0}),Fi.ctorParameters=()=>[{type:o.iHG}];class Ni{constructor(e){var t;this.i18nService=e,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=null!==(t=(0,o.hq7)().cancellationReasons)&&void 0!==t?t:[(0,s.J)("order.refund-reason-customer-request"),(0,s.J)("order.refund-reason-not-available")],this.reasons=this.reasons.map(e=>this.i18nService.translate(e))}get refundTotal(){return this.order.lines.reduce((e,t)=>{const n=this.lineQuantities[t.id],r=n.refund&&n.quantity||0;return e+t.proratedUnitPriceWithTax*r},0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}get settledPaymentsTotal(){return this.settledPayments.map(e=>e.amount-(0,J.summate)(e.refunds.filter(e=>"Failed"!==e.state),"total")).reduce((e,t)=>e+t,0)}lineCanBeRefundedOrCancelled(e){var t,n;const r=null!==(n=null===(t=this.order.payments)||void 0===t?void 0:t.reduce((e,t)=>[...e,...t.refunds],[]))&&void 0!==n?n:[];return 0<e.items.filter(e=>{if(e.cancelled)return!1;if(null==e.refundId)return!0;const t=r.find(t=>t.id===e.refundId);return"Failed"===(null==t?void 0:t.state)}).length}ngOnInit(){this.lineQuantities=this.order.lines.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.id]:{quantity:0,refund:!1,cancel:!1}}),{}),this.settledPayments=(this.order.payments||[]).filter(e=>"Settled"===e.state),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}handleZeroQuantity(e){0===(null==e?void 0:e.quantity)&&(e.cancel=!1,e.refund=!1)}isRefunding(){return Object.values(this.lineQuantities).reduce((e,t)=>e||0<t.quantity&&t.refund,!1)}isCancelling(){return Object.values(this.lineQuantities).reduce((e,t)=>e||0<t.quantity&&t.cancel,!1)}canSubmit(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.settledPaymentsTotal):!!this.isCancelling()&&!!this.reason}select(){const e=this.selectedPayment;if(e){const t=this.getOrderLineInput(e=>e.refund),n=this.getOrderLineInput(e=>e.cancel);this.resolveWith({refund:{lines:t,reason:this.reason,shipping:this.refundShipping?this.order.shippingWithTax:0,adjustment:this.adjustment,paymentId:e.id},cancel:{lines:n,orderId:this.order.id,reason:this.reason,cancelShipping:this.refundShipping}})}}cancel(){this.resolveWith()}getOrderLineInput(e){return Object.entries(this.lineQuantities).filter(([t,n])=>0<n.quantity&&e(n)).map(([e,t])=>({orderLineId:e,quantity:t.quantity}))}}Ni.\u0275fac=function(e){return new(e||Ni)(r.Y36(o.Dp7))},Ni.\u0275cmp=r.Xpm({type:Ni,selectors:[["vdr-refund-order-dialog"]],decls:69,vars:76,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["class","refund-total-warning",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line","payments"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","quantity-col"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],[1,"refund-total-warning"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(e,t){1&e&&(r.YNc(0,yt,2,3,"ng-template",0),r.TgZ(1,"div",1),r.TgZ(2,"div",2),r.TgZ(3,"table",3),r.TgZ(4,"thead"),r.TgZ(5,"tr"),r._UZ(6,"th"),r.TgZ(7,"th"),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.TgZ(10,"th"),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"th"),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"th"),r._uU(17),r.ALo(18,"translate"),r.qZA(),r.TgZ(19,"th"),r._uU(20),r.ALo(21,"translate"),r.qZA(),r.TgZ(22,"th"),r._uU(23),r.ALo(24,"translate"),r.qZA(),r.TgZ(25,"th"),r._uU(26),r.ALo(27,"translate"),r.qZA(),r.TgZ(28,"th"),r._uU(29),r.ALo(30,"translate"),r.qZA(),r.qZA(),r.qZA(),r.YNc(31,_t,27,21,"tr",4),r.qZA(),r.qZA(),r.TgZ(32,"div",5),r.TgZ(33,"div"),r.TgZ(34,"label",6),r._uU(35),r.ALo(36,"translate"),r.qZA(),r.TgZ(37,"ng-select",7),r.NdJ("ngModelChange",function(e){return t.reason=e}),r.ALo(38,"translate"),r.qZA(),r.qZA(),r.TgZ(39,"div"),r.TgZ(40,"clr-select-container"),r.TgZ(41,"label"),r._uU(42),r.ALo(43,"translate"),r.qZA(),r.TgZ(44,"select",8),r.NdJ("ngModelChange",function(e){return t.selectedPayment=e}),r.YNc(45,It,3,8,"option",9),r.qZA(),r.qZA(),r.TgZ(46,"clr-checkbox-wrapper"),r.TgZ(47,"input",10),r.NdJ("ngModelChange",function(e){return t.refundShipping=e}),r.qZA(),r.TgZ(48,"label"),r._uU(49),r.ALo(50,"translate"),r.ALo(51,"localeCurrency"),r.qZA(),r.qZA(),r.TgZ(52,"clr-input-container"),r.TgZ(53,"label"),r._uU(54),r.ALo(55,"translate"),r.qZA(),r.TgZ(56,"vdr-currency-input",11),r.NdJ("ngModelChange",function(e){return t.adjustment=e}),r.qZA(),r.qZA(),r.TgZ(57,"div",12),r.TgZ(58,"div",13),r._uU(59),r.ALo(60,"translate"),r.ALo(61,"localeCurrency"),r.qZA(),r.TgZ(62,"div",14),r._uU(63),r.ALo(64,"translate"),r.ALo(65,"localeCurrency"),r.qZA(),r.YNc(66,Lt,5,13,"div",15),r.YNc(67,Ft,3,3,"div",16),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.YNc(68,Mt,7,6,"ng-template",17)),2&e&&(r.xp6(8),r.Oqu(r.lcZ(9,37,"order.product-name")),r.xp6(3),r.Oqu(r.lcZ(12,39,"order.product-sku")),r.xp6(3),r.Oqu(r.lcZ(15,41,"order.quantity")),r.xp6(3),r.Oqu(r.lcZ(18,43,"order.unit-price")),r.xp6(3),r.Oqu(r.lcZ(21,45,"order.prorated-unit-price")),r.xp6(3),r.Oqu(r.lcZ(24,47,"order.quantity")),r.xp6(3),r.Oqu(r.lcZ(27,49,"order.refund")),r.xp6(3),r.Oqu(r.lcZ(30,51,"order.cancel")),r.xp6(2),r.Q6J("ngForOf",t.order.lines),r.xp6(1),r.ekj("faded",!t.isRefunding()&&!t.isCancelling()),r.xp6(3),r.Oqu(r.lcZ(36,53,"order.refund-cancellation-reason")),r.xp6(2),r.Q6J("disabled",!t.isRefunding()&&!t.isCancelling())("items",t.reasons)("placeholder",r.lcZ(38,55,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",t.reason),r.xp6(5),r.Oqu(r.lcZ(43,57,"order.payment-to-refund")),r.xp6(2),r.Q6J("ngModel",t.selectedPayment)("disabled",!t.isRefunding()),r.xp6(1),r.Q6J("ngForOf",t.settledPayments),r.xp6(2),r.Q6J("ngModel",t.refundShipping)("disabled",!t.isRefunding()),r.xp6(2),r.AsE(" ",r.lcZ(50,59,"order.refund-shipping")," (",r.xi3(51,61,t.order.shippingWithTax,t.order.currencyCode),") "),r.xp6(5),r.Oqu(r.lcZ(55,64,"order.refund-adjustment")),r.xp6(2),r.Q6J("disabled",!t.isRefunding())("currencyCode",t.order.currencyCode)("ngModel",t.adjustment),r.xp6(1),r.ekj("disabled",!t.isRefunding()),r.xp6(2),r.AsE(" ",r.lcZ(60,66,"order.payment-amount"),": ",r.xi3(61,68,t.selectedPayment.amount,t.order.currencyCode)," "),r.xp6(4),r.AsE(" ",r.lcZ(64,71,"order.refund-total"),": ",r.xi3(65,73,t.refundTotal,t.order.currencyCode)," "),r.xp6(3),r.Q6J("ngIf",t.refundTotal<0||t.settledPaymentsTotal<t.refundTotal),r.xp6(1),r.Q6J("ngIf",t.selectedPayment.amount<t.refundTotal))},directives:[o.q6K,P.sg,Q.MgK,M.w9,i.JJ,i.On,Q.dTv,o.y_K,i.EJ,Q.otW,Q.PEh,i.Wl,Q.KKC,Q.G55,o.KQz,Q.xRP,P.O5,o.nPI,Ii,o.JOL,o.UaT,Q.qvL,o.N9E,i.qQ,i.wV,i.Fd,i.Fj,i.YN,i.Kr],pipes:[S.X$,o.kgx,o.Mgf,P.H9,P.JJ],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.quantity-col[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.refund-details.faded[_ngcontent-%COMP%]{opacity:.5}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals[_ngcontent-%COMP%]   .refund-total-warning[_ngcontent-%COMP%]{color:var(--color-warning-600);max-width:250px}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}),Ni.ctorParameters=()=>[{type:o.Dp7}];class Ji{constructor(){this.transactionId=""}submit(){this.resolveWith(this.transactionId)}cancel(){this.resolveWith()}}Ji.\u0275fac=function(e){return new(e||Ji)},Ji.\u0275cmp=r.Xpm({type:Ji,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(r.YNc(0,St,2,3,"ng-template",0),r.TgZ(1,"p",1),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"clr-input-container"),r.TgZ(5,"label"),r._uU(6),r.ALo(7,"translate"),r.qZA(),r.TgZ(8,"input",2),r.NdJ("ngModelChange",function(e){return t.transactionId=e}),r.qZA(),r.qZA(),r.YNc(9,Pt,6,7,"ng-template",3)),2&e&&(r.xp6(2),r.hij(" ",r.xi3(3,3,"order.settle-refund-manual-instructions",r.VKq(8,Qt,t.refund.method)),"\n"),r.xp6(4),r.Oqu(r.lcZ(7,6,"order.transaction-id")),r.xp6(2),r.Q6J("ngModel",t.transactionId))},directives:[o.q6K,Q.G55,Q.MgK,o.y_K,i.Fj,Q.xRP,i.JJ,i.On,o.nPI],pipes:[S.X$],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}"],changeDetection:0});class Ui extends o.UT_{constructor(e,t,n,r,o,s,c,l){super(t,e,n,o),this.changeDetector=r,this.dataService=o,this.notificationService=s,this.modalService=c,this.orderTransitionService=l,this.detailForm=new i.cw({}),this.fetchHistory=new a.xQ,this.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"]}ngOnInit(){this.init(),this.entity$.pipe((0,C.q)(1)).subscribe(e=>{"Modifying"===e.state&&this.router.navigate(["./","modify"],{relativeTo:this.route})}),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.history$=this.fetchHistory.pipe((0,y.O)(null),(0,x.w)(()=>this.dataService.order.getOrderHistory(this.id,{sort:{createdAt:o.Asd.DESC}}).mapStream(e=>{var t;return null===(t=e.order)||void 0===t?void 0:t.history.items}))),this.nextStates$=this.entity$.pipe((0,v.U)(e=>this.defaultStates.includes(e.state)?e.nextStates.filter(e=>!this.defaultStates.includes(e)):e.nextStates))}ngOnDestroy(){this.destroy()}openStateDiagram(){this.entity$.pipe((0,C.q)(1),(0,x.w)(e=>this.modalService.fromComponent(Fi,{closable:!0,locals:{activeState:e.state}}))).subscribe()}transitionToState(e){this.dataService.order.transitionToState(this.id,e).subscribe(({transitionOrderToState:t})=>{switch(null==t?void 0:t.__typename){case"Order":this.notificationService.success((0,s.J)("order.transitioned-to-state-success"),{state:e}),this.fetchHistory.next();break;case"OrderStateTransitionError":this.notificationService.error(t.transitionError)}})}manuallyTransitionToState(e){this.orderTransitionService.manuallyTransitionToState({orderId:e.id,nextStates:e.nextStates,cancellable:!0,message:(0,s.J)("order.manually-transition-to-state-message"),retry:0}).subscribe()}transitionToModifying(){this.dataService.order.transitionToState(this.id,"Modifying").subscribe(({transitionOrderToState:e})=>{switch(null==e?void 0:e.__typename){case"Order":this.router.navigate(["./modify"],{relativeTo:this.route});break;case"OrderStateTransitionError":this.notificationService.error(e.transitionError)}})}updateCustomFields(e){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe(()=>{this.notificationService.success((0,s.J)("common.notify-update-success"),{entity:"Order"})})}getOrderAddressLines(e){return e?Object.values(e).filter(e=>"OrderAddress"!==e).filter(e=>!!e):[]}settlePayment(e){this.dataService.order.settlePayment(e.id).subscribe(({settlePayment:e})=>{switch(e.__typename){case"Payment":"Settled"===e.state?this.notificationService.success((0,s.J)("order.settle-payment-success")):this.notificationService.error((0,s.J)("order.settle-payment-error")),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":this.notificationService.error(e.message)}})}transitionPaymentState({payment:e,state:t}){"Cancelled"===t?this.dataService.order.cancelPayment(e.id).subscribe(({cancelPayment:e})=>{switch(e.__typename){case"Payment":this.notificationService.success((0,s.J)("order.transitioned-payment-to-state-success"),{state:t}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(e.transitionError);break;case"CancelPaymentError":this.notificationService.error(e.paymentErrorMessage)}}):this.dataService.order.transitionPaymentToState(e.id,t).subscribe(({transitionPaymentToState:e})=>{switch(e.__typename){case"Payment":this.notificationService.success((0,s.J)("order.transitioned-payment-to-state-success"),{state:t}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(e.message)}})}canAddFulfillment(e){var t;const n=(null!==(t=e.fulfillments)&&void 0!==t?t:[]).reduce((e,t)=>[...e,...t.summary],[]);let r=!0;for(const i of e.lines)n.filter(e=>e.orderLine.id===i.id).reduce((e,t)=>e+t.quantity,0)<i.quantity&&(r=!1);return!r&&!this.hasUnsettledModifications(e)&&0===this.outstandingPaymentAmount(e)&&(e.nextStates.includes("Shipped")||e.nextStates.includes("PartiallyShipped")||e.nextStates.includes("Delivered"))}hasUnsettledModifications(e){return 0<e.modifications.filter(e=>!e.isSettled).length}getOutstandingModificationAmount(e){return(0,J.summate)(e.modifications.filter(e=>!e.isSettled),"priceChange")}outstandingPaymentAmount(e){var t,n,r;const i=e=>"Cancelled"!==e.state&&"Declined"!==e.state&&"Error"!==e.state;let o=0;for(const s of null!==(n=null===(t=e.payments)||void 0===t?void 0:t.filter(i))&&void 0!==n?n:[]){const e=null!==(r=s.refunds.filter(e=>"Failed"!==e.state))&&void 0!==r?r:[],t=(0,J.summate)(e,"total");o+=s.amount-t}return e.totalWithTax-o}addManualPayment(e){const t=e.state;this.modalService.fromComponent(pi,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(e),currencyCode:e.currencyCode}}).pipe((0,x.w)(e=>e?this.dataService.order.addManualPaymentToOrder({orderId:this.id,transactionId:e.transactionId,method:e.method,metadata:e.metadata||{}}):l.E),(0,x.w)(({addManualPaymentToOrder:n})=>{switch(n.__typename){case"Order":return this.notificationService.success((0,s.J)("order.add-payment-to-order-success")),"ArrangingAdditionalPayment"===t?this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates):this.dataService.order.transitionToState(this.id,"PaymentSettled").pipe((0,O.h)("PaymentSettled"));case"ManualPaymentStateError":return this.notificationService.error(n.message),l.E;default:return l.E}})).subscribe(e=>{e&&this.refetchOrder({result:e})})}fulfillOrder(){this.entity$.pipe((0,C.q)(1),(0,x.w)(e=>this.modalService.fromComponent(Ci,{size:"xl",locals:{order:e}})),(0,x.w)(e=>e?this.dataService.order.createFulfillment(e):(0,d.of)(void 0)),(0,x.w)(e=>this.refetchOrder(e).pipe((0,O.h)(e)))).subscribe(e=>{if(e){const{addFulfillmentToOrder:t}=e;switch(t.__typename){case"Fulfillment":this.notificationService.success((0,s.J)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":case"InvalidFulfillmentHandlerError":this.notificationService.error(t.message);break;case"FulfillmentStateTransitionError":this.notificationService.error(t.transitionError);break;case"CreateFulfillmentError":this.notificationService.error(t.fulfillmentHandlerError);break;case void 0:this.notificationService.error(JSON.stringify(t));break;default:(0,J.assertNever)(t)}}})}transitionFulfillment(e,t){this.dataService.order.transitionFulfillmentToState(e,t).pipe((0,x.w)(e=>this.refetchOrder(e))).subscribe(()=>{this.notificationService.success((0,s.J)("order.successfully-updated-fulfillment"))})}cancelOrRefund(e){const t=this.orderHasSettledPayments(e);"PaymentAuthorized"!==e.state&&!0!==e.active&&t?this.refundOrder(e):this.cancelOrder(e)}settleRefund(e){this.modalService.fromComponent(Ji,{size:"md",locals:{refund:e}}).pipe((0,x.w)(t=>t?this.dataService.order.settleRefund({transactionId:t,id:e.id},this.id):(0,d.of)(void 0))).subscribe(e=>{e&&this.notificationService.success((0,s.J)("order.settle-refund-success"))})}addNote(e){const{note:t,isPublic:n}=e;this.dataService.order.addNoteToOrder({id:this.id,note:t,isPublic:n}).pipe((0,x.w)(e=>this.refetchOrder(e))).subscribe(e=>{this.notificationService.success((0,s.J)("common.notify-create-success"),{entity:"Note"})})}updateNote(e){this.modalService.fromComponent(o.UlA,{closable:!0,locals:{displayPrivacyControls:!0,note:e.data.note,noteIsPrivate:!e.isPublic}}).pipe((0,x.w)(t=>t?this.dataService.order.updateOrderNote({noteId:e.id,isPublic:!t.isPrivate,note:t.note}):l.E)).subscribe(e=>{this.fetchHistory.next(),this.notificationService.success((0,s.J)("common.notify-update-success"),{entity:"Note"})})}deleteNote(e){return this.modalService.dialog({title:(0,s.J)("common.confirm-delete-note"),body:e.data.note,buttons:[{type:"secondary",label:(0,s.J)("common.cancel")},{type:"danger",label:(0,s.J)("common.delete"),returnValue:!0}]}).pipe((0,x.w)(t=>t?this.dataService.order.deleteOrderNote(e.id):l.E)).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success((0,s.J)("common.notify-delete-success"),{entity:"Note"})})}orderHasSettledPayments(e){var t;return!!(null===(t=e.payments)||void 0===t?void 0:t.find(e=>"Settled"===e.state))}cancelOrder(e){this.modalService.fromComponent(gi,{size:"xl",locals:{order:e}}).pipe((0,x.w)(e=>e?this.dataService.order.cancelOrder(e):(0,d.of)(void 0)),(0,x.w)(e=>this.refetchOrder(e))).subscribe(e=>{e&&this.notificationService.success((0,s.J)("order.cancelled-order-success"))})}refundOrder(e){this.modalService.fromComponent(Ni,{size:"xl",locals:{order:e}}).pipe((0,x.w)(e=>{var t;return e?(null===(t=e.cancel.lines)||void 0===t?void 0:t.length)?this.dataService.order.cancelOrder(e.cancel).pipe((0,v.U)(t=>{const n=t.cancelOrder;switch(n.__typename){case"Order":return this.refetchOrder(n).subscribe(),this.notificationService.success((0,s.J)("order.cancelled-order-success")),e;case"CancelActiveOrderError":case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"EmptyOrderLineSelectionError":return void this.notificationService.error(n.message)}})):[e]:(0,d.of)(void 0)}),(0,x.w)(e=>e?e.refund.lines.length?this.dataService.order.refundOrder(e.refund).pipe((0,v.U)(e=>e.refundOrder)):[void 0]:(0,d.of)(void 0))).subscribe(e=>{if(e)switch(e.__typename){case"Refund":this.refetchOrder(e).subscribe(),"Failed"===e.state?this.notificationService.error((0,s.J)("order.refund-order-failed")):this.notificationService.success((0,s.J)("order.refund-order-success"));break;case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":this.notificationService.error(e.message)}})}refetchOrder(e){return this.fetchHistory.next(),e?this.dataService.order.getOrder(this.id).single$:(0,d.of)(void 0)}setFormValues(e){}}var Mi,Si;Ui.\u0275fac=function(e){return new(e||Ui)(r.Y36(L.F0),r.Y36(L.gz),r.Y36(o.iHG),r.Y36(r.sBO),r.Y36(o.DoR),r.Y36(o.gqp),r.Y36(o.Z7U),r.Y36(hi))},Ui.\u0275cmp=r.Xpm({type:Ui,selectors:[["vdr-order-detail"]],features:[r.qOj],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],["locationId","order-detail"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"btn","btn-primary",3,"click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"order","orderLineCustomFields"],[1,"table"],[4,"ngFor","ngForOf"],["locationId","order-detail",3,"entity$","detailForm"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"clr-col-lg-4","order-cards"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text"],[3,"customer"],[3,"address"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund"],[3,"fulfillment","order","transitionState"]],template:function(e,t){1&e&&(r.YNc(0,Bt,29,21,"vdr-action-bar",0),r.ALo(1,"async"),r.YNc(2,en,42,36,"div",0),r.ALo(3,"async")),2&e&&(r.Q6J("ngIf",r.lcZ(1,2,t.entity$)),r.xp6(2),r.Q6J("ngIf",r.lcZ(3,4,t.entity$)))},directives:function(){return[P.O5,o.KkL,o.BND,o.Vqt,o.GXt,Q.qvL,o.mz,o.WWO,o.JOL,o.UaT,o.N9E,o.HH4,P.sg,Bi,o.CWh,Di,Li,o.d$,o.b28,ji,qi]},pipes:function(){return[P.Ov,S.X$,o.kgx,o.Nir,P.Zx]},styles:[".shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}"],changeDetection:0}),Ui.ctorParameters=()=>[{type:L.F0},{type:L.gz},{type:o.iHG},{type:r.sBO},{type:o.DoR},{type:o.gqp},{type:o.Z7U},{type:hi}],(Si=Mi||(Mi={}))[Si.Refund=0]="Refund",Si[Si.Payment=1]="Payment",Si[Si.PriceUnchanged=2]="PriceUnchanged",Si[Si.Cancel=3]="Cancel";class Pi{get priceDifference(){return this.order.totalWithTax-this.originalTotalWithTax}ngOnInit(){this.refundNote=this.modifyOrderInput.note||""}cancel(){this.resolveWith({result:Mi.Cancel})}submit(){0<this.priceDifference?this.resolveWith({result:Mi.Payment}):this.priceDifference<0?this.resolveWith({result:Mi.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:Mi.PriceUnchanged})}}Pi.\u0275fac=function(e){return new(e||Pi)},Pi.\u0275cmp=r.Xpm({type:Pi,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(r.YNc(0,tn,2,3,"ng-template",0),r._UZ(1,"vdr-order-table",1),r.TgZ(2,"h4",2),r._uU(3),r.ALo(4,"translate"),r.TgZ(5,"strong"),r._uU(6),r.ALo(7,"localeCurrency"),r.qZA(),r.qZA(),r.YNc(8,rn,11,9,"div",3),r.YNc(9,on,6,7,"ng-template",4)),2&e&&(r.xp6(1),r.Q6J("order",t.order)("orderLineCustomFields",t.orderLineCustomFields),r.xp6(2),r.hij(" ",r.lcZ(4,5,"order.modify-order-price-difference"),": "),r.xp6(3),r.Oqu(r.xi3(7,7,t.priceDifference,t.order.currencyCode)),r.xp6(2),r.Q6J("ngIf",t.priceDifference<0))},directives:function(){return[o.q6K,Bi,P.O5,o.nPI,Q.dTv,Q.MgK,o.y_K,i.EJ,Q.otW,i.JJ,i.On,P.sg,i.Fj,Q.XE5,i.Q7,i.YN,i.Kr]},pipes:function(){return[S.X$,o.kgx]},styles:[""],changeDetection:0});class Qi extends o.UT_{constructor(e,t,n,r,o,s,a,c){super(t,e,n,o),this.changeDetector=r,this.dataService=o,this.notificationService=s,this.modalService=a,this.orderTransitionService=c,this.detailForm=new i.cw({}),this.couponCodesControl=new i.NI,this.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},this.note="",this.recalculateShipping=!0,this.addedVariants=new Map}get addedLines(){const e=e=>"SinglePrice"===e.__typename?e.value:0;return(this.modifyOrderInput.addItems||[]).map(t=>{const n=this.addedVariants.get(t.productVariantId);if(n)return Object.assign(Object.assign({},n),{price:e(n.price),priceWithTax:e(n.priceWithTax),quantity:t.quantity})}).filter(J.notNullOrUndefined)}ngOnInit(){this.init(),this.dataService.promotion.getPromotions(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe((0,_.R)(this.destroy$)).subscribe(e=>{var t,n,r,o,s,a,c,l,d,u,p,g,f,m,h,Z,x,v;e.couponCodes.length&&this.couponCodesControl.setValue(e.couponCodes),this.surchargeForm=new i.cw({description:new i.NI("",i.kI.required),sku:new i.NI(""),price:new i.NI(0,i.kI.required),priceIncludesTax:new i.NI(!0),taxRate:new i.NI(0),taxDescription:new i.NI("")}),this.shippingAddressForm||(this.shippingAddressForm=new i.cw({fullName:new i.NI(null===(t=e.shippingAddress)||void 0===t?void 0:t.fullName),company:new i.NI(null===(n=e.shippingAddress)||void 0===n?void 0:n.company),streetLine1:new i.NI(null===(r=e.shippingAddress)||void 0===r?void 0:r.streetLine1),streetLine2:new i.NI(null===(o=e.shippingAddress)||void 0===o?void 0:o.streetLine2),city:new i.NI(null===(s=e.shippingAddress)||void 0===s?void 0:s.city),province:new i.NI(null===(a=e.shippingAddress)||void 0===a?void 0:a.province),postalCode:new i.NI(null===(c=e.shippingAddress)||void 0===c?void 0:c.postalCode),countryCode:new i.NI(null===(l=e.shippingAddress)||void 0===l?void 0:l.countryCode),phoneNumber:new i.NI(null===(d=e.shippingAddress)||void 0===d?void 0:d.phoneNumber)}),this.addAddressCustomFieldsFormGroup(this.shippingAddressForm,e.shippingAddress)),this.billingAddressForm||(this.billingAddressForm=new i.cw({fullName:new i.NI(null===(u=e.billingAddress)||void 0===u?void 0:u.fullName),company:new i.NI(null===(p=e.billingAddress)||void 0===p?void 0:p.company),streetLine1:new i.NI(null===(g=e.billingAddress)||void 0===g?void 0:g.streetLine1),streetLine2:new i.NI(null===(f=e.billingAddress)||void 0===f?void 0:f.streetLine2),city:new i.NI(null===(m=e.billingAddress)||void 0===m?void 0:m.city),province:new i.NI(null===(h=e.billingAddress)||void 0===h?void 0:h.province),postalCode:new i.NI(null===(Z=e.billingAddress)||void 0===Z?void 0:Z.postalCode),countryCode:new i.NI(null===(x=e.billingAddress)||void 0===x?void 0:x.countryCode),phoneNumber:new i.NI(null===(v=e.billingAddress)||void 0===v?void 0:v.phoneNumber)}),this.addAddressCustomFieldsFormGroup(this.billingAddressForm,e.billingAddress)),this.orderLineCustomFieldsFormArray=new i.Oe([]);for(const y of e.lines){const e=new i.cw({});for(const{name:t}of this.orderLineCustomFields)e.addControl(t,new i.NI(y.customFields[t]));e.valueChanges.pipe((0,_.R)(this.destroy$)).subscribe(e=>{let t=this.modifyOrderInput.adjustOrderLines.find(e=>e.orderLineId===y.id);t||(t={orderLineId:y.id,quantity:y.quantity},this.modifyOrderInput.adjustOrderLines.push(t)),this.orderLineCustomFields.length&&(t.customFields=e)}),this.orderLineCustomFieldsFormArray.push(e)}}),this.addItemCustomFieldsFormArray=new i.Oe([]),this.addItemCustomFieldsForm=new i.cw({});for(const e of this.orderLineCustomFields)this.addItemCustomFieldsForm.addControl(e.name,new i.NI);this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(e=>e.countries.items).pipe((0,I.d)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:o.Asd.DESC},filter:{type:{eq:o.iYD.ORDER_STATE_TRANSITION}}}).single$.subscribe(({order:e})=>{this.previousState=null==e?void 0:e.history.items[0].data.from})}ngOnDestroy(){this.destroy()}transitionToPriorState(e){this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates).subscribe(e=>{this.router.navigate([".."],{relativeTo:this.route})})}canPreviewChanges(){const{addItems:e,adjustOrderLines:t,surcharges:n}=this.modifyOrderInput;return!!(null==e?void 0:e.length)||!!(null==n?void 0:n.length)||!!(null==t?void 0:t.length)||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid||this.couponCodesControl.dirty}isLineModified(e){var t;return!!(null===(t=this.modifyOrderInput.adjustOrderLines)||void 0===t?void 0:t.find(t=>t.orderLineId===e.id&&t.quantity!==e.quantity))}updateLineQuantity(e,t){const{adjustOrderLines:n}=this.modifyOrderInput;let r=null==n?void 0:n.find(t=>t.orderLineId===e.id);r&&+t===e.quantity&&(null==n||n.splice(null==n?void 0:n.indexOf(r),1)),r||(r={orderLineId:e.id,quantity:+t},null==n||n.push(r)),r.quantity=+t}updateAddedItemQuantity(e,t){var n;const r=null===(n=this.modifyOrderInput.addItems)||void 0===n?void 0:n.find(t=>t.productVariantId===e.productVariantId);r&&(r.quantity=+t)}trackByProductVariantId(e,t){return t.productVariantId}getSelectedItemPrice(e){switch(null==e?void 0:e.priceWithTax.__typename){case"SinglePrice":return e.priceWithTax.value;default:return 0}}addItemToOrder(e){var t,n;if(!e)return;const r=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0;let o=null===(t=this.modifyOrderInput.addItems)||void 0===t?void 0:t.find(t=>this.isMatchingAddItemRow(t,e,r));if(o?o.quantity++:(o={productVariantId:e.productVariantId,quantity:1},r&&(o.customFields=r),null===(n=this.modifyOrderInput.addItems)||void 0===n||n.push(o)),r){const e=new i.cw({});for(const[t,n]of Object.entries(r))e.addControl(t,new i.NI(n));this.addItemCustomFieldsFormArray.push(e),e.valueChanges.pipe((0,_.R)(this.destroy$)).subscribe(e=>{o&&(o.customFields=e)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(e.productVariantId,e)}isMatchingAddItemRow(e,t,n){return e.productVariantId===t.productVariantId&&JSON.stringify(e.customFields)===JSON.stringify(n)}removeAddedItem(e){this.modifyOrderInput.addItems.splice(e,1),-1<e&&this.addItemCustomFieldsFormArray.removeAt(e)}getSurchargePrices(e){const t=e.priceIncludesTax?e.price:Math.round(e.price*((100+(e.taxRate||0))/100));return{price:e.priceIncludesTax?Math.round(e.price/((100+(e.taxRate||0))/100)):e.price,priceWithTax:t}}addSurcharge(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.push(e),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}removeSurcharge(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.splice(e,1)}previewAndModify(e){var t;const n=Object.assign(Object.assign({},this.modifyOrderInput),{adjustOrderLines:this.modifyOrderInput.adjustOrderLines.map(e=>(0,o.EJQ)((0,U.I)(e),this.orderLineCustomFields))}),r=Object.assign(Object.assign(Object.assign(Object.assign({},n),this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{}),this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{}),{dryRun:!0,couponCodes:this.couponCodesControl.dirty?this.couponCodesControl.value:void 0,note:null!==(t=this.note)&&void 0!==t?t:"",options:{recalculateShipping:this.recalculateShipping}}),i=e.totalWithTax;this.dataService.order.modifyOrder(r).pipe((0,x.w)(({modifyOrder:e})=>{switch(e.__typename){case"Order":return this.modalService.fromComponent(Pi,{size:"xl",closable:!1,locals:{originalTotalWithTax:i,order:e,orderLineCustomFields:this.orderLineCustomFields,modifyOrderInput:r}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":case"CouponCodeLimitError":case"CouponCodeExpiredError":case"CouponCodeInvalidError":return this.notificationService.error(e.message),(0,d.of)(!1);case null:case void 0:return(0,d.of)(!1);default:(0,J.assertNever)(e)}}),(0,x.w)(t=>{if(!t||t.result===Mi.Cancel)return this.dataService.order.getOrder(this.id).mapSingle(()=>!1);{const n=Object.assign(Object.assign({},r),{dryRun:!1});return t.result===Mi.Refund&&(n.refund={paymentId:t.refundPaymentId,reason:t.refundNote}),this.dataService.order.modifyOrder(n).pipe((0,x.w)(({modifyOrder:t})=>{if("Order"===t.__typename){const n=0<t.totalWithTax-i?"ArrangingAdditionalPayment":this.previousState;return this.dataService.order.transitionToState(e.id,n).pipe((0,O.h)(!0))}return this.notificationService.error(t.message),l.E}))}})).subscribe(e=>{e&&this.router.navigate(["../"],{relativeTo:this.route})})}addAddressCustomFieldsFormGroup(e,t){var n;if(t&&this.addressCustomFields.length){const r=new i.cw({});for(const e of this.addressCustomFields){const o=e.name,s=null===(n=t.customFields)||void 0===n?void 0:n[o];r.addControl(o,new i.NI(s))}e.addControl("customFields",r)}}setFormValues(e,t){}}Qi.\u0275fac=function(e){return new(e||Qi)(r.Y36(L.F0),r.Y36(L.gz),r.Y36(o.iHG),r.Y36(r.sBO),r.Y36(o.DoR),r.Y36(o.gqp),r.Y36(o.Z7U),r.Y36(hi))},Qi.\u0275cmp=r.Xpm({type:Qi,selectors:[["vdr-order-editor"]],features:[r.qOj],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line","payments"],[3,"line","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],["entityName","OrderLine",3,"customFields","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb4",3,"productSelected"],["class","flex mb4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb4"],["class","mr4",3,"src",4,"ngIf"],[1,"mr4"],[1,"mr4",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"control"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(e,t){1&e&&(r.YNc(0,sn,10,7,"vdr-action-bar",0),r.ALo(1,"async"),r.YNc(2,Sn,98,75,"div",0),r.ALo(3,"async")),2&e&&(r.Q6J("ngIf",r.lcZ(1,2,t.entity$)),r.xp6(2),r.Q6J("ngIf",r.lcZ(3,4,t.entity$)))},directives:[P.O5,o.KkL,o.BND,o.Vqt,o.GXt,o.mz,P.sg,Q.q0d,Q.bZL,Q.twP,Q.GmI,Q.dxz,Q.UJ5,Q.Nz$,Q.DbV,Q.MgK,o.y_K,i.Fj,Q.XE5,i.Q7,i.JJ,i.On,Q.PEh,i.Wl,Q.KKC,Ii,_i,o.yc0,Q.qvL,o.M1s,Q.r6y,o.cyK,fi,i._Y,i.JL,i.sg,o.hgI,i.u,o.KQz,o.KH1,i.qQ,i.Fd,i.wV,o.CY4],pipes:[P.Ov,S.X$,o.kgx,o.Mgf,P.H9],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:bold;border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{text-align:start}"],changeDetection:0}),Qi.ctorParameters=()=>[{type:L.F0},{type:L.gz},{type:o.iHG},{type:r.sBO},{type:o.DoR},{type:o.gqp},{type:o.Z7U},{type:hi}];class ki{constructor(e,t){this.componentFactoryResolver=e,this.historyEntryComponentService=t,this.expandClick=new r.vpe}ngOnInit(){const e=this.historyEntryComponentService.getComponent(this.entry.type),t=this.componentFactoryResolver.resolveComponentFactory(e),n=this.portalRef.createComponent(t);n.instance.entry=this.entry,n.instance.order=this.order,this.instance=n.instance,this.componentRef=n}ngOnDestroy(){var e;null===(e=this.componentRef)||void 0===e||e.destroy()}}ki.\u0275fac=function(e){return new(e||ki)(r.Y36(r._Vd),r.Y36(o.GwB))},ki.\u0275cmp=r.Xpm({type:ki,selectors:[["vdr-order-history-entry-host"]],viewQuery:function(e,t){if(1&e&&r.Gf(Pn,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.portalRef=e.first)}},inputs:{entry:"entry",order:"order",expanded:"expanded"},outputs:{expandClick:"expandClick"},exportAs:["historyEntry"],decls:3,vars:6,consts:[[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],["portal",""]],template:function(e,t){1&e&&(r.TgZ(0,"vdr-timeline-entry",0),r.NdJ("expandClick",function(){return t.expandClick.emit()}),r._UZ(1,"div",null,1),r.qZA()),2&e&&r.Q6J("displayType",t.instance.getDisplayType(t.entry))("iconShape",t.instance.getIconShape&&t.instance.getIconShape(t.entry))("createdAt",t.entry.createdAt)("name",t.instance.getName&&t.instance.getName(t.entry))("featured",t.instance.isFeatured(t.entry))("collapsed",!t.expanded&&!t.instance.isFeatured(t.entry))},directives:[o._hU],encapsulation:2}),ki.ctorParameters=()=>[{type:r._Vd},{type:o.GwB}],ki.propDecorators={entry:[{type:r.IIB}],order:[{type:r.IIB}],expanded:[{type:r.IIB}],expandClick:[{type:r.r_U}],portalRef:[{type:r.i9L,args:["portal",{static:!0,read:r.s_b}]}]};class Di{constructor(e){this.historyEntryComponentService=e,this.addNote=new r.vpe,this.updateNote=new r.vpe,this.deleteNote=new r.vpe,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=o.iYD}hasCustomComponent(e){return!!this.historyEntryComponentService.getComponent(e)}getDisplayType(e){if(e.type===o.iYD.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return"success";if("Cancelled"===e.data.to)return"error"}return e.type===o.iYD.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===e.data.to?"success":e.type===o.iYD.ORDER_PAYMENT_TRANSITION&&("Declined"===e.data.to||"Cancelled"===e.data.to)||e.type===o.iYD.ORDER_CANCELLATION?"error":e.type===o.iYD.ORDER_REFUND_TRANSITION?"warning":"default"}getTimelineIcon(e){if(e.type===o.iYD.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return["success-standard","is-solid"];if("Cancelled"===e.data.to)return"ban"}return e.type===o.iYD.ORDER_PAYMENT_TRANSITION&&"Settled"===e.data.to?"credit-card":e.type===o.iYD.ORDER_NOTE?"note":e.type===o.iYD.ORDER_MODIFIED?"pencil":e.type!==o.iYD.ORDER_FULFILLMENT_TRANSITION||"Shipped"!==e.data.to&&"Delivered"!==e.data.to?void 0:"truck"}isFeatured(e){switch(e.type){case o.iYD.ORDER_STATE_TRANSITION:return"Delivered"===e.data.to||"Cancelled"===e.data.to||"Settled"===e.data.to;case o.iYD.ORDER_PAYMENT_TRANSITION:return"Settled"===e.data.to||"Cancelled"===e.data.to;case o.iYD.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===e.data.to||"Shipped"===e.data.to;case o.iYD.ORDER_NOTE:case o.iYD.ORDER_MODIFIED:default:return!0}}getFulfillment(e){if((e.type===o.iYD.ORDER_FULFILLMENT||e.type===o.iYD.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(t=>t.id===e.data.fulfillmentId)}getPayment(e){if(e.type===o.iYD.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(t=>t.id===e.data.paymentId)}getCancelledItems(e){const t=new Map,n=e.data.orderItemIds;for(const r of this.order.lines)for(const e of r.items)if(n.includes(e.id)){const e=t.get(r.productVariant.name);null!=e?t.set(r.productVariant.name,e+1):t.set(r.productVariant.name,1)}return Array.from(t.entries()).map(([e,t])=>({name:e,quantity:t}))}getModification(e){return this.order.modifications.find(t=>t.id===e)}getName(e){const{administrator:t}=e;if(t)return`${t.firstName} ${t.lastName}`;{const e=this.order.customer;if(e)return`${e.firstName} ${e.lastName}`}return""}addNoteToOrder(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}Di.\u0275fac=function(e){return new(e||Di)(r.Y36(o.GwB))},Di.\u0275cmp=r.Xpm({type:Di,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:23,vars:24,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"order","entry","expanded","expandClick",4,"ngIf","ngIfElse"],["defaultComponents",""],[3,"order","entry","expanded","expandClick"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"],[3,"value"]],template:function(e,t){1&e&&(r.TgZ(0,"h4"),r._uU(1),r.ALo(2,"translate"),r.qZA(),r.TgZ(3,"div",0),r.TgZ(4,"vdr-timeline-entry",1),r.TgZ(5,"div",2),r.TgZ(6,"textarea",3),r.NdJ("ngModelChange",function(e){return t.note=e}),r.qZA(),r.TgZ(7,"button",4),r.NdJ("click",function(){return t.addNoteToOrder()}),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.qZA(),r.TgZ(10,"div",5),r.TgZ(11,"clr-checkbox-wrapper"),r.TgZ(12,"input",6),r.NdJ("ngModelChange",function(e){return t.noteIsPrivate=e}),r.qZA(),r.TgZ(13,"label"),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.qZA(),r.YNc(16,Qn,3,3,"span",7),r.YNc(17,kn,3,3,"span",8),r.qZA(),r.qZA(),r.YNc(18,yr,4,2,"ng-container",9),r.TgZ(19,"vdr-timeline-entry",10),r.TgZ(20,"div",11),r._uU(21),r.ALo(22,"translate"),r.qZA(),r.qZA(),r.qZA()),2&e&&(r.xp6(1),r.Oqu(r.lcZ(2,16,"order.order-history")),r.xp6(2),r.ekj("expanded",t.expanded),r.xp6(1),r.Q6J("featured",!0),r.xp6(2),r.Q6J("ngModel",t.note),r.xp6(1),r.Q6J("disabled",!t.note),r.xp6(1),r.hij(" ",r.lcZ(9,18,"common.add-note")," "),r.xp6(4),r.Q6J("ngModel",t.noteIsPrivate),r.xp6(2),r.Oqu(r.lcZ(15,20,"order.note-is-private")),r.xp6(2),r.Q6J("ngIf",t.noteIsPrivate),r.xp6(1),r.Q6J("ngIf",!t.noteIsPrivate),r.xp6(1),r.Q6J("ngForOf",t.history),r.xp6(1),r.Q6J("isLast",!0)("createdAt",t.order.createdAt)("featured",!0),r.xp6(2),r.hij(" ",r.lcZ(22,22,"order.history-order-created")," "))},directives:function(){return[o._hU,o.y_K,i.Fj,i.JJ,i.On,Q.PEh,i.Wl,Q.KKC,Q.MgK,P.O5,P.sg,ki,P.RF,P.n9,P.ED,o.CS9,wi,o.Ywx,Vi,o.WGc,Ki,Ti,o.JOL,o.UaT,Q.qvL,o.N9E,o.HH4,L.yS,o._8q]},pipes:function(){return[S.X$,o.kgx,o.j$k]},styles:["[_nghost-%COMP%]{margin-top:48px;display:block}.entry-list[_ngcontent-%COMP%]{margin-top:24px;margin-left:24px;margin-right:12px}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-500)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-right:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0}),Di.ctorParameters=()=>[{type:o.GwB}],Di.propDecorators={order:[{type:r.IIB}],history:[{type:r.IIB}],addNote:[{type:r.r_U}],updateNote:[{type:r.r_U}],deleteNote:[{type:r.r_U}]};class Yi extends o.t7C{constructor(e,t,n,r,o){var a;super(r,o),this.serverConfigService=e,this.dataService=t,this.localStorageService=n,this.searchControl=new i.NI(""),this.searchOrderCodeControl=new i.NI(""),this.searchLastNameControl=new i.NI(""),this.orderStates=this.serverConfigService.getOrderProcessStates().map(e=>e.name),this.filterPresets=[{name:"open",label:(0,s.J)("order.filter-preset-open"),config:{active:!1,states:this.orderStates.filter(e=>"Delivered"!==e&&"Cancelled"!==e&&"Shipped"!==e&&"Draft"!==e)}},{name:"shipped",label:(0,s.J)("order.filter-preset-shipped"),config:{active:!1,states:["Shipped"]}},{name:"completed",label:(0,s.J)("order.filter-preset-completed"),config:{active:!1,states:["Delivered","Cancelled"]}},{name:"active",label:(0,s.J)("order.filter-preset-active"),config:{active:!0}},{name:"draft",label:(0,s.J)("order.filter-preset-draft"),config:{active:!1,states:["Draft"]}}],this.canCreateDraftOrder=!1,super.setQueryFn((e,t)=>this.dataService.order.getOrders({take:e,skip:t}).refetchOnChannelChange(),e=>e.orders,(e,t)=>this.createQueryOptions(e,t,this.searchControl.value,this.route.snapshot.queryParamMap.get("filter")||"open"));const c=this.localStorageService.get("orderListLastCustomFilters");c&&this.setQueryParam(c,{replaceUrl:!0}),this.canCreateDraftOrder=!!(null===(a=this.serverConfigService.getOrderProcessStates().find(e=>"Created"===e.name))||void 0===a?void 0:a.to.includes("Draft")),this.canCreateDraftOrder||(this.filterPresets=this.filterPresets.filter(e=>"draft"!==e.name))}ngOnInit(){var e;super.ngOnInit(),this.activePreset$=this.route.queryParamMap.pipe((0,v.U)(e=>e.get("filter")||"open"),(0,Z.x)());const t=(0,p.T)(this.searchControl.valueChanges).pipe((0,w.h)(e=>2<e.length||0===e.length),(0,T.b)(250));(0,p.T)(t,this.route.queryParamMap).pipe((0,_.R)(this.destroy$)).subscribe(e=>{this.refresh()});const n=this.route.snapshot.queryParamMap;this.customFilterForm=new i.cw({states:new i.NI(null!==(e=n.getAll("states"))&&void 0!==e?e:[]),placedAtStart:new i.NI(n.get("placedAtStart")),placedAtEnd:new i.NI(n.get("placedAtEnd"))})}selectFilterPreset(e){var t;const n=null!==(t=this.localStorageService.get("orderListLastCustomFilters"))&&void 0!==t?t:{},r="custom"===e?n:{states:void 0,placedAtStart:void 0,placedAtEnd:void 0};this.setQueryParam(Object.assign({filter:e,page:1},r),{replaceUrl:!0})}applyCustomFilters(){const e=this.customFilterForm.value,t={states:e.states,placedAtStart:e.placedAtStart,placedAtEnd:e.placedAtEnd};this.setQueryParam(Object.assign({filter:"custom"},t)),this.customFilterForm.markAsPristine(),this.localStorageService.set("orderListLastCustomFilters",t)}createQueryOptions(e,t,n,r){var i;const s=this.filterPresets.find(e=>e.name===r);let a={},c=o.FnJ.AND;if(s)null!=s.config.active&&(a.active={eq:s.config.active}),s.config.states&&(a.state={in:s.config.states});else if("custom"===r){const e=this.route.snapshot.queryParamMap,t=null!==(i=e.getAll("states"))&&void 0!==i?i:[],n=e.get("placedAtStart"),r=e.get("placedAtEnd");t.length&&(a.state={in:t}),n&&r?a.orderPlacedAt={between:{start:n,end:r}}:n?a.orderPlacedAt={after:n}:r&&(a.orderPlacedAt={before:r})}return n&&(a={customerLastName:{contains:n},transactionId:{contains:n},code:{contains:n}},c=o.FnJ.OR),{options:{skip:e,take:t,filter:Object.assign({},null!=a?a:{}),sort:{updatedAt:o.Asd.DESC},filterOperator:c}}}getShippingNames(e){return e.shippingLines.length?e.shippingLines.map(e=>e.shippingMethod.name).join(", "):""}}Yi.\u0275fac=function(e){return new(e||Yi)(r.Y36(o.iHG),r.Y36(o.DoR),r.Y36(o.n2A),r.Y36(L.F0),r.Y36(L.gz))},Yi.\u0275cmp=r.Xpm({type:Yi,selectors:[["vdr-order-list"]],features:[r.qOj],decls:61,vars:64,consts:[[1,"search-form"],["class","filter-presets btn-group btn-outline-primary",4,"ngIf"],["type","text","name","searchTerm",1,"search-input",3,"formControl","placeholder"],[1,"custom-filters"],[3,"formGroup"],[1,"flex","align-center"],["appendTo","body","formControlName","states",3,"items","addTag","multiple","placeholder","clearable","searchable"],["ng-option-tmp",""],["ng-label-tmp",""],[1,"btn","btn-secondary",3,"disabled","click"],["shape","filter"],[1,"flex"],["formControlName","placedAtStart"],["formControlName","placedAtEnd"],["locationId","order-list"],[4,"ngIf"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"filter-presets","btn-group","btn-outline-primary"],["class","btn",3,"btn-primary","click",4,"ngFor","ngForOf"],[1,"btn",3,"click"],["shape","angle down"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"],["class","btn btn-primary mt1",3,"routerLink",4,"vdrIfPermissions"],[1,"btn","btn-primary","mt1",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"customer"],[3,"state"],[1,"right","align-middle"],["iconShape","shopping-cart",3,"label","linkTo"]],template:function(e,t){1&e&&(r.TgZ(0,"vdr-action-bar"),r.TgZ(1,"vdr-ab-left"),r.TgZ(2,"div",0),r.YNc(3,br,6,6,"div",1),r.ALo(4,"async"),r._UZ(5,"input",2),r.ALo(6,"translate"),r.qZA(),r.TgZ(7,"div",3),r.ALo(8,"async"),r.TgZ(9,"form",4),r.TgZ(10,"div",5),r.TgZ(11,"ng-select",6),r.ALo(12,"translate"),r.YNc(13,Cr,3,5,"ng-template",7),r.YNc(14,qr,6,5,"ng-template",8),r.qZA(),r.TgZ(15,"button",9),r.NdJ("click",function(){return t.applyCustomFilters()}),r._uU(16),r.ALo(17,"translate"),r._UZ(18,"clr-icon",10),r.qZA(),r.qZA(),r.TgZ(19,"div",11),r.TgZ(20,"div"),r.TgZ(21,"label"),r._uU(22),r.ALo(23,"translate"),r.qZA(),r._UZ(24,"vdr-datetime-picker",12),r.qZA(),r.TgZ(25,"div"),r.TgZ(26,"label"),r._uU(27),r.ALo(28,"translate"),r.qZA(),r._UZ(29,"vdr-datetime-picker",13),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(30,"vdr-ab-right"),r._UZ(31,"vdr-action-bar-items",14),r.YNc(32,Ir,2,2,"ng-container",15),r.qZA(),r.qZA(),r.TgZ(33,"vdr-data-table",16),r.NdJ("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),r.ALo(34,"async"),r.ALo(35,"async"),r.ALo(36,"async"),r.ALo(37,"async"),r.TgZ(38,"vdr-dt-column"),r._uU(39),r.ALo(40,"translate"),r.qZA(),r.TgZ(41,"vdr-dt-column"),r._uU(42),r.ALo(43,"translate"),r.qZA(),r.TgZ(44,"vdr-dt-column"),r._uU(45),r.ALo(46,"translate"),r.qZA(),r.TgZ(47,"vdr-dt-column"),r._uU(48),r.ALo(49,"translate"),r.qZA(),r.TgZ(50,"vdr-dt-column"),r._uU(51),r.ALo(52,"translate"),r.qZA(),r.TgZ(53,"vdr-dt-column"),r._uU(54),r.ALo(55,"translate"),r.qZA(),r.TgZ(56,"vdr-dt-column"),r._uU(57),r.ALo(58,"translate"),r.qZA(),r._UZ(59,"vdr-dt-column"),r.YNc(60,Nr,20,25,"ng-template"),r.qZA()),2&e&&(r.xp6(3),r.Q6J("ngIf",r.lcZ(4,28,t.activePreset$)),r.xp6(2),r.Q6J("formControl",t.searchControl)("placeholder",r.lcZ(6,30,"order.search-by-order-filters")),r.xp6(2),r.ekj("expanded","custom"===r.lcZ(8,32,t.activePreset$)),r.xp6(2),r.Q6J("formGroup",t.customFilterForm),r.xp6(2),r.Q6J("items",t.orderStates)("addTag",!1)("multiple",!0)("placeholder",r.lcZ(12,34,"state.all-orders"))("clearable",!0)("searchable",!1),r.xp6(4),r.Q6J("disabled",t.customFilterForm.pristine),r.xp6(1),r.hij(" ",r.lcZ(17,36,"order.apply-filters")," "),r.xp6(6),r.Oqu(r.lcZ(23,38,"order.placed-at-start")),r.xp6(5),r.Oqu(r.lcZ(28,40,"order.placed-at-end")),r.xp6(5),r.Q6J("ngIf",t.canCreateDraftOrder),r.xp6(1),r.Q6J("items",r.lcZ(34,42,t.items$))("itemsPerPage",r.lcZ(35,44,t.itemsPerPage$))("totalItems",r.lcZ(36,46,t.totalItems$))("currentPage",r.lcZ(37,48,t.currentPage$)),r.xp6(6),r.Oqu(r.lcZ(40,50,"common.code")),r.xp6(3),r.Oqu(r.lcZ(43,52,"order.customer")),r.xp6(3),r.Oqu(r.lcZ(46,54,"order.state")),r.xp6(3),r.Oqu(r.lcZ(49,56,"order.total")),r.xp6(3),r.Oqu(r.lcZ(52,58,"common.updated-at")),r.xp6(3),r.Oqu(r.lcZ(55,60,"order.placed-at")),r.xp6(3),r.Oqu(r.lcZ(58,62,"order.shipping")))},directives:[o.KkL,o.BND,P.O5,o.y_K,i.Fj,i.JJ,i.oH,i._Y,i.JL,i.sg,M.w9,i.u,M.Z2,M.bb,Q.qvL,Q.MgK,o.IPv,o.mz,o.WWO,o.Qj_,o.Egy,P.sg,o.HAh,L.yS,o.d$,o.GXt,o.v_8],pipes:[P.Ov,S.X$,o.Nir,o.kgx,o.eGd,o.HbD],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;max-width:100vw;margin-bottom:6px}.filter-presets[_ngcontent-%COMP%]{max-width:90vw;overflow-x:auto}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:initial}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px;height:36px}ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}"],changeDetection:0}),Yi.ctorParameters=()=>[{type:o.iHG},{type:o.DoR},{type:o.n2A},{type:L.F0},{type:L.gz}];class ji{constructor(){this.settlePayment=new r.vpe,this.transitionPaymentState=new r.vpe,this.settleRefund=new r.vpe}refundHasMetadata(e){return!!e&&Object.keys(e.metadata).length>0}nextOtherStates(){return this.payment?this.payment.nextStates.filter(e=>"Settled"!==e&&"Error"!==e):[]}}ji.\u0275fac=function(e){return new(e||ji)},ji.\u0275cmp=r.Xpm({type:ji,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},decls:12,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"div"),r._uU(3),r.ALo(4,"translate"),r.YNc(5,Jr,2,1,"ng-container",2),r.qZA(),r.TgZ(6,"div",3),r._UZ(7,"vdr-payment-state-label",4),r.qZA(),r.qZA(),r.TgZ(8,"div",5),r._UZ(9,"vdr-payment-detail",6),r.qZA(),r.YNc(10,Qr,20,23,"ng-container",7),r.YNc(11,Er,7,2,"div",8),r.qZA()),2&e&&(r.xp6(3),r.hij(" ",r.lcZ(4,7,"order.payment")," "),r.xp6(2),r.Q6J("ngIf",t.payment.transactionId),r.xp6(2),r.Q6J("state",t.payment.state),r.xp6(2),r.Q6J("payment",t.payment)("currencyCode",t.currencyCode),r.xp6(1),r.Q6J("ngForOf",t.payment.refunds),r.xp6(1),r.Q6J("ngIf",t.payment.nextStates.length))},directives:function(){return[P.O5,Gi,Vi,P.sg,Q.qvL,k.Lv,Wi,o.WGc,o._8q,o.JOL,o.UaT,o.N9E,o.HH4]},pipes:function(){return[S.X$,o.HbD,o.kgx,o.Nir]},styles:[".payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refund-icon[_ngcontent-%COMP%]{margin-right:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0}),ji.propDecorators={payment:[{type:r.IIB}],currencyCode:[{type:r.IIB}],settlePayment:[{type:r.r_U}],transitionPaymentState:[{type:r.r_U}],settleRefund:[{type:r.r_U}]};const Ei=72;class $i{ngOnInit(){this.active$=this.from.active$.asObservable().pipe((0,q.b)(e=>this.to.activeTarget$.next(e)))}getStyle(){const e=this.from.index<this.to.index?"down":"up",t=this.from.getPos("down"===e?"bottom":"top"),n=this.to.getPos("down"===e?"top":"bottom"),r=Math.abs(t.x-n.x),i=Math.abs(t.y-n.y),o=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));return Object.assign({"top.px":t.y,"left.px":t.x+("down"===e?10:40)+12*this.index,"height.px":o,"width.px":1},"up"===e?{transform:"rotateZ(180deg)","transform-origin":"top"}:{})}}$i.\u0275fac=function(e){return new(e||$i)},$i.\u0275cmp=r.Xpm({type:$i,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.ALo(1,"async"),r._UZ(2,"clr-icon",1),r.qZA()),2&e&&(r.ekj("active",r.lcZ(1,5,t.active$)),r.Q6J("ngStyle",t.getStyle()),r.uIk("data-from",t.from.node.name)("data-to",t.to.node.name))},directives:[P.PC,Q.qvL],pipes:[P.Ov],styles:[".edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}"],changeDetection:0}),$i.propDecorators={from:[{type:r.IIB}],to:[{type:r.IIB}],index:[{type:r.IIB}]};class Ri{constructor(e){this.elementRef=e,this.active$=new g.X(!1),this.activeTarget$=new g.X(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}ngOnChanges(e){this.isCancellable=!!this.node.to.find(e=>"Cancelled"===e.name),e.active&&this.active$.next(this.active)}getPos(e="top"){var t,n;this.elementRef.nativeElement.getBoundingClientRect();const r=null!==(n=null===(t=this.elementRef.nativeElement.querySelector(".node"))||void 0===t?void 0:t.getBoundingClientRect().height)&&void 0!==n?n:0;return{x:10,y:this.index*Ei+("bottom"===e?r:0)}}getStyle(){const e=this.getPos();return{"top.px":e.y,"left.px":e.x}}}Ri.\u0275fac=function(e){return new(e||Ri)(r.Y36(r.SBq))},Ri.\u0275cmp=r.Xpm({type:Ri,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[r.TTD],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.ALo(1,"async"),r.TgZ(2,"div",1),r.ALo(3,"async"),r._uU(4),r.ALo(5,"translate"),r.ALo(6,"stateI18nToken"),r.qZA(),r.YNc(7,$r,7,5,"div",2),r.qZA()),2&e&&(r.ekj("active",r.lcZ(1,7,t.active$)),r.Q6J("ngStyle",t.getStyle()),r.xp6(2),r.ekj("active-target",r.lcZ(3,9,t.activeTarget$)),r.xp6(2),r.hij(" ",r.lcZ(5,11,r.lcZ(6,13,t.node.name))," "),r.xp6(3),r.Q6J("ngIf",t.isCancellable))},directives:[P.PC,P.O5,Q.qvL],pipes:[P.Ov,S.X$,o.Nir],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-left:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-left:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0}),Ri.ctorParameters=()=>[{type:r.SBq}],Ri.propDecorators={node:[{type:r.IIB}],index:[{type:r.IIB}],active:[{type:r.IIB}]};class Hi{constructor(e){this.changeDetector=e,this.setActiveState$=new g.X(void 0),this.nodes=[],this.edges=[]}get outerHeight(){return this.nodes.length*Ei}ngOnInit(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe((0,T.b)(150))}ngOnChanges(e){this.populateNodes()}ngAfterViewInit(){setTimeout(()=>this.populateEdges())}onMouseOver(e){this.setActiveState$.next(e)}onMouseOut(){this.setActiveState$.next(this.initialState)}getNodeFor(e){if(this.nodeComponents)return this.nodeComponents.find(t=>t.node.name===e)}populateNodes(){var e,t;const n=new Map;for(const r of this.states)n.set(r.name,{name:r.name,to:[]});for(const[r,i]of n.entries()){const o=null!==(t=null===(e=this.states.find(e=>e.name===r))||void 0===e?void 0:e.to)&&void 0!==t?t:[];for(const e of o){const t=n.get(e);t&&i.to.push(t)}}this.nodes=[...n.values()].filter(e=>"Cancelled"!==e.name)}populateEdges(){for(const e of this.nodes){const t=this.getNodeFor(e.name);let n=0;for(const r of e.to){const e=this.getNodeFor(r.name);t&&e&&t!==e&&(this.edges.push({to:e,from:t,index:n}),n++)}}this.edges=[...this.edges],this.changeDetector.markForCheck()}}Hi.\u0275fac=function(e){return new(e||Hi)(r.Y36(r.sBO))},Hi.\u0275cmp=r.Xpm({type:Hi,selectors:[["vdr-order-process-graph"]],viewQuery:function(e,t){if(1&e&&r.Gf(Ri,5),2&e){let e;r.iGM(e=r.CRH())&&(t.nodeComponents=e)}},hostVars:2,hostBindings:function(e,t){2&e&&r.Udp("height",t.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[r.TTD],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(e,t){1&e&&(r.YNc(0,Rr,3,5,"ng-container",0),r.YNc(1,Hr,2,3,"ng-container",0)),2&e&&(r.Q6J("ngForOf",t.nodes),r.xp6(1),r.Q6J("ngForOf",t.edges))},directives:[P.sg,Ri,$i],pipes:[P.Ov],styles:["[_nghost-%COMP%]{display:block;border:1px hotpink;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0}),Hi.ctorParameters=()=>[{type:r.sBO}],Hi.propDecorators={states:[{type:r.IIB}],initialState:[{type:r.IIB}],nodeComponents:[{type:r.vR,args:[Ri]}],outerHeight:[{type:r.pfw,args:["style.height.px"]}]};class Bi{constructor(){this.isDraft=!1,this.adjust=new r.vpe,this.remove=new r.vpe,this.orderLineCustomFieldsVisible=!1,this.customFieldsForLine={}}get visibleOrderLineCustomFields(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}get showElided(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}ngOnInit(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2,this.getLineCustomFields()}draftInputBlur(e,t){e.quantity!==t&&this.adjust.emit({lineId:e.id,quantity:t})}toggleOrderLineCustomFields(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}getLineDiscounts(e){return e.discounts.filter(e=>e.type===o.S2X.PROMOTION)}getLineCustomFields(){for(const e of this.order.lines){const t=new i.cw({}),n=this.orderLineCustomFields.map(n=>{const r=e.customFields[n.name];return t.addControl(n.name,new i.NI(r)),{config:n,formGroup:t,value:r}}).filter(e=>!!this.orderLineCustomFieldsVisible||null!=e.value);this.customFieldsForLine[e.id]=n}}getPromotionLink(e){return["/marketing","promotions",e.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(e,t){const n=t.adjustmentSource.split(":")[1],r=e.promotions.find(e=>e.id===n);if(r)return r.couponCode||void 0}getShippingNames(e){return e.shippingLines.length?e.shippingLines.map(e=>e.shippingMethod.name).join(", "):""}}Bi.\u0275fac=function(e){return new(e||Bi)},Bi.\u0275cmp=r.Xpm({type:Bi,selectors:[["vdr-order-table"]],inputs:{isDraft:"isDraft",order:"order",orderLineCustomFields:"orderLineCustomFields"},outputs:{adjust:"adjust",remove:"remove"},decls:61,vars:61,consts:[[1,"order-table","table"],[4,"ngFor","ngForOf"],["class","surcharge",4,"ngFor","ngForOf"],[1,"sub-total"],[1,"left","clr-align-middle"],["colspan","4"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["colspan","3"],[1,"total"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],[4,"ngIf","ngIfElse"],["draft",""],[3,"line","payments"],[3,"line","orderState"],[1,"align-middle","total"],[4,"ngIf"],[3,"src"],[1,"flex"],["type","number","min","0",1,"draft-qty",3,"value","blur"],["qtyInput",""],[1,"icon-button",3,"click"],["shape","trash"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"],["colspan","6",1,"custom-fields-row"],[1,"order-line-custom-fields"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"compact","readonly","customField","customFieldsFormGroup"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],["colspan","2",1,"align-middle"],["class","order-adjustment",4,"ngIf"],[1,"order-adjustment"],["colspan","5",1,"left","clr-align-middle"],[3,"routerLink"]],template:function(e,t){1&e&&(r.TgZ(0,"table",0),r.TgZ(1,"thead"),r.TgZ(2,"tr"),r._UZ(3,"th"),r.TgZ(4,"th"),r._uU(5),r.ALo(6,"translate"),r.qZA(),r.TgZ(7,"th"),r._uU(8),r.ALo(9,"translate"),r.qZA(),r.TgZ(10,"th"),r._uU(11),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"th"),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"th"),r._uU(17),r.ALo(18,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(19,"tbody"),r.YNc(20,ni,30,35,"ng-container",1),r.YNc(21,ri,13,13,"tr",2),r.YNc(22,si,2,1,"ng-container",1),r.TgZ(23,"tr",3),r.TgZ(24,"td",4),r._uU(25),r.ALo(26,"translate"),r.qZA(),r._UZ(27,"td",5),r.TgZ(28,"td",6),r._uU(29),r.ALo(30,"localeCurrency"),r.TgZ(31,"div",7),r.ALo(32,"translate"),r._uU(33),r.ALo(34,"localeCurrency"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(35,"tr",8),r.TgZ(36,"td",4),r._uU(37),r.ALo(38,"translate"),r.qZA(),r.TgZ(39,"td",6),r._uU(40),r.qZA(),r._UZ(41,"td",9),r.TgZ(42,"td",6),r._uU(43),r.ALo(44,"localeCurrency"),r.TgZ(45,"div",7),r.ALo(46,"translate"),r._uU(47),r.ALo(48,"localeCurrency"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(49,"tr",10),r.TgZ(50,"td",4),r._uU(51),r.ALo(52,"translate"),r.qZA(),r._UZ(53,"td",5),r.TgZ(54,"td",6),r._uU(55),r.ALo(56,"localeCurrency"),r.TgZ(57,"div",7),r.ALo(58,"translate"),r._uU(59),r.ALo(60,"localeCurrency"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&e&&(r.xp6(5),r.Oqu(r.lcZ(6,21,"order.product-name")),r.xp6(3),r.Oqu(r.lcZ(9,23,"order.product-sku")),r.xp6(3),r.Oqu(r.lcZ(12,25,"order.unit-price")),r.xp6(3),r.Oqu(r.lcZ(15,27,"order.quantity")),r.xp6(3),r.Oqu(r.lcZ(18,29,"order.total")),r.xp6(3),r.Q6J("ngForOf",t.order.lines),r.xp6(1),r.Q6J("ngForOf",t.order.surcharges),r.xp6(1),r.Q6J("ngForOf",t.order.discounts),r.xp6(3),r.Oqu(r.lcZ(26,31,"order.sub-total")),r.xp6(4),r.hij(" ",r.xi3(30,33,t.order.subTotalWithTax,t.order.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(32,36,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(34,38,t.order.subTotal,t.order.currencyCode)," "),r.xp6(4),r.Oqu(r.lcZ(38,41,"order.shipping")),r.xp6(3),r.Oqu(t.getShippingNames(t.order)),r.xp6(3),r.hij(" ",r.xi3(44,43,t.order.shippingWithTax,t.order.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(46,46,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(48,48,t.order.shipping,t.order.currencyCode)," "),r.xp6(4),r.Oqu(r.lcZ(52,51,"order.total")),r.xp6(4),r.hij(" ",r.xi3(56,53,t.order.totalWithTax,t.order.currencyCode)," "),r.xp6(2),r.Q6J("title",r.lcZ(58,56,"order.net-price")),r.xp6(2),r.hij(" ",r.xi3(60,58,t.order.total,t.order.currencyCode)," "))},directives:[P.sg,P.O5,Ii,_i,o.y_K,Q.qvL,o.JOL,o.UaT,o.N9E,L.yS,o.M1s,o.Ywx],pipes:[S.X$,o.kgx,o.Mgf],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:bold;border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-left:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}"],changeDetection:0}),Bi.propDecorators={order:[{type:r.IIB}],orderLineCustomFields:[{type:r.IIB}],isDraft:[{type:r.IIB}],adjust:[{type:r.r_U}],remove:[{type:r.r_U}]};class Vi{}Vi.\u0275fac=function(e){return new(e||Vi)},Vi.\u0275cmp=r.Xpm({type:Vi,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(e,t){1&e&&(r.TgZ(0,"vdr-labeled-data",0),r.ALo(1,"translate"),r._uU(2),r.qZA(),r.TgZ(3,"vdr-labeled-data",0),r.ALo(4,"translate"),r._uU(5),r.ALo(6,"localeCurrency"),r.qZA(),r.YNc(7,ai,3,4,"vdr-labeled-data",1),r.YNc(8,ci,3,4,"vdr-labeled-data",1),r.TgZ(9,"vdr-labeled-data",0),r.ALo(10,"translate"),r._UZ(11,"vdr-object-tree",2),r.qZA()),2&e&&(r.Q6J("label",r.lcZ(1,8,"order.payment-method")),r.xp6(2),r.hij(" ",t.payment.method,"\n"),r.xp6(1),r.Q6J("label",r.lcZ(4,10,"order.amount")),r.xp6(2),r.hij(" ",r.xi3(6,12,t.payment.amount,t.currencyCode),"\n"),r.xp6(2),r.Q6J("ngIf",t.payment.errorMessage),r.xp6(1),r.Q6J("ngIf",t.payment.transactionId),r.xp6(1),r.Q6J("label",r.lcZ(10,15,"order.payment-metadata")),r.xp6(2),r.Q6J("value",t.payment.metadata))},directives:[o.WGc,P.O5,o._8q],pipes:[S.X$,o.kgx],styles:[""],changeDetection:0}),Vi.propDecorators={payment:[{type:r.IIB}],currencyCode:[{type:r.IIB}]};class Gi{get chipColorType(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}}Gi.\u0275fac=function(e){return new(e||Gi)},Gi.\u0275cmp=r.Xpm({type:Gi,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(r.TgZ(0,"vdr-chip",0),r.ALo(1,"translate"),r.YNc(2,li,1,0,"clr-icon",1),r._uU(3),r.ALo(4,"translate"),r.ALo(5,"stateI18nToken"),r.qZA()),2&e&&(r.Q6J("title",r.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),r.xp6(2),r.Q6J("ngIf","Settled"===t.state),r.xp6(1),r.hij(" ",r.lcZ(4,6,r.lcZ(5,8,t.state)),"\n"))},directives:[o.Ywx,P.O5,Q.qvL],pipes:[S.X$,o.Nir],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),Gi.propDecorators={state:[{type:r.IIB}]};class Wi{get chipColorType(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}Wi.\u0275fac=function(e){return new(e||Wi)},Wi.\u0275cmp=r.Xpm({type:Wi,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(r.TgZ(0,"vdr-chip",0),r.ALo(1,"translate"),r.YNc(2,di,1,0,"clr-icon",1),r._uU(3),r.ALo(4,"translate"),r.ALo(5,"stateI18nToken"),r.qZA()),2&e&&(r.Q6J("title",r.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),r.xp6(2),r.Q6J("ngIf","Settled"===t.state),r.xp6(1),r.hij(" ",r.lcZ(4,6,r.lcZ(5,8,t.state)),"\n"))},directives:[o.Ywx,P.O5,Q.qvL],pipes:[S.X$,o.Nir],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),Wi.propDecorators={state:[{type:r.IIB}]};class Ki{}Ki.\u0275fac=function(e){return new(e||Ki)},Ki.\u0275cmp=r.Xpm({type:Ki,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"ul"),r.YNc(2,ui,5,3,"li",1),r.qZA(),r.qZA()),2&e&&(r.xp6(2),r.Q6J("ngForOf",t.items))},directives:[P.sg,Q.qvL],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-left:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}"],changeDetection:0}),Ki.propDecorators={items:[{type:r.IIB}]};class Xi{constructor(e,t){this.router=e,this.dataService=t}resolve(e,t){const n=e.paramMap.get("id"),r=this.router.events.pipe((0,w.h)(e=>e instanceof L.wM)),i=this.dataService.order.getOrder(n).mapStream(e=>e.order).pipe((0,x.w)(t=>"Draft"===(null==t?void 0:t.state)&&e.component!==Ai?(this.router.navigate(["/orders/draft",n]),l.E):[t]),(0,_.R)(r),(0,w.h)(J.notNullOrUndefined),(0,I.d)(1));return i.pipe((0,C.q)(1),(0,v.U)(()=>i))}}Xi.\u0275fac=function(e){return new(e||Xi)(r.LFG(L.F0),r.LFG(o.DoR))},Xi.\u0275prov=r.Yz7({factory:function(){return new Xi(r.LFG(L.F0),r.LFG(o.DoR))},token:Xi,providedIn:"root"}),Xi.ctorParameters=()=>[{type:L.F0},{type:o.DoR}];class zi{constructor(e,t){this.dataService=e,this.router=t}canActivate(e,t){const n=t.url.includes("orders/draft"),r=e.paramMap.get("id");return!n||"create"!==r||this.dataService.order.createDraftOrder().pipe((0,v.U)(({createDraftOrder:e})=>this.router.parseUrl(`/orders/draft/${e.id}`)))}}zi.\u0275fac=function(e){return new(e||zi)(r.LFG(o.DoR),r.LFG(L.F0))},zi.\u0275prov=r.Yz7({factory:function(){return new zi(r.LFG(o.DoR),r.LFG(L.F0))},token:zi,providedIn:"root"}),zi.ctorParameters=()=>[{type:o.DoR},{type:L.F0}];const eo={breadcrumb:(0,s.J)("breadcrumb.orders")},to={breadcrumb:oo},no={breadcrumb:oo},ro={breadcrumb:so},io=[{path:"",component:Yi,data:eo},{path:"draft/:id",component:Ai,resolve:{entity:Xi},canActivate:[zi],canDeactivate:[o.TSp],data:to},{path:":id",component:Ui,resolve:{entity:Xi},canActivate:[zi],canDeactivate:[o.TSp],data:no},{path:":id/modify",component:Qi,resolve:{entity:Xi},data:ro}];function oo(e,t){return(0,o.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.orders",getName:e=>e.code,route:""})}function so(e,t){return oo(e,t).pipe((0,v.U)(e=>{const t=e.slice();return t[0].link[0]="../",t[1].link[0]="../orders",t.concat({label:(0,s.J)("breadcrumb.modifying"),link:[""]})}))}class ao{}ao.\u0275fac=function(e){return new(e||ao)},ao.\u0275mod=r.oAB({type:ao}),ao.\u0275inj=r.cJS({imports:[[o.m81,L.Bz.forChild(io)]]})}}]);
//# sourceMappingURL=696-es2015.381c1ed974996070ef4d.js.map