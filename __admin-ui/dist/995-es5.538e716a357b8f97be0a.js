!function(){"use strict";function t(){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,o,n){var r=e(t,o);if(r){var i=Object.getOwnPropertyDescriptor(r,o);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(this,arguments)}function e(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}function o(t,e,o){return(e=a(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function i(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var o,n=m(t);if(e){var r=m(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return l(this,o)}}function l(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return d(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(self.webpackChunkvendure_admin_ui=self.webpackChunkvendure_admin_ui||[]).push([[995],{36995:function(e,r,a){a.r(r),a.d(r,{MarketingModule:function(){return V},PromotionDetailComponent:function(){return B},PromotionListComponent:function(){return R},PromotionResolver:function(){return M},marketingRoutes:function(){return z},promotionBreadcrumb:function(){return K},"\u02750":function(){return H},"\u02751":function(){return G}});var s=a(71029),l=a(76456),p=a(20233),f=a(857),g=a(20576),v=a(96361),h=a(96338),y=a(96525),Z=a(34308),b=a(21544),A=a(77194),C=a(89918),P=a(79183),x=a(36508),q=a(70060),F=function(){return["enabled"]};function k(t,e){if(1&t&&(s.TgZ(0,"clr-toggle-wrapper"),s._UZ(1,"input",25),s.TgZ(2,"label"),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.qZA()),2&t){var o=s.oxw();s.xp6(1),s.Q6J("formControl",o.detailForm.get(s.DdM(4,F))),s.xp6(2),s.Oqu(s.lcZ(4,2,"common.enabled"))}}function O(t,e){if(1&t){var o=s.EpF();s.TgZ(0,"button",26),s.NdJ("click",function(){return s.CHM(o),s.oxw().create()}),s._uU(1),s.ALo(2,"translate"),s.qZA()}if(2&t){var n=s.oxw();s.Q6J("disabled",!n.saveButtonEnabled()),s.xp6(1),s.hij(" ",s.lcZ(2,2,"common.create")," ")}}function w(t,e){if(1&t){var o=s.EpF();s.TgZ(0,"button",26),s.NdJ("click",function(){return s.CHM(o),s.oxw(2).save()}),s._uU(1),s.ALo(2,"translate"),s.qZA()}if(2&t){var n=s.oxw(2);s.Q6J("disabled",!n.saveButtonEnabled()),s.xp6(1),s.hij(" ",s.lcZ(2,2,"common.update")," ")}}function T(t,e){1&t&&s.YNc(0,w,3,4,"button",27),2&t&&s.Q6J("vdrIfPermissions","UpdatePromotion")}function _(t,e){if(1&t&&(s.TgZ(0,"section",28),s.TgZ(1,"label"),s._uU(2),s.ALo(3,"translate"),s.qZA(),s._UZ(4,"vdr-tabbed-custom-fields",29),s.ALo(5,"hasPermission"),s.qZA()),2&t){var o=s.oxw();s.xp6(2),s.Oqu(s.lcZ(3,4,"common.custom-fields")),s.xp6(2),s.Q6J("customFields",o.customFields)("customFieldsFormGroup",o.detailForm.get("customFields"))("readonly",!s.lcZ(5,6,"UpdatePromotion"))}}function U(t,e){if(1&t){var o=s.EpF();s.ynx(0),s.TgZ(1,"vdr-configurable-input",30),s.NdJ("remove",function(t){return s.CHM(o),s.oxw().removeCondition(t)}),s.ALo(2,"hasPermission"),s.qZA(),s.BQk()}if(2&t){var n=e.$implicit,r=e.index,i=s.oxw();s.xp6(1),s.Q6J("position",r)("readonly",!s.lcZ(2,5,"UpdatePromotion"))("operation",n)("operationDefinition",i.getConditionDefinition(n))("formControlName",r)}}function L(t,e){if(1&t){var o=s.EpF();s.TgZ(0,"button",35),s.NdJ("click",function(){var t=s.CHM(o).$implicit;return s.oxw(2).addCondition(t)}),s._uU(1),s.qZA()}if(2&t){var n=e.$implicit;s.xp6(1),s.hij(" ",n.description," ")}}function J(t,e){if(1&t&&(s.TgZ(0,"vdr-dropdown"),s.TgZ(1,"button",31),s._UZ(2,"clr-icon",32),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.TgZ(5,"vdr-dropdown-menu",33),s.YNc(6,L,2,1,"button",34),s.qZA(),s.qZA()),2&t){var o=s.oxw();s.xp6(3),s.hij(" ",s.lcZ(4,2,"marketing.add-condition")," "),s.xp6(3),s.Q6J("ngForOf",o.getAvailableConditions())}}function N(t,e){if(1&t){var o=s.EpF();s.TgZ(0,"vdr-configurable-input",36),s.NdJ("remove",function(t){return s.CHM(o),s.oxw().removeAction(t)}),s.ALo(1,"hasPermission"),s.qZA()}if(2&t){var n=e.$implicit,r=e.index,i=s.oxw();s.Q6J("position",r)("operation",n)("readonly",!s.lcZ(1,5,"UpdatePromotion"))("operationDefinition",i.getActionDefinition(n))("formControlName",r)}}function D(t,e){if(1&t){var o=s.EpF();s.TgZ(0,"button",35),s.NdJ("click",function(){var t=s.CHM(o).$implicit;return s.oxw(2).addAction(t)}),s._uU(1),s.qZA()}if(2&t){var n=e.$implicit;s.xp6(1),s.hij(" ",n.description," ")}}function Q(t,e){if(1&t&&(s.TgZ(0,"vdr-dropdown"),s.TgZ(1,"button",31),s._UZ(2,"clr-icon",32),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.TgZ(5,"vdr-dropdown-menu",33),s.YNc(6,D,2,1,"button",34),s.qZA(),s.qZA()),2&t){var o=s.oxw();s.xp6(3),s.hij(" ",s.lcZ(4,2,"marketing.add-action")," "),s.xp6(3),s.Q6J("ngForOf",o.getAvailableActions())}}var I=function(){return["./create"]};function j(t,e){1&t&&(s.TgZ(0,"a",6),s._UZ(1,"clr-icon",7),s._uU(2),s.ALo(3,"translate"),s.qZA()),2&t&&(s.Q6J("routerLink",s.DdM(4,I)),s.xp6(2),s.hij(" ",s.lcZ(3,2,"marketing.create-new-promotion")," "))}function Y(t,e){if(1&t&&(s.TgZ(0,"vdr-chip"),s._uU(1),s.qZA()),2&t){var o=s.oxw().item;s.xp6(1),s.hij(" ",o.couponCode," ")}}function E(t,e){1&t&&(s.TgZ(0,"vdr-chip"),s._uU(1),s.ALo(2,"translate"),s.qZA()),2&t&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"common.disabled")))}var S=function(t){return["./",t]};function $(t,e){if(1&t){var o=s.EpF();s.TgZ(0,"td",8),s._uU(1),s.qZA(),s.TgZ(2,"td",8),s.YNc(3,Y,2,1,"vdr-chip",9),s.qZA(),s.TgZ(4,"td",8),s._uU(5),s.ALo(6,"localeDate"),s.qZA(),s.TgZ(7,"td",8),s._uU(8),s.ALo(9,"localeDate"),s.qZA(),s.TgZ(10,"td",10),s.YNc(11,E,3,3,"vdr-chip",9),s.qZA(),s.TgZ(12,"td",11),s._UZ(13,"vdr-table-row-action",12),s.ALo(14,"translate"),s.qZA(),s.TgZ(15,"td",11),s.TgZ(16,"vdr-dropdown"),s.TgZ(17,"button",13),s._uU(18),s.ALo(19,"translate"),s._UZ(20,"clr-icon",14),s.qZA(),s.TgZ(21,"vdr-dropdown-menu",15),s.TgZ(22,"button",16),s.NdJ("click",function(){var t=s.CHM(o).item;return s.oxw().deletePromotion(t.id)}),s.ALo(23,"hasPermission"),s._UZ(24,"clr-icon",17),s._uU(25),s.ALo(26,"translate"),s.qZA(),s.qZA(),s.qZA(),s.qZA()}if(2&t){var n=e.item;s.xp6(1),s.Oqu(n.name),s.xp6(2),s.Q6J("ngIf",n.couponCode),s.xp6(2),s.Oqu(s.xi3(6,10,n.startsAt,"longDate")),s.xp6(3),s.Oqu(s.xi3(9,13,n.endsAt,"longDate")),s.xp6(3),s.Q6J("ngIf",!n.enabled),s.xp6(2),s.Q6J("label",s.lcZ(14,16,"common.edit"))("linkTo",s.VKq(24,S,n.id)),s.xp6(5),s.hij(" ",s.lcZ(19,18,"common.actions")," "),s.xp6(4),s.Q6J("disabled",!s.lcZ(23,20,"DeletePromotion")),s.xp6(3),s.hij(" ",s.lcZ(26,22,"common.delete")," ")}}var B=function(t){c(r,t);var e=u(r);function r(t,i,a,c,s,u,d){var m;return n(this,r),(m=e.call(this,i,t,a,s)).changeDetector=c,m.dataService=s,m.formBuilder=u,m.notificationService=d,m.conditions=[],m.actions=[],m.allConditions=[],m.allActions=[],m.customFields=m.getCustomFieldConfig("Promotion"),m.detailForm=m.formBuilder.group({name:["",l.kI.required],enabled:!0,couponCode:null,perCustomerUsageLimit:null,startsAt:null,endsAt:null,conditions:m.formBuilder.array([]),actions:m.formBuilder.array([]),customFields:m.formBuilder.group(m.customFields.reduce(function(t,e){return Object.assign(Object.assign({},t),o({},e.name,""))},{}))}),m}return i(r,[{key:"ngOnInit",value:function(){var t=this;this.init(),this.promotion$=this.entity$,this.dataService.promotion.getPromotionActionsAndConditions().single$.subscribe(function(e){t.allActions=e.promotionActions,t.allConditions=e.promotionConditions,t.changeDetector.markForCheck()})}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"getAvailableConditions",value:function(){var t=this;return this.allConditions.filter(function(e){return!t.conditions.find(function(t){return t.code===e.code})})}},{key:"getConditionDefinition",value:function(t){return this.allConditions.find(function(e){return e.code===t.code})}},{key:"getAvailableActions",value:function(){var t=this;return this.allActions.filter(function(e){return!t.actions.find(function(t){return t.code===e.code})})}},{key:"getActionDefinition",value:function(t){return this.allActions.find(function(e){return e.code===t.code})}},{key:"saveButtonEnabled",value:function(){return this.detailForm.dirty&&this.detailForm.valid&&(0!==this.conditions.length||this.detailForm.value.couponCode)&&0!==this.actions.length}},{key:"addCondition",value:function(t){this.addOperation("conditions",t),this.detailForm.markAsDirty()}},{key:"addAction",value:function(t){this.addOperation("actions",t),this.detailForm.markAsDirty()}},{key:"removeCondition",value:function(t){this.removeOperation("conditions",t),this.detailForm.markAsDirty()}},{key:"removeAction",value:function(t){this.removeOperation("actions",t),this.detailForm.markAsDirty()}},{key:"formArrayOf",value:function(t){return this.detailForm.get(t)}},{key:"create",value:function(){var t=this;if(this.detailForm.dirty){var e=this.detailForm.value,o={name:e.name,enabled:!0,couponCode:e.couponCode,perCustomerUsageLimit:e.perCustomerUsageLimit,startsAt:e.startsAt,endsAt:e.endsAt,conditions:this.mapOperationsToInputs(this.conditions,e.conditions),actions:this.mapOperationsToInputs(this.actions,e.actions),customFields:e.customFields};this.dataService.promotion.createPromotion(o).subscribe(function(e){var o=e.createPromotion;switch(o.__typename){case"Promotion":t.notificationService.success((0,f.J)("common.notify-create-success"),{entity:"Promotion"}),t.detailForm.markAsPristine(),t.changeDetector.markForCheck(),t.router.navigate(["../",o.id],{relativeTo:t.route});break;case"MissingConditionsError":t.notificationService.error(o.message)}},function(e){t.notificationService.error((0,f.J)("common.notify-create-error"),{entity:"Promotion"})})}}},{key:"save",value:function(){var t=this;if(this.detailForm.dirty){var e=this.detailForm.value;this.promotion$.pipe((0,v.q)(1),(0,h.zg)(function(o){var n={id:o.id,name:e.name,enabled:e.enabled,couponCode:e.couponCode,perCustomerUsageLimit:e.perCustomerUsageLimit,startsAt:e.startsAt,endsAt:e.endsAt,conditions:t.mapOperationsToInputs(t.conditions,e.conditions),actions:t.mapOperationsToInputs(t.actions,e.actions),customFields:e.customFields};return t.dataService.promotion.updatePromotion(n)})).subscribe(function(e){t.notificationService.success((0,f.J)("common.notify-update-success"),{entity:"Promotion"}),t.detailForm.markAsPristine(),t.changeDetector.markForCheck()},function(e){t.notificationService.error((0,f.J)("common.notify-update-error"),{entity:"Promotion"})})}}},{key:"setFormValues",value:function(t,e){var o=this;this.detailForm.patchValue({name:t.name,enabled:t.enabled,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt}),t.conditions.forEach(function(t){o.addOperation("conditions",t)}),t.actions.forEach(function(t){return o.addOperation("actions",t)}),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),t)}},{key:"mapOperationsToInputs",value:function(t,e){return t.map(function(t,o){return{code:t.code,arguments:Object.values(e[o].args).map(function(e,o){return{name:t.args[o].name,value:(0,g.qrw)(e)}})}})}},{key:"addOperation",value:function(t,e){var n=this,r=this.formArrayOf(t),i="conditions"===t?this.conditions:this.actions;if(-1===r.value.findIndex(function(t){return t.code===e.code})){var a=e.args.reduce(function(r,i){var a;return Object.assign(Object.assign({},r),o({},i.name,null!==(a=(0,g.sux)(i.value))&&void 0!==a?a:n.getDefaultArgValue(t,e,i.name)))},{});r.push(this.formBuilder.control({code:e.code,args:a})),i.push({code:e.code,args:e.args.map(function(t){return{name:t.name,value:(0,g.sux)(t.value)}})})}}},{key:"getDefaultArgValue",value:function(t,e,o){var n="conditions"===t?this.allConditions.find(function(t){return t.code===e.code}):this.allActions.find(function(t){return t.code===e.code});if(n){var r=n.args.find(function(t){return t.name===o});if(r)return(0,g.NWQ)(r)}throw new Error('Could not determine default value for "argName"')}},{key:"removeOperation",value:function(t,e){var o=this.formArrayOf(t),n="conditions"===t?this.conditions:this.actions,r=o.value.findIndex(function(t){return t.code===e.code});-1!==r&&(o.removeAt(r),n.splice(r,1))}}]),r}(g.UT_);B.\u0275fac=function(t){return new(t||B)(s.Y36(p.F0),s.Y36(p.gz),s.Y36(g.iHG),s.Y36(s.sBO),s.Y36(g.DoR),s.Y36(l.qu),s.Y36(g.gqp))},B.\u0275cmp=s.Xpm({type:B,selectors:[["vdr-promotion-detail"]],features:[s.qOj],decls:48,vars:46,consts:[[1,"flex","clr-align-items-center"],[3,"entity"],[4,"vdrIfPermissions"],["locationId","promotion-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["for","startsAt",3,"label"],["formControlName","startsAt"],["for","endsAt",3,"label"],["formControlName","endsAt"],["for","couponCode",3,"label"],["id","couponCode","type","text","formControlName","couponCode",3,"readonly"],["for","perCustomerUsageLimit",3,"label"],["id","perCustomerUsageLimit","type","number","min","1","max","999","formControlName","perCustomerUsageLimit",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["locationId","promotion-detail",3,"entity$","detailForm"],[1,"clr-row"],["formArrayName","conditions",1,"clr-col"],[1,"clr-control-label"],[4,"ngFor","ngForOf"],["formArrayName","actions",1,"clr-col"],[3,"position","operation","readonly","operationDefinition","formControlName","remove",4,"ngFor","ngForOf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["formGroupName","customFields"],["entityName","Promotion",3,"customFields","customFieldsFormGroup","readonly"],[3,"position","readonly","operation","operationDefinition","formControlName","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","","class","item-wrap",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",1,"item-wrap",3,"click"],[3,"position","operation","readonly","operationDefinition","formControlName","remove"]],template:function(t,e){if(1&t&&(s.TgZ(0,"vdr-action-bar"),s.TgZ(1,"vdr-ab-left"),s.TgZ(2,"div",0),s._UZ(3,"vdr-entity-info",1),s.ALo(4,"async"),s.YNc(5,k,5,5,"clr-toggle-wrapper",2),s.qZA(),s.qZA(),s.TgZ(6,"vdr-ab-right"),s._UZ(7,"vdr-action-bar-items",3),s.YNc(8,O,3,4,"button",4),s.ALo(9,"async"),s.YNc(10,T,1,1,"ng-template",null,5,s.W1O),s.qZA(),s.qZA(),s.TgZ(12,"form",6),s.TgZ(13,"vdr-form-field",7),s.ALo(14,"translate"),s._UZ(15,"input",8),s.ALo(16,"hasPermission"),s.qZA(),s.TgZ(17,"vdr-form-field",9),s.ALo(18,"translate"),s._UZ(19,"vdr-datetime-picker",10),s.qZA(),s.TgZ(20,"vdr-form-field",11),s.ALo(21,"translate"),s._UZ(22,"vdr-datetime-picker",12),s.qZA(),s.TgZ(23,"vdr-form-field",13),s.ALo(24,"translate"),s._UZ(25,"input",14),s.ALo(26,"hasPermission"),s.qZA(),s.TgZ(27,"vdr-form-field",15),s.ALo(28,"translate"),s._UZ(29,"input",16),s.ALo(30,"hasPermission"),s.qZA(),s.YNc(31,_,6,8,"section",17),s._UZ(32,"vdr-custom-detail-component-host",18),s.TgZ(33,"div",19),s.TgZ(34,"div",20),s.TgZ(35,"label",21),s._uU(36),s.ALo(37,"translate"),s.qZA(),s.YNc(38,U,3,7,"ng-container",22),s.TgZ(39,"div"),s.YNc(40,J,7,4,"vdr-dropdown",2),s.qZA(),s.qZA(),s.TgZ(41,"div",23),s.TgZ(42,"label",21),s._uU(43),s.ALo(44,"translate"),s.qZA(),s.YNc(45,N,2,7,"vdr-configurable-input",24),s.TgZ(46,"div"),s.YNc(47,Q,7,4,"vdr-dropdown",2),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&t){var o=s.MAs(11);s.xp6(3),s.Q6J("entity",s.lcZ(4,22,e.entity$)),s.xp6(2),s.Q6J("vdrIfPermissions","UpdatePromotion"),s.xp6(3),s.Q6J("ngIf",s.lcZ(9,24,e.isNew$))("ngIfElse",o),s.xp6(4),s.Q6J("formGroup",e.detailForm),s.xp6(1),s.Q6J("label",s.lcZ(14,26,"common.name")),s.xp6(2),s.Q6J("readonly",!s.lcZ(16,28,"UpdatePromotion")),s.xp6(2),s.Q6J("label",s.lcZ(18,30,"marketing.starts-at")),s.xp6(3),s.Q6J("label",s.lcZ(21,32,"marketing.ends-at")),s.xp6(3),s.Q6J("label",s.lcZ(24,34,"marketing.coupon-code")),s.xp6(2),s.Q6J("readonly",!s.lcZ(26,36,"UpdatePromotion")),s.xp6(2),s.Q6J("label",s.lcZ(28,38,"marketing.per-customer-limit")),s.xp6(2),s.Q6J("readonly",!s.lcZ(30,40,"UpdatePromotion")),s.xp6(2),s.Q6J("ngIf",e.customFields.length),s.xp6(1),s.Q6J("entity$",e.entity$)("detailForm",e.detailForm),s.xp6(4),s.Oqu(s.lcZ(37,42,"marketing.conditions")),s.xp6(2),s.Q6J("ngForOf",e.conditions),s.xp6(2),s.Q6J("vdrIfPermissions","UpdatePromotion"),s.xp6(3),s.Oqu(s.lcZ(44,44,"marketing.actions")),s.xp6(2),s.Q6J("ngForOf",e.actions),s.xp6(2),s.Q6J("vdrIfPermissions","UpdatePromotion")}},directives:[g.KkL,g.BND,g.Vqt,g.HAh,g.mz,g.WWO,P.O5,l._Y,l.JL,l.sg,g.hgI,g.y_K,l.Fj,l.JJ,l.u,g.IPv,l.qQ,l.Fd,l.wV,g.CWh,l.CE,x.MgK,P.sg,x.PEh,l.Wl,x.KKC,l.oH,l.x0,g.yc0,g.qq8,g.JOL,g.UaT,x.qvL,g.N9E,g.HH4],pipes:[P.Ov,q.X$,g.j$k],styles:[".item-wrap[_ngcontent-%COMP%]{white-space:normal}"],changeDetection:0}),B.ctorParameters=function(){return[{type:p.F0},{type:p.gz},{type:g.iHG},{type:s.sBO},{type:g.DoR},{type:l.qu},{type:g.gqp}]};var R=function(e){c(r,e);var o=u(r);function r(e,i,a,c,s){var u,p;return n(this,r),(p=o.call(this,i,a)).dataService=e,p.notificationService=c,p.modalService=s,p.searchForm=new l.cw({name:new l.NI(""),couponCode:new l.NI("")}),t((u=d(p),m(r.prototype)),"setQueryFn",u).call(u,function(){var t;return(t=p.dataService.promotion).getPromotions.apply(t,arguments).refetchOnChannelChange()},function(t){return t.promotions},function(t,e){return p.createQueryOptions(t,e,p.searchForm.value)}),p}return i(r,[{key:"ngOnInit",value:function(){var e=this;t(m(r.prototype),"ngOnInit",this).call(this),(0,A.T)(this.searchForm.valueChanges.pipe((0,y.b)(250)),this.route.queryParamMap).pipe((0,Z.R)(this.destroy$)).subscribe(function(t){t.params||e.setPageNumber(1),e.refresh()})}},{key:"deletePromotion",value:function(t){var e=this;this.modalService.dialog({title:(0,f.J)("catalog.confirm-delete-promotion"),buttons:[{type:"secondary",label:(0,f.J)("common.cancel")},{type:"danger",label:(0,f.J)("common.delete"),returnValue:!0}]}).pipe((0,b.w)(function(o){return o?e.dataService.promotion.deletePromotion(t):C.E})).subscribe(function(){e.notificationService.success((0,f.J)("common.notify-delete-success"),{entity:"Promotion"}),e.refresh()},function(t){e.notificationService.error((0,f.J)("common.notify-delete-error"),{entity:"Promotion"})})}},{key:"createQueryOptions",value:function(t,e,o){var n={};return o.couponCode&&(n.couponCode={contains:o.couponCode}),o.name&&(n.name={contains:o.name}),{options:{skip:t,take:e,filter:n}}}}]),r}(g.t7C);R.\u0275fac=function(t){return new(t||R)(s.Y36(g.DoR),s.Y36(p.F0),s.Y36(p.gz),s.Y36(g.gqp),s.Y36(g.Z7U))},R.\u0275cmp=s.Xpm({type:R,selectors:[["vdr-promotion-list"]],features:[s.qOj],decls:31,vars:32,consts:[[1,"search-form",3,"formGroup"],["type","text","formControlName","name",1,"search-input",3,"placeholder"],["type","text","formControlName","couponCode",1,"search-input",3,"placeholder"],["locationId","promotion-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[4,"ngIf"],[1,"align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(s.TgZ(0,"vdr-action-bar"),s.TgZ(1,"vdr-ab-left"),s.TgZ(2,"form",0),s._UZ(3,"input",1),s.ALo(4,"translate"),s._UZ(5,"input",2),s.ALo(6,"translate"),s.qZA(),s.qZA(),s.TgZ(7,"vdr-ab-right"),s._UZ(8,"vdr-action-bar-items",3),s.YNc(9,j,4,5,"a",4),s.qZA(),s.qZA(),s.TgZ(10,"vdr-data-table",5),s.NdJ("pageChange",function(t){return e.setPageNumber(t)})("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),s.ALo(11,"async"),s.ALo(12,"async"),s.ALo(13,"async"),s.ALo(14,"async"),s.TgZ(15,"vdr-dt-column"),s._uU(16),s.ALo(17,"translate"),s.qZA(),s.TgZ(18,"vdr-dt-column"),s._uU(19),s.ALo(20,"translate"),s.qZA(),s.TgZ(21,"vdr-dt-column"),s._uU(22),s.ALo(23,"translate"),s.qZA(),s.TgZ(24,"vdr-dt-column"),s._uU(25),s.ALo(26,"translate"),s.qZA(),s._UZ(27,"vdr-dt-column"),s._UZ(28,"vdr-dt-column"),s._UZ(29,"vdr-dt-column"),s.YNc(30,$,27,26,"ng-template"),s.qZA()),2&t&&(s.xp6(2),s.Q6J("formGroup",e.searchForm),s.xp6(1),s.Q6J("placeholder",s.lcZ(4,12,"marketing.search-by-name")),s.xp6(2),s.Q6J("placeholder",s.lcZ(6,14,"marketing.search-by-coupon-code")),s.xp6(4),s.Q6J("vdrIfPermissions","CreatePromotion"),s.xp6(1),s.Q6J("items",s.lcZ(11,16,e.items$))("itemsPerPage",s.lcZ(12,18,e.itemsPerPage$))("totalItems",s.lcZ(13,20,e.totalItems$))("currentPage",s.lcZ(14,22,e.currentPage$)),s.xp6(6),s.Oqu(s.lcZ(17,24,"common.name")),s.xp6(3),s.Oqu(s.lcZ(20,26,"marketing.coupon-code")),s.xp6(3),s.Oqu(s.lcZ(23,28,"marketing.starts-at")),s.xp6(3),s.Oqu(s.lcZ(26,30,"marketing.ends-at")))},directives:[g.KkL,g.BND,l._Y,l.JL,l.sg,g.y_K,l.Fj,l.JJ,l.u,g.mz,g.WWO,g.HAh,g.Qj_,g.Egy,p.yS,x.qvL,P.O5,g.v_8,g.JOL,g.UaT,g.N9E,g.HH4,g.Ywx],pipes:[q.X$,P.Ov,g.HbD,g.j$k],styles:[".search-form[_ngcontent-%COMP%]{padding:0}.search-input[_ngcontent-%COMP%]{margin:6px 8px 0 0;min-width:200px}"],changeDetection:0}),R.ctorParameters=function(){return[{type:g.DoR},{type:p.F0},{type:p.gz},{type:g.gqp},{type:g.Z7U}]};var M=function(t){c(o,t);var e=u(o);function o(t,r){return n(this,o),e.call(this,t,{__typename:"Promotion",id:"",createdAt:"",updatedAt:"",name:"",enabled:!1,conditions:[],actions:[]},function(t){return r.promotion.getPromotion(t).mapStream(function(t){return t.promotion})})}return i(o)}(g.p_9);M.\u0275fac=function(t){return new(t||M)(s.LFG(p.F0),s.LFG(g.DoR))},M.\u0275prov=s.Yz7({factory:function(){return new M(s.LFG(p.F0),s.LFG(g.DoR))},token:M,providedIn:"root"}),M.ctorParameters=function(){return[{type:p.F0},{type:g.DoR}]};var H={breadcrumb:(0,f.J)("breadcrumb.promotions")},G={breadcrumb:K},z=[{path:"promotions",component:R,data:H},{path:"promotions/:id",component:B,resolve:(0,g.Po4)(M),canDeactivate:[g.TSp],data:G}];function K(t,e){return(0,g.YWC)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.promotions",getName:function(t){return t.name},route:"promotions"})}var V=i(function t(){n(this,t)});V.\u0275fac=function(t){return new(t||V)},V.\u0275mod=s.oAB({type:V}),V.\u0275inj=s.cJS({imports:[[g.m81,p.Bz.forChild(z)]]})}}])}();
//# sourceMappingURL=995-es5.538e716a357b8f97be0a.js.map